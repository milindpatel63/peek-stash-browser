<?xml version="1.0"?>
<Container version="2">
  <Name>Peek</Name>
  <Repository>carrotwaxr/peek-stash-browser:latest</Repository>
  <Registry>https://hub.docker.com/r/carrotwaxr/peek-stash-browser/</Registry>
  <Network>bridge</Network>
  <MyIP/>
  <Shell>bash</Shell>
  <Privileged>false</Privileged>
  <Support>https://github.com/carrotwaxr/peek-stash-browser/issues</Support>
  <Project>https://github.com/carrotwaxr/peek-stash-browser</Project>
  <Overview>
    Peek Stash Browser is a modern web application for browsing and streaming your Stash media library.

    Features:
    - Modern React frontend with responsive design
    - Video streaming proxied through Stash (no local media access needed)
    - Adaptive quality selection (Direct, 1080p, 720p, 480p, 360p)
    - JWT-based authentication with admin/user roles
    - Advanced filtering and search
    - Subtitle/caption support
    - 4-step setup wizard for easy first-time configuration

    This is a single-container solution that includes:
    - Frontend web interface (React + Vite)
    - Backend API server (Node.js/Express + TypeScript)
    - SQLite database for user data

    First-Time Setup:
    After installation, access http://[IP]:6969 and complete the 4-step setup wizard:
    1. Welcome screen
    2. Create admin account (username + password)
    3. Connect to Stash (URL + API key)
    4. Setup complete!

    Requirements:
    - Existing Stash server with GraphQL API enabled
    - Network access from Peek to Stash server
    - At least 1GB RAM recommended

    Upgrading from v1.x:
    Your existing STASH_URL and STASH_API_KEY will auto-migrate to the database on first start.
    After successful migration, you can remove these env vars from your container config.
  </Overview>
  <Category>MediaApp:Video MediaServer:Video</Category>
  <WebUI>http://[IP]:[PORT:80]</WebUI>
  <TemplateURL>https://raw.githubusercontent.com/carrotwaxr/peek-stash-browser/main/unraid-template.xml</TemplateURL>
  <Icon>https://raw.githubusercontent.com/carrotwaxr/peek-stash-browser/main/client/public/branding/logos/peek-logo.png</Icon>
  <ExtraParams/>
  <PostArgs/>
  <CPUset/>
  <DateInstalled/>
  <DonateText/>
  <DonateLink/>
  <Description>
    Modern web interface for Stash with multi-user support, playlists, recommendations, and watch history.
  </Description>
  <Networking>
    <Mode>bridge</Mode>
    <Publish>
      <Port>
        <HostPort>6969</HostPort>
        <ContainerPort>80</ContainerPort>
        <Protocol>tcp</Protocol>
      </Port>
    </Publish>
  </Networking>
  <Data>
    <Volume>
      <HostDir>/mnt/user/appdata/peek-stash-browser</HostDir>
      <ContainerDir>/app/data</ContainerDir>
      <Mode>rw</Mode>
    </Volume>
  </Data>
  <Environment>
    <Variable>
      <Value>http://10.0.0.4:9999/graphql</Value>
      <Name>STASH_URL</Name>
      <Mode/>
    </Variable>
    <Variable>
      <Value>your-stash-api-key-here</Value>
      <Name>STASH_API_KEY</Name>
      <Mode/>
    </Variable>
    <Variable>
      <Value>file:/app/data/peek-db.db</Value>
      <Name>DATABASE_URL</Name>
      <Mode/>
    </Variable>
    <Variable>
      <Value>change-this-to-a-secure-random-string</Value>
      <Name>JWT_SECRET</Name>
      <Mode/>
    </Variable>
    <Variable>
      <Value>/app/data</Value>
      <Name>CONFIG_DIR</Name>
      <Mode/>
    </Variable>
    <Variable>
      <Value>production</Value>
      <Name>NODE_ENV</Name>
      <Mode/>
    </Variable>
    <Variable>
      <Value>false</Value>
      <Name>SECURE_COOKIES</Name>
      <Mode/>
    </Variable>
  </Environment>
  <Labels/>
  <Config Name="Web UI Port" Target="80" Default="6969" Mode="tcp" Description="Web interface port - access Peek at http://[IP]:6969" Type="Port" Display="always" Required="true" Mask="false">6969</Config>
  <Config Name="App Data Directory" Target="/app/data" Default="/mnt/user/appdata/peek-stash-browser" Mode="rw" Description="Peek configuration and database. Requires read/write access." Type="Path" Display="always" Required="true" Mask="false">/mnt/user/appdata/peek-stash-browser</Config>
  <Config Name="JWT Secret Key" Target="JWT_SECRET" Default="" Mode="" Description="Secure random string for JWT authentication. Generate with: openssl rand -hex 32" Type="Variable" Display="always" Required="true" Mask="true"></Config>
  <Config Name="Stash GraphQL URL (Legacy)" Target="STASH_URL" Default="" Mode="" Description="MIGRATION ONLY: Leave blank for new installs - configured via Setup Wizard. Existing v1.x installs: keep your value, it will auto-migrate to database on first start." Type="Variable" Display="advanced" Required="false" Mask="false"></Config>
  <Config Name="Stash API Key (Legacy)" Target="STASH_API_KEY" Default="" Mode="" Description="MIGRATION ONLY: Leave blank for new installs - configured via Setup Wizard. Existing v1.x installs: keep your value, it will auto-migrate to database on first start." Type="Variable" Display="advanced" Required="false" Mask="true"></Config>
  <Config Name="Database URL" Target="DATABASE_URL" Default="file:/app/data/peek-db.db" Mode="" Description="SQLite database file path. Leave as default unless you know what you're doing." Type="Variable" Display="advanced" Required="false" Mask="false">file:/app/data/peek-db.db</Config>
  <Config Name="Config Directory" Target="CONFIG_DIR" Default="/app/data" Mode="" Description="Directory for config and database. Should match App Data Directory container path." Type="Variable" Display="advanced" Required="false" Mask="false">/app/data</Config>
  <Config Name="Node Environment" Target="NODE_ENV" Default="production" Mode="" Description="Node.js environment mode. Leave as 'production' for normal use." Type="Variable" Display="advanced" Required="false" Mask="false">production</Config>
  <Config Name="Secure Cookies" Target="SECURE_COOKIES" Default="false" Mode="" Description="Enable secure cookies (HTTPS only). Set to 'true' only if you use HTTPS with a reverse proxy." Type="Variable" Display="advanced" Required="false" Mask="false">false</Config>
</Container>
