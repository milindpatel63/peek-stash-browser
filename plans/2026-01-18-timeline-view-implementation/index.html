<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Modern web application for browsing and streaming your Stash media library"><meta name=author content=carrotwaxr><link href=https://carrotwaxr.github.io/peek-stash-browser/plans/2026-01-18-timeline-view-implementation/ rel=canonical><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.2"><title>Timeline View Implementation Plan - Peek Stash Browser</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=deep-purple data-md-color-accent=pink> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#timeline-view-implementation-plan class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Peek Stash Browser" class="md-header__button md-logo" aria-label="Peek Stash Browser" data-md-component=logo> <img src=../../assets/peek-logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Peek Stash Browser </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Timeline View Implementation Plan </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=deep-purple data-md-color-accent=pink aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=deep-purple data-md-color-accent=pink aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/carrotwaxr/peek-stash-browser title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> carrotwaxr/peek-stash-browser </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Peek Stash Browser" class="md-nav__button md-logo" aria-label="Peek Stash Browser" data-md-component=logo> <img src=../../assets/peek-logo.png alt=logo> </a> Peek Stash Browser </label> <div class=md-nav__source> <a href=https://github.com/carrotwaxr/peek-stash-browser title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> carrotwaxr/peek-stash-browser </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../getting-started/installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/configuration/ class=md-nav__link> <span class=md-ellipsis> Configuration </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/quick-start/ class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/upgrading/ class=md-nav__link> <span class=md-ellipsis> Upgrading </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/troubleshooting/ class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/faq/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/browse-and-display/ class=md-nav__link> <span class=md-ellipsis> Browse and Display </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/content-restrictions/ class=md-nav__link> <span class=md-ellipsis> Content Restrictions </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/custom-carousels/ class=md-nav__link> <span class=md-ellipsis> Custom Carousels </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/downloads/ class=md-nav__link> <span class=md-ellipsis> Downloads </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/external-player/ class=md-nav__link> <span class=md-ellipsis> External Player </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/hidden-items/ class=md-nav__link> <span class=md-ellipsis> Hidden Items </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/images/ class=md-nav__link> <span class=md-ellipsis> Images </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/keyboard-navigation/ class=md-nav__link> <span class=md-ellipsis> Keyboard Navigation </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/merge-detection/ class=md-nav__link> <span class=md-ellipsis> Merge Detection </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/personalization/ class=md-nav__link> <span class=md-ellipsis> Personalization </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/playlists/ class=md-nav__link> <span class=md-ellipsis> Playlists </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/recommendations/ class=md-nav__link> <span class=md-ellipsis> Recommendations </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/user-management/ class=md-nav__link> <span class=md-ellipsis> User Management </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/watch-history/ class=md-nav__link> <span class=md-ellipsis> Watch History </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../reference/docker-basics/ class=md-nav__link> <span class=md-ellipsis> Docker Basics </span> </a> </li> <li class=md-nav__item> <a href=../../reference/api-reference/ class=md-nav__link> <span class=md-ellipsis> API Reference </span> </a> </li> <li class=md-nav__item> <a href=../../reference/entity-relationships/ class=md-nav__link> <span class=md-ellipsis> Entity Relationships </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> Development </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../development/local-setup/ class=md-nav__link> <span class=md-ellipsis> Local Setup </span> </a> </li> <li class=md-nav__item> <a href=../../development/technical-overview/ class=md-nav__link> <span class=md-ellipsis> Technical Overview </span> </a> </li> <li class=md-nav__item> <a href=../../development/sync-architecture/ class=md-nav__link> <span class=md-ellipsis> Sync Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../development/regression-testing/ class=md-nav__link> <span class=md-ellipsis> Regression Testing Guide </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#task-1-backend-timelineservice-date-distribution-query class=md-nav__link> <span class=md-ellipsis> Task 1: Backend - TimelineService Date Distribution Query </span> </a> </li> <li class=md-nav__item> <a href=#task-2-backend-timeline-controller-and-route class=md-nav__link> <span class=md-ellipsis> Task 2: Backend - Timeline Controller and Route </span> </a> </li> <li class=md-nav__item> <a href=#task-3-frontend-usetimelinestate-hook class=md-nav__link> <span class=md-ellipsis> Task 3: Frontend - useTimelineState Hook </span> </a> </li> <li class=md-nav__item> <a href=#task-4-frontend-timelinecontrols-component class=md-nav__link> <span class=md-ellipsis> Task 4: Frontend - TimelineControls Component </span> </a> </li> <li class=md-nav__item> <a href=#task-5-frontend-timelinebar-component class=md-nav__link> <span class=md-ellipsis> Task 5: Frontend - TimelineBar Component </span> </a> </li> <li class=md-nav__item> <a href=#task-6-frontend-timelinestrip-component class=md-nav__link> <span class=md-ellipsis> Task 6: Frontend - TimelineStrip Component </span> </a> </li> <li class=md-nav__item> <a href=#task-7-frontend-timelineview-main-component class=md-nav__link> <span class=md-ellipsis> Task 7: Frontend - TimelineView Main Component </span> </a> </li> <li class=md-nav__item> <a href=#task-8-frontend-add-timeline-to-entity-display-config class=md-nav__link> <span class=md-ellipsis> Task 8: Frontend - Add Timeline to Entity Display Config </span> </a> </li> <li class=md-nav__item> <a href=#task-9-frontend-add-timeline-icon-to-viewmodetoggle class=md-nav__link> <span class=md-ellipsis> Task 9: Frontend - Add Timeline Icon to ViewModeToggle </span> </a> </li> <li class=md-nav__item> <a href=#task-10-frontend-integrate-timeline-into-scenesearch class=md-nav__link> <span class=md-ellipsis> Task 10: Frontend - Integrate Timeline into SceneSearch </span> </a> </li> <li class=md-nav__item> <a href=#task-11-frontend-integrate-timeline-into-gallerysearch class=md-nav__link> <span class=md-ellipsis> Task 11: Frontend - Integrate Timeline into GallerySearch </span> </a> </li> <li class=md-nav__item> <a href=#task-12-frontend-integrate-timeline-into-imagesearch class=md-nav__link> <span class=md-ellipsis> Task 12: Frontend - Integrate Timeline into ImageSearch </span> </a> </li> <li class=md-nav__item> <a href=#task-13-frontend-mobile-bottom-sheet-component class=md-nav__link> <span class=md-ellipsis> Task 13: Frontend - Mobile Bottom Sheet Component </span> </a> </li> <li class=md-nav__item> <a href=#task-14-frontend-add-mobile-detection-and-sheet-integration class=md-nav__link> <span class=md-ellipsis> Task 14: Frontend - Add Mobile Detection and Sheet Integration </span> </a> </li> <li class=md-nav__item> <a href=#task-15-integration-test-timeline-api-endpoint class=md-nav__link> <span class=md-ellipsis> Task 15: Integration Test - Timeline API Endpoint </span> </a> </li> <li class=md-nav__item> <a href=#task-16-manual-testing-polish class=md-nav__link> <span class=md-ellipsis> Task 16: Manual Testing &amp; Polish </span> </a> </li> <li class=md-nav__item> <a href=#task-17-run-full-test-suite-final-commit class=md-nav__link> <span class=md-ellipsis> Task 17: Run Full Test Suite &amp; Final Commit </span> </a> </li> <li class=md-nav__item> <a href=#summary class=md-nav__link> <span class=md-ellipsis> Summary </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=timeline-view-implementation-plan>Timeline View Implementation Plan<a class=headerlink href=#timeline-view-implementation-plan title="Permanent link">&para;</a></h1> <blockquote> <p><strong>For Claude:</strong> REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.</p> </blockquote> <p><strong>Goal:</strong> Add a Timeline view mode for browsing scenes, galleries, and images by date on a horizontally scrollable timeline with density bars.</p> <p><strong>Architecture:</strong> New view mode integrating with existing SearchControls pattern. Backend provides date distribution via SQL aggregation with exclusion filtering. Frontend renders horizontal timeline with density bars, zoom controls, and mobile bottom sheet.</p> <p><strong>Tech Stack:</strong> React 19, Vitest, Tailwind CSS, Prisma raw SQL, existing SearchControls/entityDisplayConfig patterns</p> <hr> <h2 id=task-1-backend-timelineservice-date-distribution-query>Task 1: Backend - TimelineService Date Distribution Query<a class=headerlink href=#task-1-backend-timelineservice-date-distribution-query title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Create: <code>server/services/TimelineService.ts</code> - Test: <code>server/tests/services/TimelineService.test.ts</code></p> <p><strong>Step 1: Write the failing test</strong></p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1>// server/tests/services/TimelineService.test.ts</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>describe</span><span class=p>,</span><span class=w> </span><span class=nx>it</span><span class=p>,</span><span class=w> </span><span class=nx>expect</span><span class=p>,</span><span class=w> </span><span class=nx>vi</span><span class=p>,</span><span class=w> </span><span class=nx>beforeEach</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;vitest&quot;</span><span class=p>;</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=nx>vi</span><span class=p>.</span><span class=nx>mock</span><span class=p>(</span><span class=s2>&quot;../services/StashInstanceManager.js&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>({</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>  </span><span class=nx>stashInstanceManager</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=w>    </span><span class=nx>getDefaultConfig</span><span class=o>:</span><span class=w> </span><span class=kt>vi.fn</span><span class=p>().</span><span class=nx>mockReturnValue</span><span class=p>({</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>      </span><span class=nx>id</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;test-instance&quot;</span><span class=p>,</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=w>      </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Test Stash&quot;</span><span class=p>,</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=w>      </span><span class=nx>url</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;http://localhost:9999/graphql&quot;</span><span class=p>,</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=w>      </span><span class=nx>apiKey</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;test-api-key&quot;</span><span class=p>,</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=w>    </span><span class=p>}),</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=w>    </span><span class=nx>getAllConfigs</span><span class=o>:</span><span class=w> </span><span class=kt>vi.fn</span><span class=p>().</span><span class=nx>mockReturnValue</span><span class=p>([]),</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=w>    </span><span class=nx>loadFromDatabase</span><span class=o>:</span><span class=w> </span><span class=kt>vi.fn</span><span class=p>().</span><span class=nx>mockResolvedValue</span><span class=p>(</span><span class=kc>undefined</span><span class=p>),</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=p>}));</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>TimelineService</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../services/TimelineService.js&quot;</span><span class=p>;</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;TimelineService&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a><span class=w>  </span><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;getStrftimeFormat&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;returns correct format for years granularity&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>service</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>TimelineService</span><span class=p>();</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>service</span><span class=p>.</span><span class=nx>getStrftimeFormat</span><span class=p>(</span><span class=s2>&quot;years&quot;</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=s2>&quot;%Y&quot;</span><span class=p>);</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;returns correct format for months granularity&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>service</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>TimelineService</span><span class=p>();</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>service</span><span class=p>.</span><span class=nx>getStrftimeFormat</span><span class=p>(</span><span class=s2>&quot;months&quot;</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=s2>&quot;%Y-%m&quot;</span><span class=p>);</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;returns correct format for weeks granularity&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>service</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>TimelineService</span><span class=p>();</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>service</span><span class=p>.</span><span class=nx>getStrftimeFormat</span><span class=p>(</span><span class=s2>&quot;weeks&quot;</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=s2>&quot;%Y-W%W&quot;</span><span class=p>);</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35 href=#__codelineno-0-35></a>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36 href=#__codelineno-0-36></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;returns correct format for days granularity&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37 href=#__codelineno-0-37></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>service</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>TimelineService</span><span class=p>();</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38 href=#__codelineno-0-38></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>service</span><span class=p>.</span><span class=nx>getStrftimeFormat</span><span class=p>(</span><span class=s2>&quot;days&quot;</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=s2>&quot;%Y-%m-%d&quot;</span><span class=p>);</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39 href=#__codelineno-0-39></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40 href=#__codelineno-0-40></a>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41 href=#__codelineno-0-41></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;defaults to months for invalid granularity&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42 href=#__codelineno-0-42></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>service</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>TimelineService</span><span class=p>();</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43 href=#__codelineno-0-43></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>service</span><span class=p>.</span><span class=nx>getStrftimeFormat</span><span class=p>(</span><span class=s2>&quot;invalid&quot;</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>any</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=s2>&quot;%Y-%m&quot;</span><span class=p>);</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44 href=#__codelineno-0-44></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45 href=#__codelineno-0-45></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46 href=#__codelineno-0-46></a>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47 href=#__codelineno-0-47></a><span class=w>  </span><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;buildDistributionQuery&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48 href=#__codelineno-0-48></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;builds SQL with exclusion JOIN for scenes&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49 href=#__codelineno-0-49></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>service</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>TimelineService</span><span class=p>();</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50 href=#__codelineno-0-50></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>sql</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>buildDistributionQuery</span><span class=p>(</span><span class=s2>&quot;scene&quot;</span><span class=p>,</span><span class=w> </span><span class=mf>1</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;months&quot;</span><span class=p>);</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51 href=#__codelineno-0-51></a>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52 href=#__codelineno-0-52></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>sql</span><span class=p>).</span><span class=nx>toContain</span><span class=p>(</span><span class=s2>&quot;SELECT&quot;</span><span class=p>);</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53 href=#__codelineno-0-53></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>sql</span><span class=p>).</span><span class=nx>toContain</span><span class=p>(</span><span class=s2>&quot;strftime(&#39;%Y-%m&#39;, s.date)&quot;</span><span class=p>);</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54 href=#__codelineno-0-54></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>sql</span><span class=p>).</span><span class=nx>toContain</span><span class=p>(</span><span class=s2>&quot;COUNT(*)&quot;</span><span class=p>);</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55 href=#__codelineno-0-55></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>sql</span><span class=p>).</span><span class=nx>toContain</span><span class=p>(</span><span class=s2>&quot;LEFT JOIN UserExcludedEntity&quot;</span><span class=p>);</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56 href=#__codelineno-0-56></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>sql</span><span class=p>).</span><span class=nx>toContain</span><span class=p>(</span><span class=s2>&quot;e.id IS NULL&quot;</span><span class=p>);</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57 href=#__codelineno-0-57></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>sql</span><span class=p>).</span><span class=nx>toContain</span><span class=p>(</span><span class=s2>&quot;s.date IS NOT NULL&quot;</span><span class=p>);</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58 href=#__codelineno-0-58></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>sql</span><span class=p>).</span><span class=nx>toContain</span><span class=p>(</span><span class=s2>&quot;GROUP BY period&quot;</span><span class=p>);</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59 href=#__codelineno-0-59></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>sql</span><span class=p>).</span><span class=nx>toContain</span><span class=p>(</span><span class=s2>&quot;ORDER BY period ASC&quot;</span><span class=p>);</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60 href=#__codelineno-0-60></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>params</span><span class=p>).</span><span class=nx>toContain</span><span class=p>(</span><span class=mf>1</span><span class=p>);</span><span class=w> </span><span class=c1>// userId</span>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61 href=#__codelineno-0-61></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62 href=#__codelineno-0-62></a>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63 href=#__codelineno-0-63></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;builds SQL for galleries with correct table&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64 href=#__codelineno-0-64></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>service</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>TimelineService</span><span class=p>();</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65 href=#__codelineno-0-65></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>sql</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>buildDistributionQuery</span><span class=p>(</span><span class=s2>&quot;gallery&quot;</span><span class=p>,</span><span class=w> </span><span class=mf>1</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;years&quot;</span><span class=p>);</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66 href=#__codelineno-0-66></a>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67 href=#__codelineno-0-67></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>sql</span><span class=p>).</span><span class=nx>toContain</span><span class=p>(</span><span class=s2>&quot;FROM StashGallery&quot;</span><span class=p>);</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68 href=#__codelineno-0-68></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>sql</span><span class=p>).</span><span class=nx>toContain</span><span class=p>(</span><span class=s2>&quot;strftime(&#39;%Y&#39;, g.date)&quot;</span><span class=p>);</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69 href=#__codelineno-0-69></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70 href=#__codelineno-0-70></a>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71 href=#__codelineno-0-71></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;builds SQL for images with correct table&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72 href=#__codelineno-0-72></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>service</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>TimelineService</span><span class=p>();</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73 href=#__codelineno-0-73></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>sql</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>service</span><span class=p>.</span><span class=nx>buildDistributionQuery</span><span class=p>(</span><span class=s2>&quot;image&quot;</span><span class=p>,</span><span class=w> </span><span class=mf>1</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;days&quot;</span><span class=p>);</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74 href=#__codelineno-0-74></a>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75 href=#__codelineno-0-75></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>sql</span><span class=p>).</span><span class=nx>toContain</span><span class=p>(</span><span class=s2>&quot;FROM StashImage&quot;</span><span class=p>);</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76 href=#__codelineno-0-76></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>sql</span><span class=p>).</span><span class=nx>toContain</span><span class=p>(</span><span class=s2>&quot;strftime(&#39;%Y-%m-%d&#39;, i.date)&quot;</span><span class=p>);</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77 href=#__codelineno-0-77></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78 href=#__codelineno-0-78></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79 href=#__codelineno-0-79></a><span class=p>});</span>
</span></code></pre></div> <p><strong>Step 2: Run test to verify it fails</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/server &amp;&amp; npm test -- tests/services/TimelineService.test.ts</code> Expected: FAIL with "Cannot find module '../../services/TimelineService.js'"</p> <p><strong>Step 3: Write minimal implementation</strong></p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1>// server/services/TimelineService.ts</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>prisma</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../initializers/prisma.js&quot;</span><span class=p>;</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=k>export</span><span class=w> </span><span class=kr>type</span><span class=w> </span><span class=nx>Granularity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;years&quot;</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=s2>&quot;months&quot;</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=s2>&quot;weeks&quot;</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=s2>&quot;days&quot;</span><span class=p>;</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=k>export</span><span class=w> </span><span class=kr>type</span><span class=w> </span><span class=nx>TimelineEntityType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;scene&quot;</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=s2>&quot;gallery&quot;</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=s2>&quot;image&quot;</span><span class=p>;</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=k>export</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=nx>DistributionItem</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=w>  </span><span class=nx>period</span><span class=o>:</span><span class=w> </span><span class=kt>string</span><span class=p>;</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>  </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=kt>number</span><span class=p>;</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=p>}</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=kd>interface</span><span class=w> </span><span class=nx>QueryClause</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=w>  </span><span class=nx>sql</span><span class=o>:</span><span class=w> </span><span class=kt>string</span><span class=p>;</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=w>  </span><span class=nx>params</span><span class=o>:</span><span class=w> </span><span class=p>(</span><span class=kt>string</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=kt>number</span><span class=p>)[];</span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=p>}</span>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a>
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=kd>const</span><span class=w> </span><span class=nx>ENTITY_CONFIG</span><span class=o>:</span><span class=w> </span><span class=kt>Record</span><span class=o>&lt;</span><span class=nx>TimelineEntityType</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>table</span><span class=o>:</span><span class=w> </span><span class=kt>string</span><span class=p>;</span><span class=w> </span><span class=nx>alias</span><span class=o>:</span><span class=w> </span><span class=kt>string</span><span class=p>;</span><span class=w> </span><span class=nx>dateField</span><span class=o>:</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>}</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=w>  </span><span class=nx>scene</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>table</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;StashScene&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>alias</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;s&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>dateField</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;s.date&quot;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=w>  </span><span class=nx>gallery</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>table</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;StashGallery&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>alias</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;g&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>dateField</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;g.date&quot;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=w>  </span><span class=nx>image</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>table</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;StashImage&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>alias</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;i&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>dateField</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;i.date&quot;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-1-21><a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=p>};</span>
</span><span id=__span-1-22><a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a>
</span><span id=__span-1-23><a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=k>export</span><span class=w> </span><span class=kd>class</span><span class=w> </span><span class=nx>TimelineService</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-24><a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a><span class=w>  </span><span class=nx>getStrftimeFormat</span><span class=p>(</span><span class=nx>granularity</span><span class=o>:</span><span class=w> </span><span class=kt>Granularity</span><span class=p>)</span><span class=o>:</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-25><a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a><span class=w>    </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=nx>granularity</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-26><a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a><span class=w>      </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;years&quot;</span><span class=o>:</span>
</span><span id=__span-1-27><a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s2>&quot;%Y&quot;</span><span class=p>;</span>
</span><span id=__span-1-28><a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a><span class=w>      </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;months&quot;</span><span class=o>:</span>
</span><span id=__span-1-29><a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s2>&quot;%Y-%m&quot;</span><span class=p>;</span>
</span><span id=__span-1-30><a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a><span class=w>      </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;weeks&quot;</span><span class=o>:</span>
</span><span id=__span-1-31><a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s2>&quot;%Y-W%W&quot;</span><span class=p>;</span>
</span><span id=__span-1-32><a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a><span class=w>      </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;days&quot;</span><span class=o>:</span>
</span><span id=__span-1-33><a id=__codelineno-1-33 name=__codelineno-1-33 href=#__codelineno-1-33></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s2>&quot;%Y-%m-%d&quot;</span><span class=p>;</span>
</span><span id=__span-1-34><a id=__codelineno-1-34 name=__codelineno-1-34 href=#__codelineno-1-34></a><span class=w>      </span><span class=nx>default</span><span class=o>:</span>
</span><span id=__span-1-35><a id=__codelineno-1-35 name=__codelineno-1-35 href=#__codelineno-1-35></a><span class=w>        </span><span class=kt>return</span><span class=w> </span><span class=s2>&quot;%Y-%m&quot;</span><span class=p>;</span>
</span><span id=__span-1-36><a id=__codelineno-1-36 name=__codelineno-1-36 href=#__codelineno-1-36></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-1-37><a id=__codelineno-1-37 name=__codelineno-1-37 href=#__codelineno-1-37></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-1-38><a id=__codelineno-1-38 name=__codelineno-1-38 href=#__codelineno-1-38></a>
</span><span id=__span-1-39><a id=__codelineno-1-39 name=__codelineno-1-39 href=#__codelineno-1-39></a><span class=w>  </span><span class=nx>buildDistributionQuery</span><span class=p>(</span>
</span><span id=__span-1-40><a id=__codelineno-1-40 name=__codelineno-1-40 href=#__codelineno-1-40></a><span class=w>    </span><span class=nx>entityType</span><span class=o>:</span><span class=w> </span><span class=kt>TimelineEntityType</span><span class=p>,</span>
</span><span id=__span-1-41><a id=__codelineno-1-41 name=__codelineno-1-41 href=#__codelineno-1-41></a><span class=w>    </span><span class=nx>userId</span><span class=o>:</span><span class=w> </span><span class=kt>number</span><span class=p>,</span>
</span><span id=__span-1-42><a id=__codelineno-1-42 name=__codelineno-1-42 href=#__codelineno-1-42></a><span class=w>    </span><span class=nx>granularity</span><span class=o>:</span><span class=w> </span><span class=kt>Granularity</span>
</span><span id=__span-1-43><a id=__codelineno-1-43 name=__codelineno-1-43 href=#__codelineno-1-43></a><span class=w>  </span><span class=p>)</span><span class=o>:</span><span class=w> </span><span class=nx>QueryClause</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-44><a id=__codelineno-1-44 name=__codelineno-1-44 href=#__codelineno-1-44></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>ENTITY_CONFIG</span><span class=p>[</span><span class=nx>entityType</span><span class=p>];</span>
</span><span id=__span-1-45><a id=__codelineno-1-45 name=__codelineno-1-45 href=#__codelineno-1-45></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>format</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=nx>getStrftimeFormat</span><span class=p>(</span><span class=nx>granularity</span><span class=p>);</span>
</span><span id=__span-1-46><a id=__codelineno-1-46 name=__codelineno-1-46 href=#__codelineno-1-46></a>
</span><span id=__span-1-47><a id=__codelineno-1-47 name=__codelineno-1-47 href=#__codelineno-1-47></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>sql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sb>`</span>
</span><span id=__span-1-48><a id=__codelineno-1-48 name=__codelineno-1-48 href=#__codelineno-1-48></a><span class=sb>      SELECT</span>
</span><span id=__span-1-49><a id=__codelineno-1-49 name=__codelineno-1-49 href=#__codelineno-1-49></a><span class=sb>        strftime(&#39;</span><span class=si>${</span><span class=nx>format</span><span class=si>}</span><span class=sb>&#39;, </span><span class=si>${</span><span class=nx>config</span><span class=p>.</span><span class=nx>dateField</span><span class=si>}</span><span class=sb>) as period,</span>
</span><span id=__span-1-50><a id=__codelineno-1-50 name=__codelineno-1-50 href=#__codelineno-1-50></a><span class=sb>        COUNT(*) as count</span>
</span><span id=__span-1-51><a id=__codelineno-1-51 name=__codelineno-1-51 href=#__codelineno-1-51></a><span class=sb>      FROM </span><span class=si>${</span><span class=nx>config</span><span class=p>.</span><span class=nx>table</span><span class=si>}</span><span class=sb> </span><span class=si>${</span><span class=nx>config</span><span class=p>.</span><span class=nx>alias</span><span class=si>}</span>
</span><span id=__span-1-52><a id=__codelineno-1-52 name=__codelineno-1-52 href=#__codelineno-1-52></a><span class=sb>      LEFT JOIN UserExcludedEntity e</span>
</span><span id=__span-1-53><a id=__codelineno-1-53 name=__codelineno-1-53 href=#__codelineno-1-53></a><span class=sb>        ON e.userId = ? AND e.entityType = &#39;</span><span class=si>${</span><span class=nx>entityType</span><span class=si>}</span><span class=sb>&#39; AND e.entityId = </span><span class=si>${</span><span class=nx>config</span><span class=p>.</span><span class=nx>alias</span><span class=si>}</span><span class=sb>.id</span>
</span><span id=__span-1-54><a id=__codelineno-1-54 name=__codelineno-1-54 href=#__codelineno-1-54></a><span class=sb>      WHERE </span><span class=si>${</span><span class=nx>config</span><span class=p>.</span><span class=nx>alias</span><span class=si>}</span><span class=sb>.deletedAt IS NULL</span>
</span><span id=__span-1-55><a id=__codelineno-1-55 name=__codelineno-1-55 href=#__codelineno-1-55></a><span class=sb>        AND e.id IS NULL</span>
</span><span id=__span-1-56><a id=__codelineno-1-56 name=__codelineno-1-56 href=#__codelineno-1-56></a><span class=sb>        AND </span><span class=si>${</span><span class=nx>config</span><span class=p>.</span><span class=nx>dateField</span><span class=si>}</span><span class=sb> IS NOT NULL</span>
</span><span id=__span-1-57><a id=__codelineno-1-57 name=__codelineno-1-57 href=#__codelineno-1-57></a><span class=sb>      GROUP BY period</span>
</span><span id=__span-1-58><a id=__codelineno-1-58 name=__codelineno-1-58 href=#__codelineno-1-58></a><span class=sb>      ORDER BY period ASC</span>
</span><span id=__span-1-59><a id=__codelineno-1-59 name=__codelineno-1-59 href=#__codelineno-1-59></a><span class=sb>    `</span><span class=p>.</span><span class=nx>trim</span><span class=p>();</span>
</span><span id=__span-1-60><a id=__codelineno-1-60 name=__codelineno-1-60 href=#__codelineno-1-60></a>
</span><span id=__span-1-61><a id=__codelineno-1-61 name=__codelineno-1-61 href=#__codelineno-1-61></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>sql</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=o>:</span><span class=w> </span><span class=p>[</span><span class=nx>userId</span><span class=p>]</span><span class=w> </span><span class=p>};</span>
</span><span id=__span-1-62><a id=__codelineno-1-62 name=__codelineno-1-62 href=#__codelineno-1-62></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-1-63><a id=__codelineno-1-63 name=__codelineno-1-63 href=#__codelineno-1-63></a>
</span><span id=__span-1-64><a id=__codelineno-1-64 name=__codelineno-1-64 href=#__codelineno-1-64></a><span class=w>  </span><span class=k>async</span><span class=w> </span><span class=nx>getDistribution</span><span class=p>(</span>
</span><span id=__span-1-65><a id=__codelineno-1-65 name=__codelineno-1-65 href=#__codelineno-1-65></a><span class=w>    </span><span class=nx>entityType</span><span class=o>:</span><span class=w> </span><span class=kt>TimelineEntityType</span><span class=p>,</span>
</span><span id=__span-1-66><a id=__codelineno-1-66 name=__codelineno-1-66 href=#__codelineno-1-66></a><span class=w>    </span><span class=nx>userId</span><span class=o>:</span><span class=w> </span><span class=kt>number</span><span class=p>,</span>
</span><span id=__span-1-67><a id=__codelineno-1-67 name=__codelineno-1-67 href=#__codelineno-1-67></a><span class=w>    </span><span class=nx>granularity</span><span class=o>:</span><span class=w> </span><span class=kt>Granularity</span>
</span><span id=__span-1-68><a id=__codelineno-1-68 name=__codelineno-1-68 href=#__codelineno-1-68></a><span class=w>  </span><span class=p>)</span><span class=o>:</span><span class=w> </span><span class=nb>Promise</span><span class=o>&lt;</span><span class=nx>DistributionItem</span><span class=p>[]</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-69><a id=__codelineno-1-69 name=__codelineno-1-69 href=#__codelineno-1-69></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>sql</span><span class=p>,</span><span class=w> </span><span class=nx>params</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=nx>buildDistributionQuery</span><span class=p>(</span><span class=nx>entityType</span><span class=p>,</span><span class=w> </span><span class=nx>userId</span><span class=p>,</span><span class=w> </span><span class=nx>granularity</span><span class=p>);</span>
</span><span id=__span-1-70><a id=__codelineno-1-70 name=__codelineno-1-70 href=#__codelineno-1-70></a>
</span><span id=__span-1-71><a id=__codelineno-1-71 name=__codelineno-1-71 href=#__codelineno-1-71></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>results</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>prisma</span><span class=p>.</span><span class=nx>$queryRawUnsafe</span><span class=o>&lt;</span><span class=nb>Array</span><span class=o>&lt;</span><span class=p>{</span><span class=w> </span><span class=nx>period</span><span class=o>:</span><span class=w> </span><span class=kt>string</span><span class=p>;</span><span class=w> </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=kt>bigint</span><span class=w> </span><span class=p>}</span><span class=o>&gt;&gt;</span><span class=p>(</span>
</span><span id=__span-1-72><a id=__codelineno-1-72 name=__codelineno-1-72 href=#__codelineno-1-72></a><span class=w>      </span><span class=nx>sql</span><span class=p>,</span>
</span><span id=__span-1-73><a id=__codelineno-1-73 name=__codelineno-1-73 href=#__codelineno-1-73></a><span class=w>      </span><span class=p>...</span><span class=nx>params</span>
</span><span id=__span-1-74><a id=__codelineno-1-74 name=__codelineno-1-74 href=#__codelineno-1-74></a><span class=w>    </span><span class=p>);</span>
</span><span id=__span-1-75><a id=__codelineno-1-75 name=__codelineno-1-75 href=#__codelineno-1-75></a>
</span><span id=__span-1-76><a id=__codelineno-1-76 name=__codelineno-1-76 href=#__codelineno-1-76></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>results</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>row</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>({</span>
</span><span id=__span-1-77><a id=__codelineno-1-77 name=__codelineno-1-77 href=#__codelineno-1-77></a><span class=w>      </span><span class=nx>period</span><span class=o>:</span><span class=w> </span><span class=kt>row.period</span><span class=p>,</span>
</span><span id=__span-1-78><a id=__codelineno-1-78 name=__codelineno-1-78 href=#__codelineno-1-78></a><span class=w>      </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=kt>Number</span><span class=p>(</span><span class=nx>row</span><span class=p>.</span><span class=nx>count</span><span class=p>),</span>
</span><span id=__span-1-79><a id=__codelineno-1-79 name=__codelineno-1-79 href=#__codelineno-1-79></a><span class=w>    </span><span class=p>}));</span>
</span><span id=__span-1-80><a id=__codelineno-1-80 name=__codelineno-1-80 href=#__codelineno-1-80></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-1-81><a id=__codelineno-1-81 name=__codelineno-1-81 href=#__codelineno-1-81></a><span class=p>}</span>
</span><span id=__span-1-82><a id=__codelineno-1-82 name=__codelineno-1-82 href=#__codelineno-1-82></a>
</span><span id=__span-1-83><a id=__codelineno-1-83 name=__codelineno-1-83 href=#__codelineno-1-83></a><span class=k>export</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=nx>timelineService</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>TimelineService</span><span class=p>();</span>
</span></code></pre></div> <p><strong>Step 4: Run test to verify it passes</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/server &amp;&amp; npm test -- tests/services/TimelineService.test.ts</code> Expected: PASS</p> <p><strong>Step 5: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>git<span class=w> </span>add<span class=w> </span>server/services/TimelineService.ts<span class=w> </span>server/tests/services/TimelineService.test.ts
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;feat(server): add TimelineService for date distribution queries&quot;</span>
</span></code></pre></div> <hr> <h2 id=task-2-backend-timeline-controller-and-route>Task 2: Backend - Timeline Controller and Route<a class=headerlink href=#task-2-backend-timeline-controller-and-route title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Create: <code>server/controllers/timelineController.ts</code> - Modify: <code>server/routes/api.ts</code> - Test: <code>server/tests/controllers/timelineController.test.ts</code></p> <p><strong>Step 1: Write the failing test</strong></p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1>// server/tests/controllers/timelineController.test.ts</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>describe</span><span class=p>,</span><span class=w> </span><span class=nx>it</span><span class=p>,</span><span class=w> </span><span class=nx>expect</span><span class=p>,</span><span class=w> </span><span class=nx>vi</span><span class=p>,</span><span class=w> </span><span class=nx>beforeEach</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;vitest&quot;</span><span class=p>;</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=nx>vi</span><span class=p>.</span><span class=nx>mock</span><span class=p>(</span><span class=s2>&quot;../../services/StashInstanceManager.js&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>({</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=w>  </span><span class=nx>stashInstanceManager</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=w>    </span><span class=nx>getDefaultConfig</span><span class=o>:</span><span class=w> </span><span class=kt>vi.fn</span><span class=p>().</span><span class=nx>mockReturnValue</span><span class=p>({</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=w>      </span><span class=nx>id</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;test-instance&quot;</span><span class=p>,</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=w>      </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Test Stash&quot;</span><span class=p>,</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=w>      </span><span class=nx>url</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;http://localhost:9999/graphql&quot;</span><span class=p>,</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=w>      </span><span class=nx>apiKey</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;test-api-key&quot;</span><span class=p>,</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=w>    </span><span class=p>}),</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=w>    </span><span class=nx>getAllConfigs</span><span class=o>:</span><span class=w> </span><span class=kt>vi.fn</span><span class=p>().</span><span class=nx>mockReturnValue</span><span class=p>([]),</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=w>    </span><span class=nx>loadFromDatabase</span><span class=o>:</span><span class=w> </span><span class=kt>vi.fn</span><span class=p>().</span><span class=nx>mockResolvedValue</span><span class=p>(</span><span class=kc>undefined</span><span class=p>),</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=p>}));</span>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a><span class=nx>vi</span><span class=p>.</span><span class=nx>mock</span><span class=p>(</span><span class=s2>&quot;../../services/TimelineService.js&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>({</span>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a><span class=w>  </span><span class=nx>timelineService</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a><span class=w>    </span><span class=nx>getDistribution</span><span class=o>:</span><span class=w> </span><span class=kt>vi.fn</span><span class=p>(),</span>
</span><span id=__span-3-20><a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-3-21><a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a><span class=p>}));</span>
</span><span id=__span-3-22><a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a>
</span><span id=__span-3-23><a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>getDateDistribution</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../controllers/timelineController.js&quot;</span><span class=p>;</span>
</span><span id=__span-3-24><a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>timelineService</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../services/TimelineService.js&quot;</span><span class=p>;</span>
</span><span id=__span-3-25><a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a>
</span><span id=__span-3-26><a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;timelineController&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-27><a id=__codelineno-3-27 name=__codelineno-3-27 href=#__codelineno-3-27></a><span class=w>  </span><span class=nx>beforeEach</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-28><a id=__codelineno-3-28 name=__codelineno-3-28 href=#__codelineno-3-28></a><span class=w>    </span><span class=nx>vi</span><span class=p>.</span><span class=nx>clearAllMocks</span><span class=p>();</span>
</span><span id=__span-3-29><a id=__codelineno-3-29 name=__codelineno-3-29 href=#__codelineno-3-29></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-3-30><a id=__codelineno-3-30 name=__codelineno-3-30 href=#__codelineno-3-30></a>
</span><span id=__span-3-31><a id=__codelineno-3-31 name=__codelineno-3-31 href=#__codelineno-3-31></a><span class=w>  </span><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;getDateDistribution&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-32><a id=__codelineno-3-32 name=__codelineno-3-32 href=#__codelineno-3-32></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;returns distribution for valid entity type and granularity&quot;</span><span class=p>,</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-33><a id=__codelineno-3-33 name=__codelineno-3-33 href=#__codelineno-3-33></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>mockDistribution</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-3-34><a id=__codelineno-3-34 name=__codelineno-3-34 href=#__codelineno-3-34></a><span class=w>        </span><span class=p>{</span><span class=w> </span><span class=nx>period</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2024-01&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=kt>47</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-3-35><a id=__codelineno-3-35 name=__codelineno-3-35 href=#__codelineno-3-35></a><span class=w>        </span><span class=p>{</span><span class=w> </span><span class=nx>period</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2024-02&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=kt>12</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-3-36><a id=__codelineno-3-36 name=__codelineno-3-36 href=#__codelineno-3-36></a><span class=w>      </span><span class=p>];</span>
</span><span id=__span-3-37><a id=__codelineno-3-37 name=__codelineno-3-37 href=#__codelineno-3-37></a><span class=w>      </span><span class=nx>vi</span><span class=p>.</span><span class=nx>mocked</span><span class=p>(</span><span class=nx>timelineService</span><span class=p>.</span><span class=nx>getDistribution</span><span class=p>).</span><span class=nx>mockResolvedValue</span><span class=p>(</span><span class=nx>mockDistribution</span><span class=p>);</span>
</span><span id=__span-3-38><a id=__codelineno-3-38 name=__codelineno-3-38 href=#__codelineno-3-38></a>
</span><span id=__span-3-39><a id=__codelineno-3-39 name=__codelineno-3-39 href=#__codelineno-3-39></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>req</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-40><a id=__codelineno-3-40 name=__codelineno-3-40 href=#__codelineno-3-40></a><span class=w>        </span><span class=nx>params</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>entityType</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;scene&quot;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-3-41><a id=__codelineno-3-41 name=__codelineno-3-41 href=#__codelineno-3-41></a><span class=w>        </span><span class=nx>query</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>granularity</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;months&quot;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-3-42><a id=__codelineno-3-42 name=__codelineno-3-42 href=#__codelineno-3-42></a><span class=w>        </span><span class=nx>user</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>id</span><span class=o>:</span><span class=w> </span><span class=kt>1</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-3-43><a id=__codelineno-3-43 name=__codelineno-3-43 href=#__codelineno-3-43></a><span class=w>      </span><span class=p>}</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>any</span><span class=p>;</span>
</span><span id=__span-3-44><a id=__codelineno-3-44 name=__codelineno-3-44 href=#__codelineno-3-44></a>
</span><span id=__span-3-45><a id=__codelineno-3-45 name=__codelineno-3-45 href=#__codelineno-3-45></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>res</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-46><a id=__codelineno-3-46 name=__codelineno-3-46 href=#__codelineno-3-46></a><span class=w>        </span><span class=nx>json</span><span class=o>:</span><span class=w> </span><span class=kt>vi.fn</span><span class=p>(),</span>
</span><span id=__span-3-47><a id=__codelineno-3-47 name=__codelineno-3-47 href=#__codelineno-3-47></a><span class=w>        </span><span class=nx>status</span><span class=o>:</span><span class=w> </span><span class=kt>vi.fn</span><span class=p>().</span><span class=nx>mockReturnThis</span><span class=p>(),</span>
</span><span id=__span-3-48><a id=__codelineno-3-48 name=__codelineno-3-48 href=#__codelineno-3-48></a><span class=w>      </span><span class=p>}</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>any</span><span class=p>;</span>
</span><span id=__span-3-49><a id=__codelineno-3-49 name=__codelineno-3-49 href=#__codelineno-3-49></a>
</span><span id=__span-3-50><a id=__codelineno-3-50 name=__codelineno-3-50 href=#__codelineno-3-50></a><span class=w>      </span><span class=k>await</span><span class=w> </span><span class=nx>getDateDistribution</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>);</span>
</span><span id=__span-3-51><a id=__codelineno-3-51 name=__codelineno-3-51 href=#__codelineno-3-51></a>
</span><span id=__span-3-52><a id=__codelineno-3-52 name=__codelineno-3-52 href=#__codelineno-3-52></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>timelineService</span><span class=p>.</span><span class=nx>getDistribution</span><span class=p>).</span><span class=nx>toHaveBeenCalledWith</span><span class=p>(</span><span class=s2>&quot;scene&quot;</span><span class=p>,</span><span class=w> </span><span class=mf>1</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;months&quot;</span><span class=p>);</span>
</span><span id=__span-3-53><a id=__codelineno-3-53 name=__codelineno-3-53 href=#__codelineno-3-53></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>).</span><span class=nx>toHaveBeenCalledWith</span><span class=p>({</span><span class=w> </span><span class=nx>distribution</span><span class=o>:</span><span class=w> </span><span class=kt>mockDistribution</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-3-54><a id=__codelineno-3-54 name=__codelineno-3-54 href=#__codelineno-3-54></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-3-55><a id=__codelineno-3-55 name=__codelineno-3-55 href=#__codelineno-3-55></a>
</span><span id=__span-3-56><a id=__codelineno-3-56 name=__codelineno-3-56 href=#__codelineno-3-56></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;defaults granularity to months if not provided&quot;</span><span class=p>,</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-57><a id=__codelineno-3-57 name=__codelineno-3-57 href=#__codelineno-3-57></a><span class=w>      </span><span class=nx>vi</span><span class=p>.</span><span class=nx>mocked</span><span class=p>(</span><span class=nx>timelineService</span><span class=p>.</span><span class=nx>getDistribution</span><span class=p>).</span><span class=nx>mockResolvedValue</span><span class=p>([]);</span>
</span><span id=__span-3-58><a id=__codelineno-3-58 name=__codelineno-3-58 href=#__codelineno-3-58></a>
</span><span id=__span-3-59><a id=__codelineno-3-59 name=__codelineno-3-59 href=#__codelineno-3-59></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>req</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-60><a id=__codelineno-3-60 name=__codelineno-3-60 href=#__codelineno-3-60></a><span class=w>        </span><span class=nx>params</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>entityType</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;scene&quot;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-3-61><a id=__codelineno-3-61 name=__codelineno-3-61 href=#__codelineno-3-61></a><span class=w>        </span><span class=nx>query</span><span class=o>:</span><span class=w> </span><span class=p>{},</span>
</span><span id=__span-3-62><a id=__codelineno-3-62 name=__codelineno-3-62 href=#__codelineno-3-62></a><span class=w>        </span><span class=nx>user</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>id</span><span class=o>:</span><span class=w> </span><span class=kt>1</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-3-63><a id=__codelineno-3-63 name=__codelineno-3-63 href=#__codelineno-3-63></a><span class=w>      </span><span class=p>}</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>any</span><span class=p>;</span>
</span><span id=__span-3-64><a id=__codelineno-3-64 name=__codelineno-3-64 href=#__codelineno-3-64></a>
</span><span id=__span-3-65><a id=__codelineno-3-65 name=__codelineno-3-65 href=#__codelineno-3-65></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>res</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-66><a id=__codelineno-3-66 name=__codelineno-3-66 href=#__codelineno-3-66></a><span class=w>        </span><span class=nx>json</span><span class=o>:</span><span class=w> </span><span class=kt>vi.fn</span><span class=p>(),</span>
</span><span id=__span-3-67><a id=__codelineno-3-67 name=__codelineno-3-67 href=#__codelineno-3-67></a><span class=w>        </span><span class=nx>status</span><span class=o>:</span><span class=w> </span><span class=kt>vi.fn</span><span class=p>().</span><span class=nx>mockReturnThis</span><span class=p>(),</span>
</span><span id=__span-3-68><a id=__codelineno-3-68 name=__codelineno-3-68 href=#__codelineno-3-68></a><span class=w>      </span><span class=p>}</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>any</span><span class=p>;</span>
</span><span id=__span-3-69><a id=__codelineno-3-69 name=__codelineno-3-69 href=#__codelineno-3-69></a>
</span><span id=__span-3-70><a id=__codelineno-3-70 name=__codelineno-3-70 href=#__codelineno-3-70></a><span class=w>      </span><span class=k>await</span><span class=w> </span><span class=nx>getDateDistribution</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>);</span>
</span><span id=__span-3-71><a id=__codelineno-3-71 name=__codelineno-3-71 href=#__codelineno-3-71></a>
</span><span id=__span-3-72><a id=__codelineno-3-72 name=__codelineno-3-72 href=#__codelineno-3-72></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>timelineService</span><span class=p>.</span><span class=nx>getDistribution</span><span class=p>).</span><span class=nx>toHaveBeenCalledWith</span><span class=p>(</span><span class=s2>&quot;scene&quot;</span><span class=p>,</span><span class=w> </span><span class=mf>1</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;months&quot;</span><span class=p>);</span>
</span><span id=__span-3-73><a id=__codelineno-3-73 name=__codelineno-3-73 href=#__codelineno-3-73></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-3-74><a id=__codelineno-3-74 name=__codelineno-3-74 href=#__codelineno-3-74></a>
</span><span id=__span-3-75><a id=__codelineno-3-75 name=__codelineno-3-75 href=#__codelineno-3-75></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;returns 400 for invalid entity type&quot;</span><span class=p>,</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-76><a id=__codelineno-3-76 name=__codelineno-3-76 href=#__codelineno-3-76></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>req</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-77><a id=__codelineno-3-77 name=__codelineno-3-77 href=#__codelineno-3-77></a><span class=w>        </span><span class=nx>params</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>entityType</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;invalid&quot;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-3-78><a id=__codelineno-3-78 name=__codelineno-3-78 href=#__codelineno-3-78></a><span class=w>        </span><span class=nx>query</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>granularity</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;months&quot;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-3-79><a id=__codelineno-3-79 name=__codelineno-3-79 href=#__codelineno-3-79></a><span class=w>        </span><span class=nx>user</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>id</span><span class=o>:</span><span class=w> </span><span class=kt>1</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-3-80><a id=__codelineno-3-80 name=__codelineno-3-80 href=#__codelineno-3-80></a><span class=w>      </span><span class=p>}</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>any</span><span class=p>;</span>
</span><span id=__span-3-81><a id=__codelineno-3-81 name=__codelineno-3-81 href=#__codelineno-3-81></a>
</span><span id=__span-3-82><a id=__codelineno-3-82 name=__codelineno-3-82 href=#__codelineno-3-82></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>res</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-83><a id=__codelineno-3-83 name=__codelineno-3-83 href=#__codelineno-3-83></a><span class=w>        </span><span class=nx>json</span><span class=o>:</span><span class=w> </span><span class=kt>vi.fn</span><span class=p>(),</span>
</span><span id=__span-3-84><a id=__codelineno-3-84 name=__codelineno-3-84 href=#__codelineno-3-84></a><span class=w>        </span><span class=nx>status</span><span class=o>:</span><span class=w> </span><span class=kt>vi.fn</span><span class=p>().</span><span class=nx>mockReturnThis</span><span class=p>(),</span>
</span><span id=__span-3-85><a id=__codelineno-3-85 name=__codelineno-3-85 href=#__codelineno-3-85></a><span class=w>      </span><span class=p>}</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>any</span><span class=p>;</span>
</span><span id=__span-3-86><a id=__codelineno-3-86 name=__codelineno-3-86 href=#__codelineno-3-86></a>
</span><span id=__span-3-87><a id=__codelineno-3-87 name=__codelineno-3-87 href=#__codelineno-3-87></a><span class=w>      </span><span class=k>await</span><span class=w> </span><span class=nx>getDateDistribution</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>);</span>
</span><span id=__span-3-88><a id=__codelineno-3-88 name=__codelineno-3-88 href=#__codelineno-3-88></a>
</span><span id=__span-3-89><a id=__codelineno-3-89 name=__codelineno-3-89 href=#__codelineno-3-89></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>).</span><span class=nx>toHaveBeenCalledWith</span><span class=p>(</span><span class=mf>400</span><span class=p>);</span>
</span><span id=__span-3-90><a id=__codelineno-3-90 name=__codelineno-3-90 href=#__codelineno-3-90></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>).</span><span class=nx>toHaveBeenCalledWith</span><span class=p>({</span><span class=w> </span><span class=nx>error</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Invalid entity type&quot;</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-3-91><a id=__codelineno-3-91 name=__codelineno-3-91 href=#__codelineno-3-91></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-3-92><a id=__codelineno-3-92 name=__codelineno-3-92 href=#__codelineno-3-92></a>
</span><span id=__span-3-93><a id=__codelineno-3-93 name=__codelineno-3-93 href=#__codelineno-3-93></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;returns 400 for invalid granularity&quot;</span><span class=p>,</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-94><a id=__codelineno-3-94 name=__codelineno-3-94 href=#__codelineno-3-94></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>req</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-95><a id=__codelineno-3-95 name=__codelineno-3-95 href=#__codelineno-3-95></a><span class=w>        </span><span class=nx>params</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>entityType</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;scene&quot;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-3-96><a id=__codelineno-3-96 name=__codelineno-3-96 href=#__codelineno-3-96></a><span class=w>        </span><span class=nx>query</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>granularity</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;invalid&quot;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-3-97><a id=__codelineno-3-97 name=__codelineno-3-97 href=#__codelineno-3-97></a><span class=w>        </span><span class=nx>user</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>id</span><span class=o>:</span><span class=w> </span><span class=kt>1</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-3-98><a id=__codelineno-3-98 name=__codelineno-3-98 href=#__codelineno-3-98></a><span class=w>      </span><span class=p>}</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>any</span><span class=p>;</span>
</span><span id=__span-3-99><a id=__codelineno-3-99 name=__codelineno-3-99 href=#__codelineno-3-99></a>
</span><span id=__span-3-100><a id=__codelineno-3-100 name=__codelineno-3-100 href=#__codelineno-3-100></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>res</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-101><a id=__codelineno-3-101 name=__codelineno-3-101 href=#__codelineno-3-101></a><span class=w>        </span><span class=nx>json</span><span class=o>:</span><span class=w> </span><span class=kt>vi.fn</span><span class=p>(),</span>
</span><span id=__span-3-102><a id=__codelineno-3-102 name=__codelineno-3-102 href=#__codelineno-3-102></a><span class=w>        </span><span class=nx>status</span><span class=o>:</span><span class=w> </span><span class=kt>vi.fn</span><span class=p>().</span><span class=nx>mockReturnThis</span><span class=p>(),</span>
</span><span id=__span-3-103><a id=__codelineno-3-103 name=__codelineno-3-103 href=#__codelineno-3-103></a><span class=w>      </span><span class=p>}</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>any</span><span class=p>;</span>
</span><span id=__span-3-104><a id=__codelineno-3-104 name=__codelineno-3-104 href=#__codelineno-3-104></a>
</span><span id=__span-3-105><a id=__codelineno-3-105 name=__codelineno-3-105 href=#__codelineno-3-105></a><span class=w>      </span><span class=k>await</span><span class=w> </span><span class=nx>getDateDistribution</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>);</span>
</span><span id=__span-3-106><a id=__codelineno-3-106 name=__codelineno-3-106 href=#__codelineno-3-106></a>
</span><span id=__span-3-107><a id=__codelineno-3-107 name=__codelineno-3-107 href=#__codelineno-3-107></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>).</span><span class=nx>toHaveBeenCalledWith</span><span class=p>(</span><span class=mf>400</span><span class=p>);</span>
</span><span id=__span-3-108><a id=__codelineno-3-108 name=__codelineno-3-108 href=#__codelineno-3-108></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>).</span><span class=nx>toHaveBeenCalledWith</span><span class=p>({</span><span class=w> </span><span class=nx>error</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Invalid granularity&quot;</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-3-109><a id=__codelineno-3-109 name=__codelineno-3-109 href=#__codelineno-3-109></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-3-110><a id=__codelineno-3-110 name=__codelineno-3-110 href=#__codelineno-3-110></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-3-111><a id=__codelineno-3-111 name=__codelineno-3-111 href=#__codelineno-3-111></a><span class=p>});</span>
</span></code></pre></div> <p><strong>Step 2: Run test to verify it fails</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/server &amp;&amp; npm test -- tests/controllers/timelineController.test.ts</code> Expected: FAIL with "Cannot find module '../../controllers/timelineController.js'"</p> <p><strong>Step 3: Write minimal implementation</strong></p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1>// server/controllers/timelineController.ts</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=k>import</span><span class=w> </span><span class=kr>type</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>Response</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;express&quot;</span><span class=p>;</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=k>import</span><span class=w> </span><span class=kr>type</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>AuthenticatedRequest</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../middleware/auth.js&quot;</span><span class=p>;</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>timelineService</span><span class=p>,</span><span class=w> </span><span class=kr>type</span><span class=w> </span><span class=nx>Granularity</span><span class=p>,</span><span class=w> </span><span class=kr>type</span><span class=w> </span><span class=nx>TimelineEntityType</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../services/TimelineService.js&quot;</span><span class=p>;</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=kd>const</span><span class=w> </span><span class=nx>VALID_ENTITY_TYPES</span><span class=o>:</span><span class=w> </span><span class=kt>TimelineEntityType</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;scene&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;gallery&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;image&quot;</span><span class=p>];</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=kd>const</span><span class=w> </span><span class=nx>VALID_GRANULARITIES</span><span class=o>:</span><span class=w> </span><span class=kt>Granularity</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;years&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;months&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;weeks&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;days&quot;</span><span class=p>];</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=k>export</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>getDateDistribution</span><span class=p>(</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=w>  </span><span class=nx>req</span><span class=o>:</span><span class=w> </span><span class=kt>AuthenticatedRequest</span><span class=p>,</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=w>  </span><span class=nx>res</span><span class=o>:</span><span class=w> </span><span class=kt>Response</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=p>)</span><span class=o>:</span><span class=w> </span><span class=nb>Promise</span><span class=o>&lt;</span><span class=ow>void</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>entityType</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>;</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>granularity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>.</span><span class=nx>granularity</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=s2>&quot;months&quot;</span><span class=p>;</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>userId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>req</span><span class=p>.</span><span class=nx>user</span><span class=o>!</span><span class=p>.</span><span class=nx>id</span><span class=p>;</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>VALID_ENTITY_TYPES</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>entityType</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>TimelineEntityType</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a><span class=w>    </span><span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mf>400</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span><span class=w> </span><span class=nx>error</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Invalid entity type&quot;</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a><span class=w>    </span><span class=k>return</span><span class=p>;</span>
</span><span id=__span-4-20><a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-4-21><a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a>
</span><span id=__span-4-22><a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>VALID_GRANULARITIES</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>granularity</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>Granularity</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-23><a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a><span class=w>    </span><span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mf>400</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span><span class=w> </span><span class=nx>error</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Invalid granularity&quot;</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-4-24><a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a><span class=w>    </span><span class=k>return</span><span class=p>;</span>
</span><span id=__span-4-25><a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-4-26><a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a>
</span><span id=__span-4-27><a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a><span class=w>  </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-28><a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>distribution</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>timelineService</span><span class=p>.</span><span class=nx>getDistribution</span><span class=p>(</span>
</span><span id=__span-4-29><a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a><span class=w>      </span><span class=nx>entityType</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>TimelineEntityType</span><span class=p>,</span>
</span><span id=__span-4-30><a id=__codelineno-4-30 name=__codelineno-4-30 href=#__codelineno-4-30></a><span class=w>      </span><span class=nx>userId</span><span class=p>,</span>
</span><span id=__span-4-31><a id=__codelineno-4-31 name=__codelineno-4-31 href=#__codelineno-4-31></a><span class=w>      </span><span class=nx>granularity</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>Granularity</span>
</span><span id=__span-4-32><a id=__codelineno-4-32 name=__codelineno-4-32 href=#__codelineno-4-32></a><span class=w>    </span><span class=p>);</span>
</span><span id=__span-4-33><a id=__codelineno-4-33 name=__codelineno-4-33 href=#__codelineno-4-33></a><span class=w>    </span><span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span><span class=w> </span><span class=nx>distribution</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-4-34><a id=__codelineno-4-34 name=__codelineno-4-34 href=#__codelineno-4-34></a><span class=w>  </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-35><a id=__codelineno-4-35 name=__codelineno-4-35 href=#__codelineno-4-35></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s2>&quot;Error fetching date distribution:&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>error</span><span class=p>);</span>
</span><span id=__span-4-36><a id=__codelineno-4-36 name=__codelineno-4-36 href=#__codelineno-4-36></a><span class=w>    </span><span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mf>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span><span class=w> </span><span class=nx>error</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Failed to fetch date distribution&quot;</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-4-37><a id=__codelineno-4-37 name=__codelineno-4-37 href=#__codelineno-4-37></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-4-38><a id=__codelineno-4-38 name=__codelineno-4-38 href=#__codelineno-4-38></a><span class=p>}</span>
</span></code></pre></div> <p><strong>Step 4: Run test to verify it passes</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/server &amp;&amp; npm test -- tests/controllers/timelineController.test.ts</code> Expected: PASS</p> <p><strong>Step 5: Add route to api.ts</strong></p> <p>Locate the routes section in <code>server/routes/api.ts</code> and add:</p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1>// In imports section:</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>getDateDistribution</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../controllers/timelineController.js&quot;</span><span class=p>;</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=c1>// In routes section (near other library routes):</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&quot;/timeline/:entityType/distribution&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>authenticated</span><span class=p>(</span><span class=nx>getDateDistribution</span><span class=p>));</span>
</span></code></pre></div> <p><strong>Step 6: Run all server tests</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/server &amp;&amp; npm test</code> Expected: All tests PASS</p> <p><strong>Step 7: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>git<span class=w> </span>add<span class=w> </span>server/controllers/timelineController.ts<span class=w> </span>server/tests/controllers/timelineController.test.ts<span class=w> </span>server/routes/api.ts
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;feat(server): add timeline distribution endpoint&quot;</span>
</span></code></pre></div> <hr> <h2 id=task-3-frontend-usetimelinestate-hook>Task 3: Frontend - useTimelineState Hook<a class=headerlink href=#task-3-frontend-usetimelinestate-hook title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Create: <code>client/src/components/timeline/useTimelineState.js</code> - Test: <code>client/tests/hooks/useTimelineState.test.jsx</code></p> <p><strong>Step 1: Write the failing test</strong></p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c1>// client/tests/hooks/useTimelineState.test.jsx</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>renderHook</span><span class=p>,</span><span class=w> </span><span class=nx>waitFor</span><span class=p>,</span><span class=w> </span><span class=nx>act</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;@testing-library/react&quot;</span><span class=p>;</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>describe</span><span class=p>,</span><span class=w> </span><span class=nx>it</span><span class=p>,</span><span class=w> </span><span class=nx>expect</span><span class=p>,</span><span class=w> </span><span class=nx>vi</span><span class=p>,</span><span class=w> </span><span class=nx>beforeEach</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;vitest&quot;</span><span class=p>;</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useTimelineState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../src/components/timeline/useTimelineState.js&quot;</span><span class=p>;</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=nx>vi</span><span class=p>.</span><span class=nx>mock</span><span class=p>(</span><span class=s2>&quot;../../src/services/api.js&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>({</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=w>  </span><span class=nx>apiGet</span><span class=o>:</span><span class=w> </span><span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>(),</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=p>}));</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>apiGet</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../src/services/api.js&quot;</span><span class=p>;</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;useTimelineState&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=w>  </span><span class=nx>beforeEach</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=w>    </span><span class=nx>vi</span><span class=p>.</span><span class=nx>clearAllMocks</span><span class=p>();</span>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a>
</span><span id=__span-7-17><a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a><span class=w>  </span><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;initialization&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-18><a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;initializes with default zoom level of months&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-19><a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a><span class=w>      </span><span class=nx>apiGet</span><span class=p>.</span><span class=nx>mockResolvedValue</span><span class=p>({</span><span class=w> </span><span class=nx>distribution</span><span class=o>:</span><span class=w> </span><span class=p>[]</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-7-20><a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a>
</span><span id=__span-7-21><a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>result</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>renderHook</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span>
</span><span id=__span-7-22><a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a><span class=w>        </span><span class=nx>useTimelineState</span><span class=p>({</span><span class=w> </span><span class=nx>entityType</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;scene&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-7-23><a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a><span class=w>      </span><span class=p>);</span>
</span><span id=__span-7-24><a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a>
</span><span id=__span-7-25><a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>zoomLevel</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s2>&quot;months&quot;</span><span class=p>);</span>
</span><span id=__span-7-26><a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-7-27><a id=__codelineno-7-27 name=__codelineno-7-27 href=#__codelineno-7-27></a>
</span><span id=__span-7-28><a id=__codelineno-7-28 name=__codelineno-7-28 href=#__codelineno-7-28></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;initializes with no selected period&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-29><a id=__codelineno-7-29 name=__codelineno-7-29 href=#__codelineno-7-29></a><span class=w>      </span><span class=nx>apiGet</span><span class=p>.</span><span class=nx>mockResolvedValue</span><span class=p>({</span><span class=w> </span><span class=nx>distribution</span><span class=o>:</span><span class=w> </span><span class=p>[]</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-7-30><a id=__codelineno-7-30 name=__codelineno-7-30 href=#__codelineno-7-30></a>
</span><span id=__span-7-31><a id=__codelineno-7-31 name=__codelineno-7-31 href=#__codelineno-7-31></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>result</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>renderHook</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span>
</span><span id=__span-7-32><a id=__codelineno-7-32 name=__codelineno-7-32 href=#__codelineno-7-32></a><span class=w>        </span><span class=nx>useTimelineState</span><span class=p>({</span><span class=w> </span><span class=nx>entityType</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;scene&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-7-33><a id=__codelineno-7-33 name=__codelineno-7-33 href=#__codelineno-7-33></a><span class=w>      </span><span class=p>);</span>
</span><span id=__span-7-34><a id=__codelineno-7-34 name=__codelineno-7-34 href=#__codelineno-7-34></a>
</span><span id=__span-7-35><a id=__codelineno-7-35 name=__codelineno-7-35 href=#__codelineno-7-35></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>selectedPeriod</span><span class=p>).</span><span class=nx>toBeNull</span><span class=p>();</span>
</span><span id=__span-7-36><a id=__codelineno-7-36 name=__codelineno-7-36 href=#__codelineno-7-36></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-7-37><a id=__codelineno-7-37 name=__codelineno-7-37 href=#__codelineno-7-37></a>
</span><span id=__span-7-38><a id=__codelineno-7-38 name=__codelineno-7-38 href=#__codelineno-7-38></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;fetches distribution on mount&quot;</span><span class=p>,</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-39><a id=__codelineno-7-39 name=__codelineno-7-39 href=#__codelineno-7-39></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>mockDistribution</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-7-40><a id=__codelineno-7-40 name=__codelineno-7-40 href=#__codelineno-7-40></a><span class=w>        </span><span class=p>{</span><span class=w> </span><span class=nx>period</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2024-01&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=mf>47</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-7-41><a id=__codelineno-7-41 name=__codelineno-7-41 href=#__codelineno-7-41></a><span class=w>        </span><span class=p>{</span><span class=w> </span><span class=nx>period</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2024-02&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=mf>12</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-7-42><a id=__codelineno-7-42 name=__codelineno-7-42 href=#__codelineno-7-42></a><span class=w>      </span><span class=p>];</span>
</span><span id=__span-7-43><a id=__codelineno-7-43 name=__codelineno-7-43 href=#__codelineno-7-43></a><span class=w>      </span><span class=nx>apiGet</span><span class=p>.</span><span class=nx>mockResolvedValue</span><span class=p>({</span><span class=w> </span><span class=nx>distribution</span><span class=o>:</span><span class=w> </span><span class=nx>mockDistribution</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-7-44><a id=__codelineno-7-44 name=__codelineno-7-44 href=#__codelineno-7-44></a>
</span><span id=__span-7-45><a id=__codelineno-7-45 name=__codelineno-7-45 href=#__codelineno-7-45></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>result</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>renderHook</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span>
</span><span id=__span-7-46><a id=__codelineno-7-46 name=__codelineno-7-46 href=#__codelineno-7-46></a><span class=w>        </span><span class=nx>useTimelineState</span><span class=p>({</span><span class=w> </span><span class=nx>entityType</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;scene&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-7-47><a id=__codelineno-7-47 name=__codelineno-7-47 href=#__codelineno-7-47></a><span class=w>      </span><span class=p>);</span>
</span><span id=__span-7-48><a id=__codelineno-7-48 name=__codelineno-7-48 href=#__codelineno-7-48></a>
</span><span id=__span-7-49><a id=__codelineno-7-49 name=__codelineno-7-49 href=#__codelineno-7-49></a><span class=w>      </span><span class=k>await</span><span class=w> </span><span class=nx>waitFor</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-50><a id=__codelineno-7-50 name=__codelineno-7-50 href=#__codelineno-7-50></a><span class=w>        </span><span class=nx>expect</span><span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>distribution</span><span class=p>).</span><span class=nx>toEqual</span><span class=p>(</span><span class=nx>mockDistribution</span><span class=p>);</span>
</span><span id=__span-7-51><a id=__codelineno-7-51 name=__codelineno-7-51 href=#__codelineno-7-51></a><span class=w>      </span><span class=p>});</span>
</span><span id=__span-7-52><a id=__codelineno-7-52 name=__codelineno-7-52 href=#__codelineno-7-52></a>
</span><span id=__span-7-53><a id=__codelineno-7-53 name=__codelineno-7-53 href=#__codelineno-7-53></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>apiGet</span><span class=p>).</span><span class=nx>toHaveBeenCalledWith</span><span class=p>(</span><span class=s2>&quot;/timeline/scene/distribution?granularity=months&quot;</span><span class=p>);</span>
</span><span id=__span-7-54><a id=__codelineno-7-54 name=__codelineno-7-54 href=#__codelineno-7-54></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-7-55><a id=__codelineno-7-55 name=__codelineno-7-55 href=#__codelineno-7-55></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-7-56><a id=__codelineno-7-56 name=__codelineno-7-56 href=#__codelineno-7-56></a>
</span><span id=__span-7-57><a id=__codelineno-7-57 name=__codelineno-7-57 href=#__codelineno-7-57></a><span class=w>  </span><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;zoom level changes&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-58><a id=__codelineno-7-58 name=__codelineno-7-58 href=#__codelineno-7-58></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;updates zoom level and refetches distribution&quot;</span><span class=p>,</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-59><a id=__codelineno-7-59 name=__codelineno-7-59 href=#__codelineno-7-59></a><span class=w>      </span><span class=nx>apiGet</span><span class=p>.</span><span class=nx>mockResolvedValue</span><span class=p>({</span><span class=w> </span><span class=nx>distribution</span><span class=o>:</span><span class=w> </span><span class=p>[]</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-7-60><a id=__codelineno-7-60 name=__codelineno-7-60 href=#__codelineno-7-60></a>
</span><span id=__span-7-61><a id=__codelineno-7-61 name=__codelineno-7-61 href=#__codelineno-7-61></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>result</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>renderHook</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span>
</span><span id=__span-7-62><a id=__codelineno-7-62 name=__codelineno-7-62 href=#__codelineno-7-62></a><span class=w>        </span><span class=nx>useTimelineState</span><span class=p>({</span><span class=w> </span><span class=nx>entityType</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;scene&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-7-63><a id=__codelineno-7-63 name=__codelineno-7-63 href=#__codelineno-7-63></a><span class=w>      </span><span class=p>);</span>
</span><span id=__span-7-64><a id=__codelineno-7-64 name=__codelineno-7-64 href=#__codelineno-7-64></a>
</span><span id=__span-7-65><a id=__codelineno-7-65 name=__codelineno-7-65 href=#__codelineno-7-65></a><span class=w>      </span><span class=k>await</span><span class=w> </span><span class=nx>waitFor</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-66><a id=__codelineno-7-66 name=__codelineno-7-66 href=#__codelineno-7-66></a><span class=w>        </span><span class=nx>expect</span><span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>isLoading</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span><span id=__span-7-67><a id=__codelineno-7-67 name=__codelineno-7-67 href=#__codelineno-7-67></a><span class=w>      </span><span class=p>});</span>
</span><span id=__span-7-68><a id=__codelineno-7-68 name=__codelineno-7-68 href=#__codelineno-7-68></a>
</span><span id=__span-7-69><a id=__codelineno-7-69 name=__codelineno-7-69 href=#__codelineno-7-69></a><span class=w>      </span><span class=nx>act</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-70><a id=__codelineno-7-70 name=__codelineno-7-70 href=#__codelineno-7-70></a><span class=w>        </span><span class=nx>result</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>setZoomLevel</span><span class=p>(</span><span class=s2>&quot;years&quot;</span><span class=p>);</span>
</span><span id=__span-7-71><a id=__codelineno-7-71 name=__codelineno-7-71 href=#__codelineno-7-71></a><span class=w>      </span><span class=p>});</span>
</span><span id=__span-7-72><a id=__codelineno-7-72 name=__codelineno-7-72 href=#__codelineno-7-72></a>
</span><span id=__span-7-73><a id=__codelineno-7-73 name=__codelineno-7-73 href=#__codelineno-7-73></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>zoomLevel</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s2>&quot;years&quot;</span><span class=p>);</span>
</span><span id=__span-7-74><a id=__codelineno-7-74 name=__codelineno-7-74 href=#__codelineno-7-74></a>
</span><span id=__span-7-75><a id=__codelineno-7-75 name=__codelineno-7-75 href=#__codelineno-7-75></a><span class=w>      </span><span class=k>await</span><span class=w> </span><span class=nx>waitFor</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-76><a id=__codelineno-7-76 name=__codelineno-7-76 href=#__codelineno-7-76></a><span class=w>        </span><span class=nx>expect</span><span class=p>(</span><span class=nx>apiGet</span><span class=p>).</span><span class=nx>toHaveBeenCalledWith</span><span class=p>(</span><span class=s2>&quot;/timeline/scene/distribution?granularity=years&quot;</span><span class=p>);</span>
</span><span id=__span-7-77><a id=__codelineno-7-77 name=__codelineno-7-77 href=#__codelineno-7-77></a><span class=w>      </span><span class=p>});</span>
</span><span id=__span-7-78><a id=__codelineno-7-78 name=__codelineno-7-78 href=#__codelineno-7-78></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-7-79><a id=__codelineno-7-79 name=__codelineno-7-79 href=#__codelineno-7-79></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-7-80><a id=__codelineno-7-80 name=__codelineno-7-80 href=#__codelineno-7-80></a>
</span><span id=__span-7-81><a id=__codelineno-7-81 name=__codelineno-7-81 href=#__codelineno-7-81></a><span class=w>  </span><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;period selection&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-82><a id=__codelineno-7-82 name=__codelineno-7-82 href=#__codelineno-7-82></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;selects a period and calculates date range&quot;</span><span class=p>,</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-83><a id=__codelineno-7-83 name=__codelineno-7-83 href=#__codelineno-7-83></a><span class=w>      </span><span class=nx>apiGet</span><span class=p>.</span><span class=nx>mockResolvedValue</span><span class=p>({</span><span class=w> </span><span class=nx>distribution</span><span class=o>:</span><span class=w> </span><span class=p>[{</span><span class=w> </span><span class=nx>period</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2024-03&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=mf>47</span><span class=w> </span><span class=p>}]</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-7-84><a id=__codelineno-7-84 name=__codelineno-7-84 href=#__codelineno-7-84></a>
</span><span id=__span-7-85><a id=__codelineno-7-85 name=__codelineno-7-85 href=#__codelineno-7-85></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>result</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>renderHook</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span>
</span><span id=__span-7-86><a id=__codelineno-7-86 name=__codelineno-7-86 href=#__codelineno-7-86></a><span class=w>        </span><span class=nx>useTimelineState</span><span class=p>({</span><span class=w> </span><span class=nx>entityType</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;scene&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-7-87><a id=__codelineno-7-87 name=__codelineno-7-87 href=#__codelineno-7-87></a><span class=w>      </span><span class=p>);</span>
</span><span id=__span-7-88><a id=__codelineno-7-88 name=__codelineno-7-88 href=#__codelineno-7-88></a>
</span><span id=__span-7-89><a id=__codelineno-7-89 name=__codelineno-7-89 href=#__codelineno-7-89></a><span class=w>      </span><span class=k>await</span><span class=w> </span><span class=nx>waitFor</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-90><a id=__codelineno-7-90 name=__codelineno-7-90 href=#__codelineno-7-90></a><span class=w>        </span><span class=nx>expect</span><span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>isLoading</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span><span id=__span-7-91><a id=__codelineno-7-91 name=__codelineno-7-91 href=#__codelineno-7-91></a><span class=w>      </span><span class=p>});</span>
</span><span id=__span-7-92><a id=__codelineno-7-92 name=__codelineno-7-92 href=#__codelineno-7-92></a>
</span><span id=__span-7-93><a id=__codelineno-7-93 name=__codelineno-7-93 href=#__codelineno-7-93></a><span class=w>      </span><span class=nx>act</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-94><a id=__codelineno-7-94 name=__codelineno-7-94 href=#__codelineno-7-94></a><span class=w>        </span><span class=nx>result</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>selectPeriod</span><span class=p>(</span><span class=s2>&quot;2024-03&quot;</span><span class=p>);</span>
</span><span id=__span-7-95><a id=__codelineno-7-95 name=__codelineno-7-95 href=#__codelineno-7-95></a><span class=w>      </span><span class=p>});</span>
</span><span id=__span-7-96><a id=__codelineno-7-96 name=__codelineno-7-96 href=#__codelineno-7-96></a>
</span><span id=__span-7-97><a id=__codelineno-7-97 name=__codelineno-7-97 href=#__codelineno-7-97></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>selectedPeriod</span><span class=p>).</span><span class=nx>toEqual</span><span class=p>({</span>
</span><span id=__span-7-98><a id=__codelineno-7-98 name=__codelineno-7-98 href=#__codelineno-7-98></a><span class=w>        </span><span class=nx>period</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2024-03&quot;</span><span class=p>,</span>
</span><span id=__span-7-99><a id=__codelineno-7-99 name=__codelineno-7-99 href=#__codelineno-7-99></a><span class=w>        </span><span class=nx>start</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2024-03-01&quot;</span><span class=p>,</span>
</span><span id=__span-7-100><a id=__codelineno-7-100 name=__codelineno-7-100 href=#__codelineno-7-100></a><span class=w>        </span><span class=nx>end</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2024-03-31&quot;</span><span class=p>,</span>
</span><span id=__span-7-101><a id=__codelineno-7-101 name=__codelineno-7-101 href=#__codelineno-7-101></a><span class=w>        </span><span class=nx>label</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;March 2024&quot;</span><span class=p>,</span>
</span><span id=__span-7-102><a id=__codelineno-7-102 name=__codelineno-7-102 href=#__codelineno-7-102></a><span class=w>      </span><span class=p>});</span>
</span><span id=__span-7-103><a id=__codelineno-7-103 name=__codelineno-7-103 href=#__codelineno-7-103></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-7-104><a id=__codelineno-7-104 name=__codelineno-7-104 href=#__codelineno-7-104></a>
</span><span id=__span-7-105><a id=__codelineno-7-105 name=__codelineno-7-105 href=#__codelineno-7-105></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;clears selection when selecting same period&quot;</span><span class=p>,</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-106><a id=__codelineno-7-106 name=__codelineno-7-106 href=#__codelineno-7-106></a><span class=w>      </span><span class=nx>apiGet</span><span class=p>.</span><span class=nx>mockResolvedValue</span><span class=p>({</span><span class=w> </span><span class=nx>distribution</span><span class=o>:</span><span class=w> </span><span class=p>[{</span><span class=w> </span><span class=nx>period</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2024-03&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=mf>47</span><span class=w> </span><span class=p>}]</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-7-107><a id=__codelineno-7-107 name=__codelineno-7-107 href=#__codelineno-7-107></a>
</span><span id=__span-7-108><a id=__codelineno-7-108 name=__codelineno-7-108 href=#__codelineno-7-108></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>result</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>renderHook</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span>
</span><span id=__span-7-109><a id=__codelineno-7-109 name=__codelineno-7-109 href=#__codelineno-7-109></a><span class=w>        </span><span class=nx>useTimelineState</span><span class=p>({</span><span class=w> </span><span class=nx>entityType</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;scene&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-7-110><a id=__codelineno-7-110 name=__codelineno-7-110 href=#__codelineno-7-110></a><span class=w>      </span><span class=p>);</span>
</span><span id=__span-7-111><a id=__codelineno-7-111 name=__codelineno-7-111 href=#__codelineno-7-111></a>
</span><span id=__span-7-112><a id=__codelineno-7-112 name=__codelineno-7-112 href=#__codelineno-7-112></a><span class=w>      </span><span class=k>await</span><span class=w> </span><span class=nx>waitFor</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-113><a id=__codelineno-7-113 name=__codelineno-7-113 href=#__codelineno-7-113></a><span class=w>        </span><span class=nx>expect</span><span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>isLoading</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span><span id=__span-7-114><a id=__codelineno-7-114 name=__codelineno-7-114 href=#__codelineno-7-114></a><span class=w>      </span><span class=p>});</span>
</span><span id=__span-7-115><a id=__codelineno-7-115 name=__codelineno-7-115 href=#__codelineno-7-115></a>
</span><span id=__span-7-116><a id=__codelineno-7-116 name=__codelineno-7-116 href=#__codelineno-7-116></a><span class=w>      </span><span class=nx>act</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-117><a id=__codelineno-7-117 name=__codelineno-7-117 href=#__codelineno-7-117></a><span class=w>        </span><span class=nx>result</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>selectPeriod</span><span class=p>(</span><span class=s2>&quot;2024-03&quot;</span><span class=p>);</span>
</span><span id=__span-7-118><a id=__codelineno-7-118 name=__codelineno-7-118 href=#__codelineno-7-118></a><span class=w>      </span><span class=p>});</span>
</span><span id=__span-7-119><a id=__codelineno-7-119 name=__codelineno-7-119 href=#__codelineno-7-119></a>
</span><span id=__span-7-120><a id=__codelineno-7-120 name=__codelineno-7-120 href=#__codelineno-7-120></a><span class=w>      </span><span class=nx>act</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-121><a id=__codelineno-7-121 name=__codelineno-7-121 href=#__codelineno-7-121></a><span class=w>        </span><span class=nx>result</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>selectPeriod</span><span class=p>(</span><span class=s2>&quot;2024-03&quot;</span><span class=p>);</span>
</span><span id=__span-7-122><a id=__codelineno-7-122 name=__codelineno-7-122 href=#__codelineno-7-122></a><span class=w>      </span><span class=p>});</span>
</span><span id=__span-7-123><a id=__codelineno-7-123 name=__codelineno-7-123 href=#__codelineno-7-123></a>
</span><span id=__span-7-124><a id=__codelineno-7-124 name=__codelineno-7-124 href=#__codelineno-7-124></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>selectedPeriod</span><span class=p>).</span><span class=nx>toBeNull</span><span class=p>();</span>
</span><span id=__span-7-125><a id=__codelineno-7-125 name=__codelineno-7-125 href=#__codelineno-7-125></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-7-126><a id=__codelineno-7-126 name=__codelineno-7-126 href=#__codelineno-7-126></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-7-127><a id=__codelineno-7-127 name=__codelineno-7-127 href=#__codelineno-7-127></a>
</span><span id=__span-7-128><a id=__codelineno-7-128 name=__codelineno-7-128 href=#__codelineno-7-128></a><span class=w>  </span><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;auto-select most recent&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-129><a id=__codelineno-7-129 name=__codelineno-7-129 href=#__codelineno-7-129></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;auto-selects most recent period when autoSelectRecent is true&quot;</span><span class=p>,</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-130><a id=__codelineno-7-130 name=__codelineno-7-130 href=#__codelineno-7-130></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>mockDistribution</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-7-131><a id=__codelineno-7-131 name=__codelineno-7-131 href=#__codelineno-7-131></a><span class=w>        </span><span class=p>{</span><span class=w> </span><span class=nx>period</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2024-01&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=mf>10</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-7-132><a id=__codelineno-7-132 name=__codelineno-7-132 href=#__codelineno-7-132></a><span class=w>        </span><span class=p>{</span><span class=w> </span><span class=nx>period</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2024-03&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=mf>47</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-7-133><a id=__codelineno-7-133 name=__codelineno-7-133 href=#__codelineno-7-133></a><span class=w>      </span><span class=p>];</span>
</span><span id=__span-7-134><a id=__codelineno-7-134 name=__codelineno-7-134 href=#__codelineno-7-134></a><span class=w>      </span><span class=nx>apiGet</span><span class=p>.</span><span class=nx>mockResolvedValue</span><span class=p>({</span><span class=w> </span><span class=nx>distribution</span><span class=o>:</span><span class=w> </span><span class=nx>mockDistribution</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-7-135><a id=__codelineno-7-135 name=__codelineno-7-135 href=#__codelineno-7-135></a>
</span><span id=__span-7-136><a id=__codelineno-7-136 name=__codelineno-7-136 href=#__codelineno-7-136></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>result</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>renderHook</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span>
</span><span id=__span-7-137><a id=__codelineno-7-137 name=__codelineno-7-137 href=#__codelineno-7-137></a><span class=w>        </span><span class=nx>useTimelineState</span><span class=p>({</span><span class=w> </span><span class=nx>entityType</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;scene&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>autoSelectRecent</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-7-138><a id=__codelineno-7-138 name=__codelineno-7-138 href=#__codelineno-7-138></a><span class=w>      </span><span class=p>);</span>
</span><span id=__span-7-139><a id=__codelineno-7-139 name=__codelineno-7-139 href=#__codelineno-7-139></a>
</span><span id=__span-7-140><a id=__codelineno-7-140 name=__codelineno-7-140 href=#__codelineno-7-140></a><span class=w>      </span><span class=k>await</span><span class=w> </span><span class=nx>waitFor</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-141><a id=__codelineno-7-141 name=__codelineno-7-141 href=#__codelineno-7-141></a><span class=w>        </span><span class=nx>expect</span><span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>selectedPeriod</span><span class=p>).</span><span class=nx>not</span><span class=p>.</span><span class=nx>toBeNull</span><span class=p>();</span>
</span><span id=__span-7-142><a id=__codelineno-7-142 name=__codelineno-7-142 href=#__codelineno-7-142></a><span class=w>      </span><span class=p>});</span>
</span><span id=__span-7-143><a id=__codelineno-7-143 name=__codelineno-7-143 href=#__codelineno-7-143></a>
</span><span id=__span-7-144><a id=__codelineno-7-144 name=__codelineno-7-144 href=#__codelineno-7-144></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>selectedPeriod</span><span class=o>?</span><span class=p>.</span><span class=nx>period</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s2>&quot;2024-03&quot;</span><span class=p>);</span>
</span><span id=__span-7-145><a id=__codelineno-7-145 name=__codelineno-7-145 href=#__codelineno-7-145></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-7-146><a id=__codelineno-7-146 name=__codelineno-7-146 href=#__codelineno-7-146></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-7-147><a id=__codelineno-7-147 name=__codelineno-7-147 href=#__codelineno-7-147></a><span class=p>});</span>
</span></code></pre></div> <p><strong>Step 2: Run test to verify it fails</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/client &amp;&amp; npm test -- tests/hooks/useTimelineState.test.jsx</code> Expected: FAIL with "Cannot find module"</p> <p><strong>Step 3: Write minimal implementation</strong></p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1>// client/src/components/timeline/useTimelineState.js</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=p>,</span><span class=w> </span><span class=nx>useCallback</span><span class=p>,</span><span class=w> </span><span class=nx>useMemo</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>apiGet</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../services/api.js&quot;</span><span class=p>;</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=k>import</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=w>  </span><span class=nx>startOfYear</span><span class=p>,</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=w>  </span><span class=nx>endOfYear</span><span class=p>,</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=w>  </span><span class=nx>startOfMonth</span><span class=p>,</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=w>  </span><span class=nx>endOfMonth</span><span class=p>,</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=w>  </span><span class=nx>startOfWeek</span><span class=p>,</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=w>  </span><span class=nx>endOfWeek</span><span class=p>,</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=w>  </span><span class=nx>startOfDay</span><span class=p>,</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=w>  </span><span class=nx>endOfDay</span><span class=p>,</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=w>  </span><span class=nx>format</span><span class=p>,</span>
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=w>  </span><span class=nx>parse</span><span class=p>,</span>
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;date-fns&quot;</span><span class=p>;</span>
</span><span id=__span-8-16><a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a>
</span><span id=__span-8-17><a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class=kd>const</span><span class=w> </span><span class=nx>ZOOM_LEVELS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;years&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;months&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;weeks&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;days&quot;</span><span class=p>];</span>
</span><span id=__span-8-18><a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a>
</span><span id=__span-8-19><a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a><span class=kd>function</span><span class=w> </span><span class=nx>parsePeriodToDateRange</span><span class=p>(</span><span class=nx>period</span><span class=p>,</span><span class=w> </span><span class=nx>zoomLevel</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-20><a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a><span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=nx>start</span><span class=p>,</span><span class=w> </span><span class=nx>end</span><span class=p>,</span><span class=w> </span><span class=nx>label</span><span class=p>;</span>
</span><span id=__span-8-21><a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a>
</span><span id=__span-8-22><a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a><span class=w>  </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=nx>zoomLevel</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-23><a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;years&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-24><a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>date</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>parse</span><span class=p>(</span><span class=nx>period</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;yyyy&quot;</span><span class=p>,</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Date</span><span class=p>());</span>
</span><span id=__span-8-25><a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a><span class=w>      </span><span class=nx>start</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>format</span><span class=p>(</span><span class=nx>startOfYear</span><span class=p>(</span><span class=nx>date</span><span class=p>),</span><span class=w> </span><span class=s2>&quot;yyyy-MM-dd&quot;</span><span class=p>);</span>
</span><span id=__span-8-26><a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a><span class=w>      </span><span class=nx>end</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>format</span><span class=p>(</span><span class=nx>endOfYear</span><span class=p>(</span><span class=nx>date</span><span class=p>),</span><span class=w> </span><span class=s2>&quot;yyyy-MM-dd&quot;</span><span class=p>);</span>
</span><span id=__span-8-27><a id=__codelineno-8-27 name=__codelineno-8-27 href=#__codelineno-8-27></a><span class=w>      </span><span class=nx>label</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>period</span><span class=p>;</span>
</span><span id=__span-8-28><a id=__codelineno-8-28 name=__codelineno-8-28 href=#__codelineno-8-28></a><span class=w>      </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-8-29><a id=__codelineno-8-29 name=__codelineno-8-29 href=#__codelineno-8-29></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-8-30><a id=__codelineno-8-30 name=__codelineno-8-30 href=#__codelineno-8-30></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;months&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-31><a id=__codelineno-8-31 name=__codelineno-8-31 href=#__codelineno-8-31></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>date</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>parse</span><span class=p>(</span><span class=nx>period</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;yyyy-MM&quot;</span><span class=p>,</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Date</span><span class=p>());</span>
</span><span id=__span-8-32><a id=__codelineno-8-32 name=__codelineno-8-32 href=#__codelineno-8-32></a><span class=w>      </span><span class=nx>start</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>format</span><span class=p>(</span><span class=nx>startOfMonth</span><span class=p>(</span><span class=nx>date</span><span class=p>),</span><span class=w> </span><span class=s2>&quot;yyyy-MM-dd&quot;</span><span class=p>);</span>
</span><span id=__span-8-33><a id=__codelineno-8-33 name=__codelineno-8-33 href=#__codelineno-8-33></a><span class=w>      </span><span class=nx>end</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>format</span><span class=p>(</span><span class=nx>endOfMonth</span><span class=p>(</span><span class=nx>date</span><span class=p>),</span><span class=w> </span><span class=s2>&quot;yyyy-MM-dd&quot;</span><span class=p>);</span>
</span><span id=__span-8-34><a id=__codelineno-8-34 name=__codelineno-8-34 href=#__codelineno-8-34></a><span class=w>      </span><span class=nx>label</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>format</span><span class=p>(</span><span class=nx>date</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;MMMM yyyy&quot;</span><span class=p>);</span>
</span><span id=__span-8-35><a id=__codelineno-8-35 name=__codelineno-8-35 href=#__codelineno-8-35></a><span class=w>      </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-8-36><a id=__codelineno-8-36 name=__codelineno-8-36 href=#__codelineno-8-36></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-8-37><a id=__codelineno-8-37 name=__codelineno-8-37 href=#__codelineno-8-37></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;weeks&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-38><a id=__codelineno-8-38 name=__codelineno-8-38 href=#__codelineno-8-38></a><span class=w>      </span><span class=c1>// Format: &quot;2024-W12&quot;</span>
</span><span id=__span-8-39><a id=__codelineno-8-39 name=__codelineno-8-39 href=#__codelineno-8-39></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>year</span><span class=p>,</span><span class=w> </span><span class=nx>weekStr</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>period</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&quot;-W&quot;</span><span class=p>);</span>
</span><span id=__span-8-40><a id=__codelineno-8-40 name=__codelineno-8-40 href=#__codelineno-8-40></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>date</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>parse</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>year</span><span class=si>}</span><span class=sb>-W</span><span class=si>${</span><span class=nx>weekStr</span><span class=si>}</span><span class=sb>-1`</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;RRRR-&#39;W&#39;II-i&quot;</span><span class=p>,</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Date</span><span class=p>());</span>
</span><span id=__span-8-41><a id=__codelineno-8-41 name=__codelineno-8-41 href=#__codelineno-8-41></a><span class=w>      </span><span class=nx>start</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>format</span><span class=p>(</span><span class=nx>startOfWeek</span><span class=p>(</span><span class=nx>date</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>weekStartsOn</span><span class=o>:</span><span class=w> </span><span class=mf>1</span><span class=w> </span><span class=p>}),</span><span class=w> </span><span class=s2>&quot;yyyy-MM-dd&quot;</span><span class=p>);</span>
</span><span id=__span-8-42><a id=__codelineno-8-42 name=__codelineno-8-42 href=#__codelineno-8-42></a><span class=w>      </span><span class=nx>end</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>format</span><span class=p>(</span><span class=nx>endOfWeek</span><span class=p>(</span><span class=nx>date</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>weekStartsOn</span><span class=o>:</span><span class=w> </span><span class=mf>1</span><span class=w> </span><span class=p>}),</span><span class=w> </span><span class=s2>&quot;yyyy-MM-dd&quot;</span><span class=p>);</span>
</span><span id=__span-8-43><a id=__codelineno-8-43 name=__codelineno-8-43 href=#__codelineno-8-43></a><span class=w>      </span><span class=nx>label</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sb>`Week </span><span class=si>${</span><span class=nx>weekStr</span><span class=si>}</span><span class=sb>, </span><span class=si>${</span><span class=nx>year</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span><span id=__span-8-44><a id=__codelineno-8-44 name=__codelineno-8-44 href=#__codelineno-8-44></a><span class=w>      </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-8-45><a id=__codelineno-8-45 name=__codelineno-8-45 href=#__codelineno-8-45></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-8-46><a id=__codelineno-8-46 name=__codelineno-8-46 href=#__codelineno-8-46></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;days&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-47><a id=__codelineno-8-47 name=__codelineno-8-47 href=#__codelineno-8-47></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>date</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>parse</span><span class=p>(</span><span class=nx>period</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;yyyy-MM-dd&quot;</span><span class=p>,</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Date</span><span class=p>());</span>
</span><span id=__span-8-48><a id=__codelineno-8-48 name=__codelineno-8-48 href=#__codelineno-8-48></a><span class=w>      </span><span class=nx>start</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>format</span><span class=p>(</span><span class=nx>startOfDay</span><span class=p>(</span><span class=nx>date</span><span class=p>),</span><span class=w> </span><span class=s2>&quot;yyyy-MM-dd&quot;</span><span class=p>);</span>
</span><span id=__span-8-49><a id=__codelineno-8-49 name=__codelineno-8-49 href=#__codelineno-8-49></a><span class=w>      </span><span class=nx>end</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>format</span><span class=p>(</span><span class=nx>endOfDay</span><span class=p>(</span><span class=nx>date</span><span class=p>),</span><span class=w> </span><span class=s2>&quot;yyyy-MM-dd&quot;</span><span class=p>);</span>
</span><span id=__span-8-50><a id=__codelineno-8-50 name=__codelineno-8-50 href=#__codelineno-8-50></a><span class=w>      </span><span class=nx>label</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>format</span><span class=p>(</span><span class=nx>date</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;MMMM d, yyyy&quot;</span><span class=p>);</span>
</span><span id=__span-8-51><a id=__codelineno-8-51 name=__codelineno-8-51 href=#__codelineno-8-51></a><span class=w>      </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-8-52><a id=__codelineno-8-52 name=__codelineno-8-52 href=#__codelineno-8-52></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-8-53><a id=__codelineno-8-53 name=__codelineno-8-53 href=#__codelineno-8-53></a><span class=w>    </span><span class=k>default</span><span class=o>:</span>
</span><span id=__span-8-54><a id=__codelineno-8-54 name=__codelineno-8-54 href=#__codelineno-8-54></a><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span>
</span><span id=__span-8-55><a id=__codelineno-8-55 name=__codelineno-8-55 href=#__codelineno-8-55></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-8-56><a id=__codelineno-8-56 name=__codelineno-8-56 href=#__codelineno-8-56></a>
</span><span id=__span-8-57><a id=__codelineno-8-57 name=__codelineno-8-57 href=#__codelineno-8-57></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>period</span><span class=p>,</span><span class=w> </span><span class=nx>start</span><span class=p>,</span><span class=w> </span><span class=nx>end</span><span class=p>,</span><span class=w> </span><span class=nx>label</span><span class=w> </span><span class=p>};</span>
</span><span id=__span-8-58><a id=__codelineno-8-58 name=__codelineno-8-58 href=#__codelineno-8-58></a><span class=p>}</span>
</span><span id=__span-8-59><a id=__codelineno-8-59 name=__codelineno-8-59 href=#__codelineno-8-59></a>
</span><span id=__span-8-60><a id=__codelineno-8-60 name=__codelineno-8-60 href=#__codelineno-8-60></a><span class=k>export</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>useTimelineState</span><span class=p>({</span><span class=w> </span><span class=nx>entityType</span><span class=p>,</span><span class=w> </span><span class=nx>autoSelectRecent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-61><a id=__codelineno-8-61 name=__codelineno-8-61 href=#__codelineno-8-61></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>zoomLevel</span><span class=p>,</span><span class=w> </span><span class=nx>setZoomLevel</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;months&quot;</span><span class=p>);</span>
</span><span id=__span-8-62><a id=__codelineno-8-62 name=__codelineno-8-62 href=#__codelineno-8-62></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>selectedPeriod</span><span class=p>,</span><span class=w> </span><span class=nx>setSelectedPeriod</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span><span id=__span-8-63><a id=__codelineno-8-63 name=__codelineno-8-63 href=#__codelineno-8-63></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>distribution</span><span class=p>,</span><span class=w> </span><span class=nx>setDistribution</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>([]);</span>
</span><span id=__span-8-64><a id=__codelineno-8-64 name=__codelineno-8-64 href=#__codelineno-8-64></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>isLoading</span><span class=p>,</span><span class=w> </span><span class=nx>setIsLoading</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span><span id=__span-8-65><a id=__codelineno-8-65 name=__codelineno-8-65 href=#__codelineno-8-65></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>error</span><span class=p>,</span><span class=w> </span><span class=nx>setError</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span><span id=__span-8-66><a id=__codelineno-8-66 name=__codelineno-8-66 href=#__codelineno-8-66></a>
</span><span id=__span-8-67><a id=__codelineno-8-67 name=__codelineno-8-67 href=#__codelineno-8-67></a><span class=w>  </span><span class=c1>// Fetch distribution when entityType or zoomLevel changes</span>
</span><span id=__span-8-68><a id=__codelineno-8-68 name=__codelineno-8-68 href=#__codelineno-8-68></a><span class=w>  </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-69><a id=__codelineno-8-69 name=__codelineno-8-69 href=#__codelineno-8-69></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=nx>cancelled</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>;</span>
</span><span id=__span-8-70><a id=__codelineno-8-70 name=__codelineno-8-70 href=#__codelineno-8-70></a>
</span><span id=__span-8-71><a id=__codelineno-8-71 name=__codelineno-8-71 href=#__codelineno-8-71></a><span class=w>    </span><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>fetchDistribution</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-72><a id=__codelineno-8-72 name=__codelineno-8-72 href=#__codelineno-8-72></a><span class=w>      </span><span class=nx>setIsLoading</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span><span id=__span-8-73><a id=__codelineno-8-73 name=__codelineno-8-73 href=#__codelineno-8-73></a><span class=w>      </span><span class=nx>setError</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span><span id=__span-8-74><a id=__codelineno-8-74 name=__codelineno-8-74 href=#__codelineno-8-74></a>
</span><span id=__span-8-75><a id=__codelineno-8-75 name=__codelineno-8-75 href=#__codelineno-8-75></a><span class=w>      </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-76><a id=__codelineno-8-76 name=__codelineno-8-76 href=#__codelineno-8-76></a><span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>apiGet</span><span class=p>(</span>
</span><span id=__span-8-77><a id=__codelineno-8-77 name=__codelineno-8-77 href=#__codelineno-8-77></a><span class=w>          </span><span class=sb>`/timeline/</span><span class=si>${</span><span class=nx>entityType</span><span class=si>}</span><span class=sb>/distribution?granularity=</span><span class=si>${</span><span class=nx>zoomLevel</span><span class=si>}</span><span class=sb>`</span>
</span><span id=__span-8-78><a id=__codelineno-8-78 name=__codelineno-8-78 href=#__codelineno-8-78></a><span class=w>        </span><span class=p>);</span>
</span><span id=__span-8-79><a id=__codelineno-8-79 name=__codelineno-8-79 href=#__codelineno-8-79></a>
</span><span id=__span-8-80><a id=__codelineno-8-80 name=__codelineno-8-80 href=#__codelineno-8-80></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>cancelled</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-81><a id=__codelineno-8-81 name=__codelineno-8-81 href=#__codelineno-8-81></a><span class=w>          </span><span class=nx>setDistribution</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>distribution</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>[]);</span>
</span><span id=__span-8-82><a id=__codelineno-8-82 name=__codelineno-8-82 href=#__codelineno-8-82></a>
</span><span id=__span-8-83><a id=__codelineno-8-83 name=__codelineno-8-83 href=#__codelineno-8-83></a><span class=w>          </span><span class=c1>// Auto-select most recent period if enabled and no selection</span>
</span><span id=__span-8-84><a id=__codelineno-8-84 name=__codelineno-8-84 href=#__codelineno-8-84></a><span class=w>          </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>autoSelectRecent</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>response</span><span class=p>.</span><span class=nx>distribution</span><span class=o>?</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-85><a id=__codelineno-8-85 name=__codelineno-8-85 href=#__codelineno-8-85></a><span class=w>            </span><span class=kd>const</span><span class=w> </span><span class=nx>mostRecent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>response</span><span class=p>.</span><span class=nx>distribution</span><span class=p>[</span><span class=nx>response</span><span class=p>.</span><span class=nx>distribution</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mf>1</span><span class=p>];</span>
</span><span id=__span-8-86><a id=__codelineno-8-86 name=__codelineno-8-86 href=#__codelineno-8-86></a><span class=w>            </span><span class=nx>setSelectedPeriod</span><span class=p>(</span><span class=nx>parsePeriodToDateRange</span><span class=p>(</span><span class=nx>mostRecent</span><span class=p>.</span><span class=nx>period</span><span class=p>,</span><span class=w> </span><span class=nx>zoomLevel</span><span class=p>));</span>
</span><span id=__span-8-87><a id=__codelineno-8-87 name=__codelineno-8-87 href=#__codelineno-8-87></a><span class=w>          </span><span class=p>}</span>
</span><span id=__span-8-88><a id=__codelineno-8-88 name=__codelineno-8-88 href=#__codelineno-8-88></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-8-89><a id=__codelineno-8-89 name=__codelineno-8-89 href=#__codelineno-8-89></a><span class=w>      </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-90><a id=__codelineno-8-90 name=__codelineno-8-90 href=#__codelineno-8-90></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>cancelled</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-91><a id=__codelineno-8-91 name=__codelineno-8-91 href=#__codelineno-8-91></a><span class=w>          </span><span class=nx>setError</span><span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nx>message</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=s2>&quot;Failed to fetch distribution&quot;</span><span class=p>);</span>
</span><span id=__span-8-92><a id=__codelineno-8-92 name=__codelineno-8-92 href=#__codelineno-8-92></a><span class=w>          </span><span class=nx>setDistribution</span><span class=p>([]);</span>
</span><span id=__span-8-93><a id=__codelineno-8-93 name=__codelineno-8-93 href=#__codelineno-8-93></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-8-94><a id=__codelineno-8-94 name=__codelineno-8-94 href=#__codelineno-8-94></a><span class=w>      </span><span class=p>}</span><span class=w> </span><span class=k>finally</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-95><a id=__codelineno-8-95 name=__codelineno-8-95 href=#__codelineno-8-95></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>cancelled</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-96><a id=__codelineno-8-96 name=__codelineno-8-96 href=#__codelineno-8-96></a><span class=w>          </span><span class=nx>setIsLoading</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span><span id=__span-8-97><a id=__codelineno-8-97 name=__codelineno-8-97 href=#__codelineno-8-97></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-8-98><a id=__codelineno-8-98 name=__codelineno-8-98 href=#__codelineno-8-98></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-8-99><a id=__codelineno-8-99 name=__codelineno-8-99 href=#__codelineno-8-99></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-8-100><a id=__codelineno-8-100 name=__codelineno-8-100 href=#__codelineno-8-100></a>
</span><span id=__span-8-101><a id=__codelineno-8-101 name=__codelineno-8-101 href=#__codelineno-8-101></a><span class=w>    </span><span class=nx>fetchDistribution</span><span class=p>();</span>
</span><span id=__span-8-102><a id=__codelineno-8-102 name=__codelineno-8-102 href=#__codelineno-8-102></a>
</span><span id=__span-8-103><a id=__codelineno-8-103 name=__codelineno-8-103 href=#__codelineno-8-103></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-104><a id=__codelineno-8-104 name=__codelineno-8-104 href=#__codelineno-8-104></a><span class=w>      </span><span class=nx>cancelled</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span>
</span><span id=__span-8-105><a id=__codelineno-8-105 name=__codelineno-8-105 href=#__codelineno-8-105></a><span class=w>    </span><span class=p>};</span>
</span><span id=__span-8-106><a id=__codelineno-8-106 name=__codelineno-8-106 href=#__codelineno-8-106></a><span class=w>  </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>entityType</span><span class=p>,</span><span class=w> </span><span class=nx>zoomLevel</span><span class=p>,</span><span class=w> </span><span class=nx>autoSelectRecent</span><span class=p>]);</span>
</span><span id=__span-8-107><a id=__codelineno-8-107 name=__codelineno-8-107 href=#__codelineno-8-107></a>
</span><span id=__span-8-108><a id=__codelineno-8-108 name=__codelineno-8-108 href=#__codelineno-8-108></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>selectPeriod</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useCallback</span><span class=p>(</span>
</span><span id=__span-8-109><a id=__codelineno-8-109 name=__codelineno-8-109 href=#__codelineno-8-109></a><span class=w>    </span><span class=p>(</span><span class=nx>period</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-110><a id=__codelineno-8-110 name=__codelineno-8-110 href=#__codelineno-8-110></a><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>selectedPeriod</span><span class=o>?</span><span class=p>.</span><span class=nx>period</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=nx>period</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-111><a id=__codelineno-8-111 name=__codelineno-8-111 href=#__codelineno-8-111></a><span class=w>        </span><span class=nx>setSelectedPeriod</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span><span id=__span-8-112><a id=__codelineno-8-112 name=__codelineno-8-112 href=#__codelineno-8-112></a><span class=w>      </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-113><a id=__codelineno-8-113 name=__codelineno-8-113 href=#__codelineno-8-113></a><span class=w>        </span><span class=nx>setSelectedPeriod</span><span class=p>(</span><span class=nx>parsePeriodToDateRange</span><span class=p>(</span><span class=nx>period</span><span class=p>,</span><span class=w> </span><span class=nx>zoomLevel</span><span class=p>));</span>
</span><span id=__span-8-114><a id=__codelineno-8-114 name=__codelineno-8-114 href=#__codelineno-8-114></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-8-115><a id=__codelineno-8-115 name=__codelineno-8-115 href=#__codelineno-8-115></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-8-116><a id=__codelineno-8-116 name=__codelineno-8-116 href=#__codelineno-8-116></a><span class=w>    </span><span class=p>[</span><span class=nx>selectedPeriod</span><span class=p>,</span><span class=w> </span><span class=nx>zoomLevel</span><span class=p>]</span>
</span><span id=__span-8-117><a id=__codelineno-8-117 name=__codelineno-8-117 href=#__codelineno-8-117></a><span class=w>  </span><span class=p>);</span>
</span><span id=__span-8-118><a id=__codelineno-8-118 name=__codelineno-8-118 href=#__codelineno-8-118></a>
</span><span id=__span-8-119><a id=__codelineno-8-119 name=__codelineno-8-119 href=#__codelineno-8-119></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>clearSelection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useCallback</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-120><a id=__codelineno-8-120 name=__codelineno-8-120 href=#__codelineno-8-120></a><span class=w>    </span><span class=nx>setSelectedPeriod</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span><span id=__span-8-121><a id=__codelineno-8-121 name=__codelineno-8-121 href=#__codelineno-8-121></a><span class=w>  </span><span class=p>},</span><span class=w> </span><span class=p>[]);</span>
</span><span id=__span-8-122><a id=__codelineno-8-122 name=__codelineno-8-122 href=#__codelineno-8-122></a>
</span><span id=__span-8-123><a id=__codelineno-8-123 name=__codelineno-8-123 href=#__codelineno-8-123></a><span class=w>  </span><span class=c1>// Calculate max count for bar height scaling</span>
</span><span id=__span-8-124><a id=__codelineno-8-124 name=__codelineno-8-124 href=#__codelineno-8-124></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>maxCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useMemo</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-125><a id=__codelineno-8-125 name=__codelineno-8-125 href=#__codelineno-8-125></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>distribution</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=mf>0</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=mf>0</span><span class=p>;</span>
</span><span id=__span-8-126><a id=__codelineno-8-126 name=__codelineno-8-126 href=#__codelineno-8-126></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nb>Math</span><span class=p>.</span><span class=nx>max</span><span class=p>(...</span><span class=nx>distribution</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>d</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>count</span><span class=p>));</span>
</span><span id=__span-8-127><a id=__codelineno-8-127 name=__codelineno-8-127 href=#__codelineno-8-127></a><span class=w>  </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>distribution</span><span class=p>]);</span>
</span><span id=__span-8-128><a id=__codelineno-8-128 name=__codelineno-8-128 href=#__codelineno-8-128></a>
</span><span id=__span-8-129><a id=__codelineno-8-129 name=__codelineno-8-129 href=#__codelineno-8-129></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-130><a id=__codelineno-8-130 name=__codelineno-8-130 href=#__codelineno-8-130></a><span class=w>    </span><span class=nx>zoomLevel</span><span class=p>,</span>
</span><span id=__span-8-131><a id=__codelineno-8-131 name=__codelineno-8-131 href=#__codelineno-8-131></a><span class=w>    </span><span class=nx>setZoomLevel</span><span class=p>,</span>
</span><span id=__span-8-132><a id=__codelineno-8-132 name=__codelineno-8-132 href=#__codelineno-8-132></a><span class=w>    </span><span class=nx>selectedPeriod</span><span class=p>,</span>
</span><span id=__span-8-133><a id=__codelineno-8-133 name=__codelineno-8-133 href=#__codelineno-8-133></a><span class=w>    </span><span class=nx>selectPeriod</span><span class=p>,</span>
</span><span id=__span-8-134><a id=__codelineno-8-134 name=__codelineno-8-134 href=#__codelineno-8-134></a><span class=w>    </span><span class=nx>clearSelection</span><span class=p>,</span>
</span><span id=__span-8-135><a id=__codelineno-8-135 name=__codelineno-8-135 href=#__codelineno-8-135></a><span class=w>    </span><span class=nx>distribution</span><span class=p>,</span>
</span><span id=__span-8-136><a id=__codelineno-8-136 name=__codelineno-8-136 href=#__codelineno-8-136></a><span class=w>    </span><span class=nx>maxCount</span><span class=p>,</span>
</span><span id=__span-8-137><a id=__codelineno-8-137 name=__codelineno-8-137 href=#__codelineno-8-137></a><span class=w>    </span><span class=nx>isLoading</span><span class=p>,</span>
</span><span id=__span-8-138><a id=__codelineno-8-138 name=__codelineno-8-138 href=#__codelineno-8-138></a><span class=w>    </span><span class=nx>error</span><span class=p>,</span>
</span><span id=__span-8-139><a id=__codelineno-8-139 name=__codelineno-8-139 href=#__codelineno-8-139></a><span class=w>    </span><span class=nx>ZOOM_LEVELS</span><span class=p>,</span>
</span><span id=__span-8-140><a id=__codelineno-8-140 name=__codelineno-8-140 href=#__codelineno-8-140></a><span class=w>  </span><span class=p>};</span>
</span><span id=__span-8-141><a id=__codelineno-8-141 name=__codelineno-8-141 href=#__codelineno-8-141></a><span class=p>}</span>
</span></code></pre></div> <p><strong>Step 4: Run test to verify it passes</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/client &amp;&amp; npm test -- tests/hooks/useTimelineState.test.jsx</code> Expected: PASS</p> <p><strong>Step 5: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>git<span class=w> </span>add<span class=w> </span>client/src/components/timeline/useTimelineState.js<span class=w> </span>client/tests/hooks/useTimelineState.test.jsx
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;feat(client): add useTimelineState hook for timeline state management&quot;</span>
</span></code></pre></div> <hr> <h2 id=task-4-frontend-timelinecontrols-component>Task 4: Frontend - TimelineControls Component<a class=headerlink href=#task-4-frontend-timelinecontrols-component title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Create: <code>client/src/components/timeline/TimelineControls.jsx</code> - Test: <code>client/tests/components/timeline/TimelineControls.test.jsx</code></p> <p><strong>Step 1: Write the failing test</strong></p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c1>// client/tests/components/timeline/TimelineControls.test.jsx</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>describe</span><span class=p>,</span><span class=w> </span><span class=nx>it</span><span class=p>,</span><span class=w> </span><span class=nx>expect</span><span class=p>,</span><span class=w> </span><span class=nx>vi</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;vitest&quot;</span><span class=p>;</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>createElement</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=k>import</span><span class=w> </span><span class=nx>TimelineControls</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../../src/components/timeline/TimelineControls.jsx&quot;</span><span class=p>;</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;TimelineControls&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>defaultProps</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=w>    </span><span class=nx>zoomLevel</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;months&quot;</span><span class=p>,</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=w>    </span><span class=nx>onZoomLevelChange</span><span class=o>:</span><span class=w> </span><span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>(),</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=w>    </span><span class=nx>zoomLevels</span><span class=o>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;years&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;months&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;weeks&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;days&quot;</span><span class=p>],</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=w>  </span><span class=p>};</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;renders all zoom level buttons&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineControls</span><span class=p>,</span><span class=w> </span><span class=nx>defaultProps</span><span class=p>);</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>).</span><span class=nx>toBeDefined</span><span class=p>();</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>zoomLevel</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s2>&quot;months&quot;</span><span class=p>);</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>zoomLevels</span><span class=p>).</span><span class=nx>toHaveLength</span><span class=p>(</span><span class=mf>4</span><span class=p>);</span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a>
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;accepts onZoomLevelChange callback&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-10-22><a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>onZoomLevelChange</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>();</span>
</span><span id=__span-10-23><a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineControls</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-10-24><a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a><span class=w>      </span><span class=p>...</span><span class=nx>defaultProps</span><span class=p>,</span>
</span><span id=__span-10-25><a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a><span class=w>      </span><span class=nx>onZoomLevelChange</span><span class=p>,</span>
</span><span id=__span-10-26><a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-10-27><a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a>
</span><span id=__span-10-28><a id=__codelineno-10-28 name=__codelineno-10-28 href=#__codelineno-10-28></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>onZoomLevelChange</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=nx>onZoomLevelChange</span><span class=p>);</span>
</span><span id=__span-10-29><a id=__codelineno-10-29 name=__codelineno-10-29 href=#__codelineno-10-29></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-10-30><a id=__codelineno-10-30 name=__codelineno-10-30 href=#__codelineno-10-30></a>
</span><span id=__span-10-31><a id=__codelineno-10-31 name=__codelineno-10-31 href=#__codelineno-10-31></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;accepts custom className&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-10-32><a id=__codelineno-10-32 name=__codelineno-10-32 href=#__codelineno-10-32></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineControls</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-10-33><a id=__codelineno-10-33 name=__codelineno-10-33 href=#__codelineno-10-33></a><span class=w>      </span><span class=p>...</span><span class=nx>defaultProps</span><span class=p>,</span>
</span><span id=__span-10-34><a id=__codelineno-10-34 name=__codelineno-10-34 href=#__codelineno-10-34></a><span class=w>      </span><span class=nx>className</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;custom-class&quot;</span><span class=p>,</span>
</span><span id=__span-10-35><a id=__codelineno-10-35 name=__codelineno-10-35 href=#__codelineno-10-35></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-10-36><a id=__codelineno-10-36 name=__codelineno-10-36 href=#__codelineno-10-36></a>
</span><span id=__span-10-37><a id=__codelineno-10-37 name=__codelineno-10-37 href=#__codelineno-10-37></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>className</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s2>&quot;custom-class&quot;</span><span class=p>);</span>
</span><span id=__span-10-38><a id=__codelineno-10-38 name=__codelineno-10-38 href=#__codelineno-10-38></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-10-39><a id=__codelineno-10-39 name=__codelineno-10-39 href=#__codelineno-10-39></a><span class=p>});</span>
</span></code></pre></div> <p><strong>Step 2: Run test to verify it fails</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/client &amp;&amp; npm test -- tests/components/timeline/TimelineControls.test.jsx</code> Expected: FAIL with "Cannot find module"</p> <p><strong>Step 3: Write minimal implementation</strong></p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=c1>// client/src/components/timeline/TimelineControls.jsx</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>memo</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=kd>const</span><span class=w> </span><span class=nx>ZOOM_LABELS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=w>  </span><span class=nx>years</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Years&quot;</span><span class=p>,</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=w>  </span><span class=nx>months</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Months&quot;</span><span class=p>,</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=w>  </span><span class=nx>weeks</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Weeks&quot;</span><span class=p>,</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=w>  </span><span class=nx>days</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Days&quot;</span><span class=p>,</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=p>};</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=kd>function</span><span class=w> </span><span class=nx>TimelineControls</span><span class=p>({</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=w>  </span><span class=nx>zoomLevel</span><span class=p>,</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=w>  </span><span class=nx>onZoomLevelChange</span><span class=p>,</span>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=w>  </span><span class=nx>zoomLevels</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;years&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;months&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;weeks&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;days&quot;</span><span class=p>],</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=w>  </span><span class=nx>className</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=p>})</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-17><a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-11-18><a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=w>    </span><span class=o>&lt;</span><span class=nx>div</span>
</span><span id=__span-11-19><a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a><span class=w>      </span><span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=sb>`inline-flex rounded-md bg-bg-secondary </span><span class=si>${</span><span class=nx>className</span><span class=si>}</span><span class=sb>`</span><span class=p>}</span>
</span><span id=__span-11-20><a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a><span class=w>      </span><span class=nx>role</span><span class=o>=</span><span class=s2>&quot;group&quot;</span>
</span><span id=__span-11-21><a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a><span class=w>      </span><span class=nx>aria</span><span class=o>-</span><span class=nx>label</span><span class=o>=</span><span class=s2>&quot;Timeline zoom level&quot;</span>
</span><span id=__span-11-22><a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a><span class=w>    </span><span class=o>&gt;</span>
</span><span id=__span-11-23><a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a><span class=w>      </span><span class=p>{</span><span class=nx>zoomLevels</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>level</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-11-24><a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a><span class=w>        </span><span class=o>&lt;</span><span class=nx>button</span>
</span><span id=__span-11-25><a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a><span class=w>          </span><span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>level</span><span class=p>}</span>
</span><span id=__span-11-26><a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a><span class=w>          </span><span class=nx>type</span><span class=o>=</span><span class=s2>&quot;button&quot;</span>
</span><span id=__span-11-27><a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a><span class=w>          </span><span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>onZoomLevelChange</span><span class=p>(</span><span class=nx>level</span><span class=p>)}</span>
</span><span id=__span-11-28><a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a><span class=w>          </span><span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=sb>`</span>
</span><span id=__span-11-29><a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a><span class=sb>            px-3 py-1.5 text-sm font-medium transition-colors</span>
</span><span id=__span-11-30><a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a><span class=sb>            first:rounded-l-md last:rounded-r-md</span>
</span><span id=__span-11-31><a id=__codelineno-11-31 name=__codelineno-11-31 href=#__codelineno-11-31></a><span class=sb>            focus:outline-none focus:ring-2 focus:ring-accent-primary focus:ring-inset</span>
</span><span id=__span-11-32><a id=__codelineno-11-32 name=__codelineno-11-32 href=#__codelineno-11-32></a><span class=sb>            </span><span class=si>${</span>
</span><span id=__span-11-33><a id=__codelineno-11-33 name=__codelineno-11-33 href=#__codelineno-11-33></a><span class=w>              </span><span class=nx>zoomLevel</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=nx>level</span>
</span><span id=__span-11-34><a id=__codelineno-11-34 name=__codelineno-11-34 href=#__codelineno-11-34></a><span class=w>                </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;bg-accent-primary text-white&quot;</span>
</span><span id=__span-11-35><a id=__codelineno-11-35 name=__codelineno-11-35 href=#__codelineno-11-35></a><span class=w>                </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;text-text-secondary hover:text-text-primary hover:bg-bg-tertiary&quot;</span>
</span><span id=__span-11-36><a id=__codelineno-11-36 name=__codelineno-11-36 href=#__codelineno-11-36></a><span class=w>            </span><span class=si>}</span>
</span><span id=__span-11-37><a id=__codelineno-11-37 name=__codelineno-11-37 href=#__codelineno-11-37></a><span class=sb>          `</span><span class=p>}</span>
</span><span id=__span-11-38><a id=__codelineno-11-38 name=__codelineno-11-38 href=#__codelineno-11-38></a><span class=w>          </span><span class=nx>aria</span><span class=o>-</span><span class=nx>pressed</span><span class=o>=</span><span class=p>{</span><span class=nx>zoomLevel</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=nx>level</span><span class=p>}</span>
</span><span id=__span-11-39><a id=__codelineno-11-39 name=__codelineno-11-39 href=#__codelineno-11-39></a><span class=w>        </span><span class=o>&gt;</span>
</span><span id=__span-11-40><a id=__codelineno-11-40 name=__codelineno-11-40 href=#__codelineno-11-40></a><span class=w>          </span><span class=p>{</span><span class=nx>ZOOM_LABELS</span><span class=p>[</span><span class=nx>level</span><span class=p>]</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nx>level</span><span class=p>}</span>
</span><span id=__span-11-41><a id=__codelineno-11-41 name=__codelineno-11-41 href=#__codelineno-11-41></a><span class=w>        </span><span class=o>&lt;</span><span class=err>/button&gt;</span>
</span><span id=__span-11-42><a id=__codelineno-11-42 name=__codelineno-11-42 href=#__codelineno-11-42></a><span class=w>      </span><span class=p>))}</span>
</span><span id=__span-11-43><a id=__codelineno-11-43 name=__codelineno-11-43 href=#__codelineno-11-43></a><span class=w>    </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span><span id=__span-11-44><a id=__codelineno-11-44 name=__codelineno-11-44 href=#__codelineno-11-44></a><span class=w>  </span><span class=p>);</span>
</span><span id=__span-11-45><a id=__codelineno-11-45 name=__codelineno-11-45 href=#__codelineno-11-45></a><span class=p>}</span>
</span><span id=__span-11-46><a id=__codelineno-11-46 name=__codelineno-11-46 href=#__codelineno-11-46></a>
</span><span id=__span-11-47><a id=__codelineno-11-47 name=__codelineno-11-47 href=#__codelineno-11-47></a><span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=nx>memo</span><span class=p>(</span><span class=nx>TimelineControls</span><span class=p>);</span>
</span></code></pre></div> <p><strong>Step 4: Run test to verify it passes</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/client &amp;&amp; npm test -- tests/components/timeline/TimelineControls.test.jsx</code> Expected: PASS</p> <p><strong>Step 5: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>git<span class=w> </span>add<span class=w> </span>client/src/components/timeline/TimelineControls.jsx<span class=w> </span>client/tests/components/timeline/TimelineControls.test.jsx
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;feat(client): add TimelineControls zoom level toggle component&quot;</span>
</span></code></pre></div> <hr> <h2 id=task-5-frontend-timelinebar-component>Task 5: Frontend - TimelineBar Component<a class=headerlink href=#task-5-frontend-timelinebar-component title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Create: <code>client/src/components/timeline/TimelineBar.jsx</code> - Test: <code>client/tests/components/timeline/TimelineBar.test.jsx</code></p> <p><strong>Step 1: Write the failing test</strong></p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=c1>// client/tests/components/timeline/TimelineBar.test.jsx</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>describe</span><span class=p>,</span><span class=w> </span><span class=nx>it</span><span class=p>,</span><span class=w> </span><span class=nx>expect</span><span class=p>,</span><span class=w> </span><span class=nx>vi</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;vitest&quot;</span><span class=p>;</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>createElement</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=k>import</span><span class=w> </span><span class=nx>TimelineBar</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../../src/components/timeline/TimelineBar.jsx&quot;</span><span class=p>;</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;TimelineBar&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>defaultProps</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=w>    </span><span class=nx>period</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2024-03&quot;</span><span class=p>,</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=w>    </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=mf>47</span><span class=p>,</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=w>    </span><span class=nx>maxCount</span><span class=o>:</span><span class=w> </span><span class=mf>100</span><span class=p>,</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=w>    </span><span class=nx>isSelected</span><span class=o>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=w>    </span><span class=nx>isFocused</span><span class=o>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=w>    </span><span class=nx>onClick</span><span class=o>:</span><span class=w> </span><span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>(),</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=w>    </span><span class=nx>label</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;March 2024&quot;</span><span class=p>,</span>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=w>  </span><span class=p>};</span>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a>
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;renders with correct period and count&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-18><a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineBar</span><span class=p>,</span><span class=w> </span><span class=nx>defaultProps</span><span class=p>);</span>
</span><span id=__span-13-19><a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a>
</span><span id=__span-13-20><a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>).</span><span class=nx>toBeDefined</span><span class=p>();</span>
</span><span id=__span-13-21><a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>period</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s2>&quot;2024-03&quot;</span><span class=p>);</span>
</span><span id=__span-13-22><a id=__codelineno-13-22 name=__codelineno-13-22 href=#__codelineno-13-22></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>count</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=mf>47</span><span class=p>);</span>
</span><span id=__span-13-23><a id=__codelineno-13-23 name=__codelineno-13-23 href=#__codelineno-13-23></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-13-24><a id=__codelineno-13-24 name=__codelineno-13-24 href=#__codelineno-13-24></a>
</span><span id=__span-13-25><a id=__codelineno-13-25 name=__codelineno-13-25 href=#__codelineno-13-25></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;calculates height percentage from count and maxCount&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-26><a id=__codelineno-13-26 name=__codelineno-13-26 href=#__codelineno-13-26></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineBar</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-27><a id=__codelineno-13-27 name=__codelineno-13-27 href=#__codelineno-13-27></a><span class=w>      </span><span class=p>...</span><span class=nx>defaultProps</span><span class=p>,</span>
</span><span id=__span-13-28><a id=__codelineno-13-28 name=__codelineno-13-28 href=#__codelineno-13-28></a><span class=w>      </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=mf>50</span><span class=p>,</span>
</span><span id=__span-13-29><a id=__codelineno-13-29 name=__codelineno-13-29 href=#__codelineno-13-29></a><span class=w>      </span><span class=nx>maxCount</span><span class=o>:</span><span class=w> </span><span class=mf>100</span><span class=p>,</span>
</span><span id=__span-13-30><a id=__codelineno-13-30 name=__codelineno-13-30 href=#__codelineno-13-30></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-13-31><a id=__codelineno-13-31 name=__codelineno-13-31 href=#__codelineno-13-31></a>
</span><span id=__span-13-32><a id=__codelineno-13-32 name=__codelineno-13-32 href=#__codelineno-13-32></a><span class=w>    </span><span class=c1>// Height should be 50% of max</span>
</span><span id=__span-13-33><a id=__codelineno-13-33 name=__codelineno-13-33 href=#__codelineno-13-33></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>count</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>maxCount</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=mf>0.5</span><span class=p>);</span>
</span><span id=__span-13-34><a id=__codelineno-13-34 name=__codelineno-13-34 href=#__codelineno-13-34></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-13-35><a id=__codelineno-13-35 name=__codelineno-13-35 href=#__codelineno-13-35></a>
</span><span id=__span-13-36><a id=__codelineno-13-36 name=__codelineno-13-36 href=#__codelineno-13-36></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;accepts isSelected prop for highlight styling&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-37><a id=__codelineno-13-37 name=__codelineno-13-37 href=#__codelineno-13-37></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineBar</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-38><a id=__codelineno-13-38 name=__codelineno-13-38 href=#__codelineno-13-38></a><span class=w>      </span><span class=p>...</span><span class=nx>defaultProps</span><span class=p>,</span>
</span><span id=__span-13-39><a id=__codelineno-13-39 name=__codelineno-13-39 href=#__codelineno-13-39></a><span class=w>      </span><span class=nx>isSelected</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
</span><span id=__span-13-40><a id=__codelineno-13-40 name=__codelineno-13-40 href=#__codelineno-13-40></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-13-41><a id=__codelineno-13-41 name=__codelineno-13-41 href=#__codelineno-13-41></a>
</span><span id=__span-13-42><a id=__codelineno-13-42 name=__codelineno-13-42 href=#__codelineno-13-42></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>isSelected</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span><span id=__span-13-43><a id=__codelineno-13-43 name=__codelineno-13-43 href=#__codelineno-13-43></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-13-44><a id=__codelineno-13-44 name=__codelineno-13-44 href=#__codelineno-13-44></a>
</span><span id=__span-13-45><a id=__codelineno-13-45 name=__codelineno-13-45 href=#__codelineno-13-45></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;accepts isFocused prop for keyboard navigation&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-46><a id=__codelineno-13-46 name=__codelineno-13-46 href=#__codelineno-13-46></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineBar</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-47><a id=__codelineno-13-47 name=__codelineno-13-47 href=#__codelineno-13-47></a><span class=w>      </span><span class=p>...</span><span class=nx>defaultProps</span><span class=p>,</span>
</span><span id=__span-13-48><a id=__codelineno-13-48 name=__codelineno-13-48 href=#__codelineno-13-48></a><span class=w>      </span><span class=nx>isFocused</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
</span><span id=__span-13-49><a id=__codelineno-13-49 name=__codelineno-13-49 href=#__codelineno-13-49></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-13-50><a id=__codelineno-13-50 name=__codelineno-13-50 href=#__codelineno-13-50></a>
</span><span id=__span-13-51><a id=__codelineno-13-51 name=__codelineno-13-51 href=#__codelineno-13-51></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>isFocused</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span><span id=__span-13-52><a id=__codelineno-13-52 name=__codelineno-13-52 href=#__codelineno-13-52></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-13-53><a id=__codelineno-13-53 name=__codelineno-13-53 href=#__codelineno-13-53></a>
</span><span id=__span-13-54><a id=__codelineno-13-54 name=__codelineno-13-54 href=#__codelineno-13-54></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;accepts onClick callback&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-55><a id=__codelineno-13-55 name=__codelineno-13-55 href=#__codelineno-13-55></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>onClick</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>();</span>
</span><span id=__span-13-56><a id=__codelineno-13-56 name=__codelineno-13-56 href=#__codelineno-13-56></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineBar</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-57><a id=__codelineno-13-57 name=__codelineno-13-57 href=#__codelineno-13-57></a><span class=w>      </span><span class=p>...</span><span class=nx>defaultProps</span><span class=p>,</span>
</span><span id=__span-13-58><a id=__codelineno-13-58 name=__codelineno-13-58 href=#__codelineno-13-58></a><span class=w>      </span><span class=nx>onClick</span><span class=p>,</span>
</span><span id=__span-13-59><a id=__codelineno-13-59 name=__codelineno-13-59 href=#__codelineno-13-59></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-13-60><a id=__codelineno-13-60 name=__codelineno-13-60 href=#__codelineno-13-60></a>
</span><span id=__span-13-61><a id=__codelineno-13-61 name=__codelineno-13-61 href=#__codelineno-13-61></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>onClick</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=nx>onClick</span><span class=p>);</span>
</span><span id=__span-13-62><a id=__codelineno-13-62 name=__codelineno-13-62 href=#__codelineno-13-62></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-13-63><a id=__codelineno-13-63 name=__codelineno-13-63 href=#__codelineno-13-63></a><span class=p>});</span>
</span></code></pre></div> <p><strong>Step 2: Run test to verify it fails</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/client &amp;&amp; npm test -- tests/components/timeline/TimelineBar.test.jsx</code> Expected: FAIL with "Cannot find module"</p> <p><strong>Step 3: Write minimal implementation</strong></p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=c1>// client/src/components/timeline/TimelineBar.jsx</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>memo</span><span class=p>,</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=kd>const</span><span class=w> </span><span class=nx>MIN_BAR_HEIGHT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>4</span><span class=p>;</span><span class=w> </span><span class=c1>// Minimum visible height in pixels</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=kd>const</span><span class=w> </span><span class=nx>MAX_BAR_HEIGHT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>60</span><span class=p>;</span><span class=w> </span><span class=c1>// Maximum bar height in pixels</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=kd>function</span><span class=w> </span><span class=nx>TimelineBar</span><span class=p>({</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=w>  </span><span class=nx>period</span><span class=p>,</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=w>  </span><span class=nx>count</span><span class=p>,</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=w>  </span><span class=nx>maxCount</span><span class=p>,</span>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=w>  </span><span class=nx>isSelected</span><span class=p>,</span>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=w>  </span><span class=nx>isFocused</span><span class=p>,</span>
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=w>  </span><span class=nx>onClick</span><span class=p>,</span>
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=w>  </span><span class=nx>label</span><span class=p>,</span>
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a><span class=w>  </span><span class=nx>onKeyDown</span><span class=p>,</span>
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a><span class=w>  </span><span class=nx>tabIndex</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>-</span><span class=mf>1</span><span class=p>,</span>
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a><span class=p>})</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-14-18><a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>showTooltip</span><span class=p>,</span><span class=w> </span><span class=nx>setShowTooltip</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span><span id=__span-14-19><a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a>
</span><span id=__span-14-20><a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a><span class=w>  </span><span class=c1>// Calculate bar height as percentage of max, with minimum visibility</span>
</span><span id=__span-14-21><a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>heightPercent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>maxCount</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>0</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=p>(</span><span class=nx>count</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=nx>maxCount</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>100</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=p>;</span>
</span><span id=__span-14-22><a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>barHeight</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Math</span><span class=p>.</span><span class=nx>max</span><span class=p>(</span>
</span><span id=__span-14-23><a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a><span class=w>    </span><span class=nx>MIN_BAR_HEIGHT</span><span class=p>,</span>
</span><span id=__span-14-24><a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a><span class=w>    </span><span class=p>(</span><span class=nx>heightPercent</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mf>100</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>MAX_BAR_HEIGHT</span>
</span><span id=__span-14-25><a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a><span class=w>  </span><span class=p>);</span>
</span><span id=__span-14-26><a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a>
</span><span id=__span-14-27><a id=__codelineno-14-27 name=__codelineno-14-27 href=#__codelineno-14-27></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-14-28><a id=__codelineno-14-28 name=__codelineno-14-28 href=#__codelineno-14-28></a><span class=w>    </span><span class=o>&lt;</span><span class=nx>div</span>
</span><span id=__span-14-29><a id=__codelineno-14-29 name=__codelineno-14-29 href=#__codelineno-14-29></a><span class=w>      </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;relative flex flex-col items-center cursor-pointer group&quot;</span>
</span><span id=__span-14-30><a id=__codelineno-14-30 name=__codelineno-14-30 href=#__codelineno-14-30></a><span class=w>      </span><span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>onClick</span><span class=p>(</span><span class=nx>period</span><span class=p>)}</span>
</span><span id=__span-14-31><a id=__codelineno-14-31 name=__codelineno-14-31 href=#__codelineno-14-31></a><span class=w>      </span><span class=nx>onKeyDown</span><span class=o>=</span><span class=p>{</span><span class=nx>onKeyDown</span><span class=p>}</span>
</span><span id=__span-14-32><a id=__codelineno-14-32 name=__codelineno-14-32 href=#__codelineno-14-32></a><span class=w>      </span><span class=nx>onMouseEnter</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setShowTooltip</span><span class=p>(</span><span class=kc>true</span><span class=p>)}</span>
</span><span id=__span-14-33><a id=__codelineno-14-33 name=__codelineno-14-33 href=#__codelineno-14-33></a><span class=w>      </span><span class=nx>onMouseLeave</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setShowTooltip</span><span class=p>(</span><span class=kc>false</span><span class=p>)}</span>
</span><span id=__span-14-34><a id=__codelineno-14-34 name=__codelineno-14-34 href=#__codelineno-14-34></a><span class=w>      </span><span class=nx>role</span><span class=o>=</span><span class=s2>&quot;option&quot;</span>
</span><span id=__span-14-35><a id=__codelineno-14-35 name=__codelineno-14-35 href=#__codelineno-14-35></a><span class=w>      </span><span class=nx>aria</span><span class=o>-</span><span class=nx>selected</span><span class=o>=</span><span class=p>{</span><span class=nx>isSelected</span><span class=p>}</span>
</span><span id=__span-14-36><a id=__codelineno-14-36 name=__codelineno-14-36 href=#__codelineno-14-36></a><span class=w>      </span><span class=nx>aria</span><span class=o>-</span><span class=nx>label</span><span class=o>=</span><span class=p>{</span><span class=sb>`</span><span class=si>${</span><span class=nx>label</span><span class=si>}</span><span class=sb>: </span><span class=si>${</span><span class=nx>count</span><span class=si>}</span><span class=sb> items`</span><span class=p>}</span>
</span><span id=__span-14-37><a id=__codelineno-14-37 name=__codelineno-14-37 href=#__codelineno-14-37></a><span class=w>      </span><span class=nx>tabIndex</span><span class=o>=</span><span class=p>{</span><span class=nx>tabIndex</span><span class=p>}</span>
</span><span id=__span-14-38><a id=__codelineno-14-38 name=__codelineno-14-38 href=#__codelineno-14-38></a><span class=w>    </span><span class=o>&gt;</span>
</span><span id=__span-14-39><a id=__codelineno-14-39 name=__codelineno-14-39 href=#__codelineno-14-39></a><span class=w>      </span><span class=p>{</span><span class=cm>/* Tooltip */</span><span class=p>}</span>
</span><span id=__span-14-40><a id=__codelineno-14-40 name=__codelineno-14-40 href=#__codelineno-14-40></a><span class=w>      </span><span class=p>{</span><span class=nx>showTooltip</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-14-41><a id=__codelineno-14-41 name=__codelineno-14-41 href=#__codelineno-14-41></a><span class=w>        </span><span class=o>&lt;</span><span class=nx>div</span>
</span><span id=__span-14-42><a id=__codelineno-14-42 name=__codelineno-14-42 href=#__codelineno-14-42></a><span class=w>          </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;absolute bottom-full mb-2 px-2 py-1 text-xs font-medium</span>
</span><span id=__span-14-43><a id=__codelineno-14-43 name=__codelineno-14-43 href=#__codelineno-14-43></a><span class=s2>            bg-bg-primary text-text-primary rounded shadow-lg border border-border-primary</span>
</span><span id=__span-14-44><a id=__codelineno-14-44 name=__codelineno-14-44 href=#__codelineno-14-44></a><span class=s2>            whitespace-nowrap z-10 pointer-events-none&quot;</span>
</span><span id=__span-14-45><a id=__codelineno-14-45 name=__codelineno-14-45 href=#__codelineno-14-45></a><span class=w>        </span><span class=o>&gt;</span>
</span><span id=__span-14-46><a id=__codelineno-14-46 name=__codelineno-14-46 href=#__codelineno-14-46></a><span class=w>          </span><span class=p>{</span><span class=nx>count</span><span class=p>}</span><span class=w> </span><span class=p>{</span><span class=nx>count</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=mf>1</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;item&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;items&quot;</span><span class=p>}</span>
</span><span id=__span-14-47><a id=__codelineno-14-47 name=__codelineno-14-47 href=#__codelineno-14-47></a><span class=w>        </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span><span id=__span-14-48><a id=__codelineno-14-48 name=__codelineno-14-48 href=#__codelineno-14-48></a><span class=w>      </span><span class=p>)}</span>
</span><span id=__span-14-49><a id=__codelineno-14-49 name=__codelineno-14-49 href=#__codelineno-14-49></a>
</span><span id=__span-14-50><a id=__codelineno-14-50 name=__codelineno-14-50 href=#__codelineno-14-50></a><span class=w>      </span><span class=p>{</span><span class=cm>/* Bar */</span><span class=p>}</span>
</span><span id=__span-14-51><a id=__codelineno-14-51 name=__codelineno-14-51 href=#__codelineno-14-51></a><span class=w>      </span><span class=o>&lt;</span><span class=nx>div</span>
</span><span id=__span-14-52><a id=__codelineno-14-52 name=__codelineno-14-52 href=#__codelineno-14-52></a><span class=w>        </span><span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=sb>`</span>
</span><span id=__span-14-53><a id=__codelineno-14-53 name=__codelineno-14-53 href=#__codelineno-14-53></a><span class=sb>          w-3 rounded-t transition-all duration-150</span>
</span><span id=__span-14-54><a id=__codelineno-14-54 name=__codelineno-14-54 href=#__codelineno-14-54></a><span class=sb>          </span><span class=si>${</span><span class=nx>isSelected</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;bg-accent-primary&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;bg-accent-secondary group-hover:bg-accent-primary/70&quot;</span><span class=si>}</span>
</span><span id=__span-14-55><a id=__codelineno-14-55 name=__codelineno-14-55 href=#__codelineno-14-55></a><span class=sb>          </span><span class=si>${</span><span class=nx>isFocused</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;ring-2 ring-accent-primary ring-offset-1 ring-offset-bg-primary&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=si>}</span>
</span><span id=__span-14-56><a id=__codelineno-14-56 name=__codelineno-14-56 href=#__codelineno-14-56></a><span class=sb>        `</span><span class=p>}</span>
</span><span id=__span-14-57><a id=__codelineno-14-57 name=__codelineno-14-57 href=#__codelineno-14-57></a><span class=w>        </span><span class=nx>style</span><span class=o>=</span><span class=p>{{</span><span class=w> </span><span class=nx>height</span><span class=o>:</span><span class=w> </span><span class=sb>`</span><span class=si>${</span><span class=nx>barHeight</span><span class=si>}</span><span class=sb>px`</span><span class=w> </span><span class=p>}}</span>
</span><span id=__span-14-58><a id=__codelineno-14-58 name=__codelineno-14-58 href=#__codelineno-14-58></a><span class=w>      </span><span class=o>/&gt;</span>
</span><span id=__span-14-59><a id=__codelineno-14-59 name=__codelineno-14-59 href=#__codelineno-14-59></a>
</span><span id=__span-14-60><a id=__codelineno-14-60 name=__codelineno-14-60 href=#__codelineno-14-60></a><span class=w>      </span><span class=p>{</span><span class=cm>/* Selection indicator */</span><span class=p>}</span>
</span><span id=__span-14-61><a id=__codelineno-14-61 name=__codelineno-14-61 href=#__codelineno-14-61></a><span class=w>      </span><span class=p>{</span><span class=nx>isSelected</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-14-62><a id=__codelineno-14-62 name=__codelineno-14-62 href=#__codelineno-14-62></a><span class=w>        </span><span class=o>&lt;</span><span class=nx>div</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;absolute -bottom-1 w-0 h-0 border-l-4 border-r-4 border-t-4</span>
</span><span id=__span-14-63><a id=__codelineno-14-63 name=__codelineno-14-63 href=#__codelineno-14-63></a><span class=s2>          border-l-transparent border-r-transparent border-t-accent-primary&quot;</span><span class=w> </span><span class=o>/&gt;</span>
</span><span id=__span-14-64><a id=__codelineno-14-64 name=__codelineno-14-64 href=#__codelineno-14-64></a><span class=w>      </span><span class=p>)}</span>
</span><span id=__span-14-65><a id=__codelineno-14-65 name=__codelineno-14-65 href=#__codelineno-14-65></a><span class=w>    </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span><span id=__span-14-66><a id=__codelineno-14-66 name=__codelineno-14-66 href=#__codelineno-14-66></a><span class=w>  </span><span class=p>);</span>
</span><span id=__span-14-67><a id=__codelineno-14-67 name=__codelineno-14-67 href=#__codelineno-14-67></a><span class=p>}</span>
</span><span id=__span-14-68><a id=__codelineno-14-68 name=__codelineno-14-68 href=#__codelineno-14-68></a>
</span><span id=__span-14-69><a id=__codelineno-14-69 name=__codelineno-14-69 href=#__codelineno-14-69></a><span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=nx>memo</span><span class=p>(</span><span class=nx>TimelineBar</span><span class=p>);</span>
</span></code></pre></div> <p><strong>Step 4: Run test to verify it passes</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/client &amp;&amp; npm test -- tests/components/timeline/TimelineBar.test.jsx</code> Expected: PASS</p> <p><strong>Step 5: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>git<span class=w> </span>add<span class=w> </span>client/src/components/timeline/TimelineBar.jsx<span class=w> </span>client/tests/components/timeline/TimelineBar.test.jsx
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;feat(client): add TimelineBar density bar component&quot;</span>
</span></code></pre></div> <hr> <h2 id=task-6-frontend-timelinestrip-component>Task 6: Frontend - TimelineStrip Component<a class=headerlink href=#task-6-frontend-timelinestrip-component title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Create: <code>client/src/components/timeline/TimelineStrip.jsx</code> - Test: <code>client/tests/components/timeline/TimelineStrip.test.jsx</code></p> <p><strong>Step 1: Write the failing test</strong></p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=c1>// client/tests/components/timeline/TimelineStrip.test.jsx</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>describe</span><span class=p>,</span><span class=w> </span><span class=nx>it</span><span class=p>,</span><span class=w> </span><span class=nx>expect</span><span class=p>,</span><span class=w> </span><span class=nx>vi</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;vitest&quot;</span><span class=p>;</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>createElement</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=k>import</span><span class=w> </span><span class=nx>TimelineStrip</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../../src/components/timeline/TimelineStrip.jsx&quot;</span><span class=p>;</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;TimelineStrip&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>mockDistribution</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=w>    </span><span class=p>{</span><span class=w> </span><span class=nx>period</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2024-01&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=mf>47</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=w>    </span><span class=p>{</span><span class=w> </span><span class=nx>period</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2024-02&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=mf>12</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=w>    </span><span class=p>{</span><span class=w> </span><span class=nx>period</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2024-03&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=mf>85</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-16-11><a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=w>  </span><span class=p>];</span>
</span><span id=__span-16-12><a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a>
</span><span id=__span-16-13><a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>defaultProps</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-14><a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=w>    </span><span class=nx>distribution</span><span class=o>:</span><span class=w> </span><span class=nx>mockDistribution</span><span class=p>,</span>
</span><span id=__span-16-15><a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a><span class=w>    </span><span class=nx>maxCount</span><span class=o>:</span><span class=w> </span><span class=mf>85</span><span class=p>,</span>
</span><span id=__span-16-16><a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=w>    </span><span class=nx>zoomLevel</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;months&quot;</span><span class=p>,</span>
</span><span id=__span-16-17><a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a><span class=w>    </span><span class=nx>selectedPeriod</span><span class=o>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-16-18><a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a><span class=w>    </span><span class=nx>onSelectPeriod</span><span class=o>:</span><span class=w> </span><span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>(),</span>
</span><span id=__span-16-19><a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a><span class=w>  </span><span class=p>};</span>
</span><span id=__span-16-20><a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a>
</span><span id=__span-16-21><a id=__codelineno-16-21 name=__codelineno-16-21 href=#__codelineno-16-21></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;renders distribution data as TimelineBar components&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-22><a id=__codelineno-16-22 name=__codelineno-16-22 href=#__codelineno-16-22></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineStrip</span><span class=p>,</span><span class=w> </span><span class=nx>defaultProps</span><span class=p>);</span>
</span><span id=__span-16-23><a id=__codelineno-16-23 name=__codelineno-16-23 href=#__codelineno-16-23></a>
</span><span id=__span-16-24><a id=__codelineno-16-24 name=__codelineno-16-24 href=#__codelineno-16-24></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>).</span><span class=nx>toBeDefined</span><span class=p>();</span>
</span><span id=__span-16-25><a id=__codelineno-16-25 name=__codelineno-16-25 href=#__codelineno-16-25></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>distribution</span><span class=p>).</span><span class=nx>toHaveLength</span><span class=p>(</span><span class=mf>3</span><span class=p>);</span>
</span><span id=__span-16-26><a id=__codelineno-16-26 name=__codelineno-16-26 href=#__codelineno-16-26></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-16-27><a id=__codelineno-16-27 name=__codelineno-16-27 href=#__codelineno-16-27></a>
</span><span id=__span-16-28><a id=__codelineno-16-28 name=__codelineno-16-28 href=#__codelineno-16-28></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;passes maxCount to calculate bar heights&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-29><a id=__codelineno-16-29 name=__codelineno-16-29 href=#__codelineno-16-29></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineStrip</span><span class=p>,</span><span class=w> </span><span class=nx>defaultProps</span><span class=p>);</span>
</span><span id=__span-16-30><a id=__codelineno-16-30 name=__codelineno-16-30 href=#__codelineno-16-30></a>
</span><span id=__span-16-31><a id=__codelineno-16-31 name=__codelineno-16-31 href=#__codelineno-16-31></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>maxCount</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=mf>85</span><span class=p>);</span>
</span><span id=__span-16-32><a id=__codelineno-16-32 name=__codelineno-16-32 href=#__codelineno-16-32></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-16-33><a id=__codelineno-16-33 name=__codelineno-16-33 href=#__codelineno-16-33></a>
</span><span id=__span-16-34><a id=__codelineno-16-34 name=__codelineno-16-34 href=#__codelineno-16-34></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;highlights selected period&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-35><a id=__codelineno-16-35 name=__codelineno-16-35 href=#__codelineno-16-35></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineStrip</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-36><a id=__codelineno-16-36 name=__codelineno-16-36 href=#__codelineno-16-36></a><span class=w>      </span><span class=p>...</span><span class=nx>defaultProps</span><span class=p>,</span>
</span><span id=__span-16-37><a id=__codelineno-16-37 name=__codelineno-16-37 href=#__codelineno-16-37></a><span class=w>      </span><span class=nx>selectedPeriod</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>period</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2024-02&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>start</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2024-02-01&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>end</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2024-02-29&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>label</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;February 2024&quot;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-16-38><a id=__codelineno-16-38 name=__codelineno-16-38 href=#__codelineno-16-38></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-16-39><a id=__codelineno-16-39 name=__codelineno-16-39 href=#__codelineno-16-39></a>
</span><span id=__span-16-40><a id=__codelineno-16-40 name=__codelineno-16-40 href=#__codelineno-16-40></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>selectedPeriod</span><span class=p>.</span><span class=nx>period</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s2>&quot;2024-02&quot;</span><span class=p>);</span>
</span><span id=__span-16-41><a id=__codelineno-16-41 name=__codelineno-16-41 href=#__codelineno-16-41></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-16-42><a id=__codelineno-16-42 name=__codelineno-16-42 href=#__codelineno-16-42></a>
</span><span id=__span-16-43><a id=__codelineno-16-43 name=__codelineno-16-43 href=#__codelineno-16-43></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;accepts onSelectPeriod callback&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-44><a id=__codelineno-16-44 name=__codelineno-16-44 href=#__codelineno-16-44></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>onSelectPeriod</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>();</span>
</span><span id=__span-16-45><a id=__codelineno-16-45 name=__codelineno-16-45 href=#__codelineno-16-45></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineStrip</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-46><a id=__codelineno-16-46 name=__codelineno-16-46 href=#__codelineno-16-46></a><span class=w>      </span><span class=p>...</span><span class=nx>defaultProps</span><span class=p>,</span>
</span><span id=__span-16-47><a id=__codelineno-16-47 name=__codelineno-16-47 href=#__codelineno-16-47></a><span class=w>      </span><span class=nx>onSelectPeriod</span><span class=p>,</span>
</span><span id=__span-16-48><a id=__codelineno-16-48 name=__codelineno-16-48 href=#__codelineno-16-48></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-16-49><a id=__codelineno-16-49 name=__codelineno-16-49 href=#__codelineno-16-49></a>
</span><span id=__span-16-50><a id=__codelineno-16-50 name=__codelineno-16-50 href=#__codelineno-16-50></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>onSelectPeriod</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=nx>onSelectPeriod</span><span class=p>);</span>
</span><span id=__span-16-51><a id=__codelineno-16-51 name=__codelineno-16-51 href=#__codelineno-16-51></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-16-52><a id=__codelineno-16-52 name=__codelineno-16-52 href=#__codelineno-16-52></a>
</span><span id=__span-16-53><a id=__codelineno-16-53 name=__codelineno-16-53 href=#__codelineno-16-53></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;renders empty state when no distribution&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-54><a id=__codelineno-16-54 name=__codelineno-16-54 href=#__codelineno-16-54></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineStrip</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-55><a id=__codelineno-16-55 name=__codelineno-16-55 href=#__codelineno-16-55></a><span class=w>      </span><span class=p>...</span><span class=nx>defaultProps</span><span class=p>,</span>
</span><span id=__span-16-56><a id=__codelineno-16-56 name=__codelineno-16-56 href=#__codelineno-16-56></a><span class=w>      </span><span class=nx>distribution</span><span class=o>:</span><span class=w> </span><span class=p>[],</span>
</span><span id=__span-16-57><a id=__codelineno-16-57 name=__codelineno-16-57 href=#__codelineno-16-57></a><span class=w>      </span><span class=nx>maxCount</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=p>,</span>
</span><span id=__span-16-58><a id=__codelineno-16-58 name=__codelineno-16-58 href=#__codelineno-16-58></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-16-59><a id=__codelineno-16-59 name=__codelineno-16-59 href=#__codelineno-16-59></a>
</span><span id=__span-16-60><a id=__codelineno-16-60 name=__codelineno-16-60 href=#__codelineno-16-60></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>distribution</span><span class=p>).</span><span class=nx>toHaveLength</span><span class=p>(</span><span class=mf>0</span><span class=p>);</span>
</span><span id=__span-16-61><a id=__codelineno-16-61 name=__codelineno-16-61 href=#__codelineno-16-61></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-16-62><a id=__codelineno-16-62 name=__codelineno-16-62 href=#__codelineno-16-62></a><span class=p>});</span>
</span></code></pre></div> <p><strong>Step 2: Run test to verify it fails</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/client &amp;&amp; npm test -- tests/components/timeline/TimelineStrip.test.jsx</code> Expected: FAIL with "Cannot find module"</p> <p><strong>Step 3: Write minimal implementation</strong></p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=c1>// client/src/components/timeline/TimelineStrip.jsx</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>memo</span><span class=p>,</span><span class=w> </span><span class=nx>useRef</span><span class=p>,</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useCallback</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=k>import</span><span class=w> </span><span class=nx>TimelineBar</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./TimelineBar.jsx&quot;</span><span class=p>;</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>format</span><span class=p>,</span><span class=w> </span><span class=nx>parse</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;date-fns&quot;</span><span class=p>;</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=kd>const</span><span class=w> </span><span class=nx>PERIOD_LABELS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=w>  </span><span class=nx>years</span><span class=o>:</span><span class=w> </span><span class=p>(</span><span class=nx>period</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>period</span><span class=p>,</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=w>  </span><span class=nx>months</span><span class=o>:</span><span class=w> </span><span class=p>(</span><span class=nx>period</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>date</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>parse</span><span class=p>(</span><span class=nx>period</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;yyyy-MM&quot;</span><span class=p>,</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Date</span><span class=p>());</span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>format</span><span class=p>(</span><span class=nx>date</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;MMM yyyy&quot;</span><span class=p>);</span>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a><span class=w>  </span><span class=nx>weeks</span><span class=o>:</span><span class=w> </span><span class=p>(</span><span class=nx>period</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>year</span><span class=p>,</span><span class=w> </span><span class=nx>week</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>period</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&quot;-W&quot;</span><span class=p>);</span>
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=sb>`W</span><span class=si>${</span><span class=nx>week</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-17-16><a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a><span class=w>  </span><span class=nx>days</span><span class=o>:</span><span class=w> </span><span class=p>(</span><span class=nx>period</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-17><a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>date</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>parse</span><span class=p>(</span><span class=nx>period</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;yyyy-MM-dd&quot;</span><span class=p>,</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Date</span><span class=p>());</span>
</span><span id=__span-17-18><a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>format</span><span class=p>(</span><span class=nx>date</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;MMM d&quot;</span><span class=p>);</span>
</span><span id=__span-17-19><a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-17-20><a id=__codelineno-17-20 name=__codelineno-17-20 href=#__codelineno-17-20></a><span class=p>};</span>
</span><span id=__span-17-21><a id=__codelineno-17-21 name=__codelineno-17-21 href=#__codelineno-17-21></a>
</span><span id=__span-17-22><a id=__codelineno-17-22 name=__codelineno-17-22 href=#__codelineno-17-22></a><span class=kd>function</span><span class=w> </span><span class=nx>TimelineStrip</span><span class=p>({</span>
</span><span id=__span-17-23><a id=__codelineno-17-23 name=__codelineno-17-23 href=#__codelineno-17-23></a><span class=w>  </span><span class=nx>distribution</span><span class=p>,</span>
</span><span id=__span-17-24><a id=__codelineno-17-24 name=__codelineno-17-24 href=#__codelineno-17-24></a><span class=w>  </span><span class=nx>maxCount</span><span class=p>,</span>
</span><span id=__span-17-25><a id=__codelineno-17-25 name=__codelineno-17-25 href=#__codelineno-17-25></a><span class=w>  </span><span class=nx>zoomLevel</span><span class=p>,</span>
</span><span id=__span-17-26><a id=__codelineno-17-26 name=__codelineno-17-26 href=#__codelineno-17-26></a><span class=w>  </span><span class=nx>selectedPeriod</span><span class=p>,</span>
</span><span id=__span-17-27><a id=__codelineno-17-27 name=__codelineno-17-27 href=#__codelineno-17-27></a><span class=w>  </span><span class=nx>onSelectPeriod</span><span class=p>,</span>
</span><span id=__span-17-28><a id=__codelineno-17-28 name=__codelineno-17-28 href=#__codelineno-17-28></a><span class=w>  </span><span class=nx>onKeyboardNavigate</span><span class=p>,</span>
</span><span id=__span-17-29><a id=__codelineno-17-29 name=__codelineno-17-29 href=#__codelineno-17-29></a><span class=w>  </span><span class=nx>className</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-17-30><a id=__codelineno-17-30 name=__codelineno-17-30 href=#__codelineno-17-30></a><span class=p>})</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-31><a id=__codelineno-17-31 name=__codelineno-17-31 href=#__codelineno-17-31></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>containerRef</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span><span id=__span-17-32><a id=__codelineno-17-32 name=__codelineno-17-32 href=#__codelineno-17-32></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>focusedIndex</span><span class=p>,</span><span class=w> </span><span class=nx>setFocusedIndex</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=o>-</span><span class=mf>1</span><span class=p>);</span>
</span><span id=__span-17-33><a id=__codelineno-17-33 name=__codelineno-17-33 href=#__codelineno-17-33></a>
</span><span id=__span-17-34><a id=__codelineno-17-34 name=__codelineno-17-34 href=#__codelineno-17-34></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>getLabel</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useCallback</span><span class=p>(</span>
</span><span id=__span-17-35><a id=__codelineno-17-35 name=__codelineno-17-35 href=#__codelineno-17-35></a><span class=w>    </span><span class=p>(</span><span class=nx>period</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-36><a id=__codelineno-17-36 name=__codelineno-17-36 href=#__codelineno-17-36></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>labelFn</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>PERIOD_LABELS</span><span class=p>[</span><span class=nx>zoomLevel</span><span class=p>]</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nx>PERIOD_LABELS</span><span class=p>.</span><span class=nx>months</span><span class=p>;</span>
</span><span id=__span-17-37><a id=__codelineno-17-37 name=__codelineno-17-37 href=#__codelineno-17-37></a><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=nx>labelFn</span><span class=p>(</span><span class=nx>period</span><span class=p>);</span>
</span><span id=__span-17-38><a id=__codelineno-17-38 name=__codelineno-17-38 href=#__codelineno-17-38></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-17-39><a id=__codelineno-17-39 name=__codelineno-17-39 href=#__codelineno-17-39></a><span class=w>    </span><span class=p>[</span><span class=nx>zoomLevel</span><span class=p>]</span>
</span><span id=__span-17-40><a id=__codelineno-17-40 name=__codelineno-17-40 href=#__codelineno-17-40></a><span class=w>  </span><span class=p>);</span>
</span><span id=__span-17-41><a id=__codelineno-17-41 name=__codelineno-17-41 href=#__codelineno-17-41></a>
</span><span id=__span-17-42><a id=__codelineno-17-42 name=__codelineno-17-42 href=#__codelineno-17-42></a><span class=w>  </span><span class=c1>// Keyboard navigation</span>
</span><span id=__span-17-43><a id=__codelineno-17-43 name=__codelineno-17-43 href=#__codelineno-17-43></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>handleKeyDown</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useCallback</span><span class=p>(</span>
</span><span id=__span-17-44><a id=__codelineno-17-44 name=__codelineno-17-44 href=#__codelineno-17-44></a><span class=w>    </span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-45><a id=__codelineno-17-45 name=__codelineno-17-45 href=#__codelineno-17-45></a><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>distribution</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=mf>0</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=p>;</span>
</span><span id=__span-17-46><a id=__codelineno-17-46 name=__codelineno-17-46 href=#__codelineno-17-46></a>
</span><span id=__span-17-47><a id=__codelineno-17-47 name=__codelineno-17-47 href=#__codelineno-17-47></a><span class=w>      </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>key</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-48><a id=__codelineno-17-48 name=__codelineno-17-48 href=#__codelineno-17-48></a><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;ArrowLeft&quot;</span><span class=o>:</span>
</span><span id=__span-17-49><a id=__codelineno-17-49 name=__codelineno-17-49 href=#__codelineno-17-49></a><span class=w>          </span><span class=nx>e</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>();</span>
</span><span id=__span-17-50><a id=__codelineno-17-50 name=__codelineno-17-50 href=#__codelineno-17-50></a><span class=w>          </span><span class=nx>setFocusedIndex</span><span class=p>((</span><span class=nx>prev</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span>
</span><span id=__span-17-51><a id=__codelineno-17-51 name=__codelineno-17-51 href=#__codelineno-17-51></a><span class=w>            </span><span class=nx>prev</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mf>0</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=nx>distribution</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mf>1</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=nx>prev</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mf>1</span>
</span><span id=__span-17-52><a id=__codelineno-17-52 name=__codelineno-17-52 href=#__codelineno-17-52></a><span class=w>          </span><span class=p>);</span>
</span><span id=__span-17-53><a id=__codelineno-17-53 name=__codelineno-17-53 href=#__codelineno-17-53></a><span class=w>          </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-17-54><a id=__codelineno-17-54 name=__codelineno-17-54 href=#__codelineno-17-54></a><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;ArrowRight&quot;</span><span class=o>:</span>
</span><span id=__span-17-55><a id=__codelineno-17-55 name=__codelineno-17-55 href=#__codelineno-17-55></a><span class=w>          </span><span class=nx>e</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>();</span>
</span><span id=__span-17-56><a id=__codelineno-17-56 name=__codelineno-17-56 href=#__codelineno-17-56></a><span class=w>          </span><span class=nx>setFocusedIndex</span><span class=p>((</span><span class=nx>prev</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span>
</span><span id=__span-17-57><a id=__codelineno-17-57 name=__codelineno-17-57 href=#__codelineno-17-57></a><span class=w>            </span><span class=nx>prev</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=nx>distribution</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mf>1</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=mf>0</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=nx>prev</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>1</span>
</span><span id=__span-17-58><a id=__codelineno-17-58 name=__codelineno-17-58 href=#__codelineno-17-58></a><span class=w>          </span><span class=p>);</span>
</span><span id=__span-17-59><a id=__codelineno-17-59 name=__codelineno-17-59 href=#__codelineno-17-59></a><span class=w>          </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-17-60><a id=__codelineno-17-60 name=__codelineno-17-60 href=#__codelineno-17-60></a><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;Home&quot;</span><span class=o>:</span>
</span><span id=__span-17-61><a id=__codelineno-17-61 name=__codelineno-17-61 href=#__codelineno-17-61></a><span class=w>          </span><span class=nx>e</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>();</span>
</span><span id=__span-17-62><a id=__codelineno-17-62 name=__codelineno-17-62 href=#__codelineno-17-62></a><span class=w>          </span><span class=nx>setFocusedIndex</span><span class=p>(</span><span class=mf>0</span><span class=p>);</span>
</span><span id=__span-17-63><a id=__codelineno-17-63 name=__codelineno-17-63 href=#__codelineno-17-63></a><span class=w>          </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-17-64><a id=__codelineno-17-64 name=__codelineno-17-64 href=#__codelineno-17-64></a><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;End&quot;</span><span class=o>:</span>
</span><span id=__span-17-65><a id=__codelineno-17-65 name=__codelineno-17-65 href=#__codelineno-17-65></a><span class=w>          </span><span class=nx>e</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>();</span>
</span><span id=__span-17-66><a id=__codelineno-17-66 name=__codelineno-17-66 href=#__codelineno-17-66></a><span class=w>          </span><span class=nx>setFocusedIndex</span><span class=p>(</span><span class=nx>distribution</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mf>1</span><span class=p>);</span>
</span><span id=__span-17-67><a id=__codelineno-17-67 name=__codelineno-17-67 href=#__codelineno-17-67></a><span class=w>          </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-17-68><a id=__codelineno-17-68 name=__codelineno-17-68 href=#__codelineno-17-68></a><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=s2>&quot;Enter&quot;</span><span class=o>:</span>
</span><span id=__span-17-69><a id=__codelineno-17-69 name=__codelineno-17-69 href=#__codelineno-17-69></a><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=s2>&quot; &quot;</span><span class=o>:</span>
</span><span id=__span-17-70><a id=__codelineno-17-70 name=__codelineno-17-70 href=#__codelineno-17-70></a><span class=w>          </span><span class=nx>e</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>();</span>
</span><span id=__span-17-71><a id=__codelineno-17-71 name=__codelineno-17-71 href=#__codelineno-17-71></a><span class=w>          </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>focusedIndex</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mf>0</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>focusedIndex</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=nx>distribution</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-72><a id=__codelineno-17-72 name=__codelineno-17-72 href=#__codelineno-17-72></a><span class=w>            </span><span class=nx>onSelectPeriod</span><span class=p>(</span><span class=nx>distribution</span><span class=p>[</span><span class=nx>focusedIndex</span><span class=p>].</span><span class=nx>period</span><span class=p>);</span>
</span><span id=__span-17-73><a id=__codelineno-17-73 name=__codelineno-17-73 href=#__codelineno-17-73></a><span class=w>          </span><span class=p>}</span>
</span><span id=__span-17-74><a id=__codelineno-17-74 name=__codelineno-17-74 href=#__codelineno-17-74></a><span class=w>          </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-17-75><a id=__codelineno-17-75 name=__codelineno-17-75 href=#__codelineno-17-75></a><span class=w>        </span><span class=k>default</span><span class=o>:</span>
</span><span id=__span-17-76><a id=__codelineno-17-76 name=__codelineno-17-76 href=#__codelineno-17-76></a><span class=w>          </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>onKeyboardNavigate</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-77><a id=__codelineno-17-77 name=__codelineno-17-77 href=#__codelineno-17-77></a><span class=w>            </span><span class=nx>onKeyboardNavigate</span><span class=p>(</span><span class=nx>e</span><span class=p>);</span>
</span><span id=__span-17-78><a id=__codelineno-17-78 name=__codelineno-17-78 href=#__codelineno-17-78></a><span class=w>          </span><span class=p>}</span>
</span><span id=__span-17-79><a id=__codelineno-17-79 name=__codelineno-17-79 href=#__codelineno-17-79></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-17-80><a id=__codelineno-17-80 name=__codelineno-17-80 href=#__codelineno-17-80></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-17-81><a id=__codelineno-17-81 name=__codelineno-17-81 href=#__codelineno-17-81></a><span class=w>    </span><span class=p>[</span><span class=nx>distribution</span><span class=p>,</span><span class=w> </span><span class=nx>focusedIndex</span><span class=p>,</span><span class=w> </span><span class=nx>onSelectPeriod</span><span class=p>,</span><span class=w> </span><span class=nx>onKeyboardNavigate</span><span class=p>]</span>
</span><span id=__span-17-82><a id=__codelineno-17-82 name=__codelineno-17-82 href=#__codelineno-17-82></a><span class=w>  </span><span class=p>);</span>
</span><span id=__span-17-83><a id=__codelineno-17-83 name=__codelineno-17-83 href=#__codelineno-17-83></a>
</span><span id=__span-17-84><a id=__codelineno-17-84 name=__codelineno-17-84 href=#__codelineno-17-84></a><span class=w>  </span><span class=c1>// Scroll focused bar into view</span>
</span><span id=__span-17-85><a id=__codelineno-17-85 name=__codelineno-17-85 href=#__codelineno-17-85></a><span class=w>  </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-86><a id=__codelineno-17-86 name=__codelineno-17-86 href=#__codelineno-17-86></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>focusedIndex</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mf>0</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>containerRef</span><span class=p>.</span><span class=nx>current</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-87><a id=__codelineno-17-87 name=__codelineno-17-87 href=#__codelineno-17-87></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>bars</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>containerRef</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>querySelectorAll</span><span class=p>(</span><span class=s1>&#39;[role=&quot;option&quot;]&#39;</span><span class=p>);</span>
</span><span id=__span-17-88><a id=__codelineno-17-88 name=__codelineno-17-88 href=#__codelineno-17-88></a><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>bars</span><span class=p>[</span><span class=nx>focusedIndex</span><span class=p>])</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-89><a id=__codelineno-17-89 name=__codelineno-17-89 href=#__codelineno-17-89></a><span class=w>        </span><span class=nx>bars</span><span class=p>[</span><span class=nx>focusedIndex</span><span class=p>].</span><span class=nx>scrollIntoView</span><span class=p>({</span>
</span><span id=__span-17-90><a id=__codelineno-17-90 name=__codelineno-17-90 href=#__codelineno-17-90></a><span class=w>          </span><span class=nx>behavior</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;smooth&quot;</span><span class=p>,</span>
</span><span id=__span-17-91><a id=__codelineno-17-91 name=__codelineno-17-91 href=#__codelineno-17-91></a><span class=w>          </span><span class=nx>block</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;nearest&quot;</span><span class=p>,</span>
</span><span id=__span-17-92><a id=__codelineno-17-92 name=__codelineno-17-92 href=#__codelineno-17-92></a><span class=w>          </span><span class=nx>inline</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;center&quot;</span><span class=p>,</span>
</span><span id=__span-17-93><a id=__codelineno-17-93 name=__codelineno-17-93 href=#__codelineno-17-93></a><span class=w>        </span><span class=p>});</span>
</span><span id=__span-17-94><a id=__codelineno-17-94 name=__codelineno-17-94 href=#__codelineno-17-94></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-17-95><a id=__codelineno-17-95 name=__codelineno-17-95 href=#__codelineno-17-95></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-17-96><a id=__codelineno-17-96 name=__codelineno-17-96 href=#__codelineno-17-96></a><span class=w>  </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>focusedIndex</span><span class=p>]);</span>
</span><span id=__span-17-97><a id=__codelineno-17-97 name=__codelineno-17-97 href=#__codelineno-17-97></a>
</span><span id=__span-17-98><a id=__codelineno-17-98 name=__codelineno-17-98 href=#__codelineno-17-98></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>distribution</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=mf>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-99><a id=__codelineno-17-99 name=__codelineno-17-99 href=#__codelineno-17-99></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-17-100><a id=__codelineno-17-100 name=__codelineno-17-100 href=#__codelineno-17-100></a><span class=w>      </span><span class=o>&lt;</span><span class=nx>div</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=sb>`flex items-center justify-center h-20 text-text-secondary </span><span class=si>${</span><span class=nx>className</span><span class=si>}</span><span class=sb>`</span><span class=p>}</span><span class=o>&gt;</span>
</span><span id=__span-17-101><a id=__codelineno-17-101 name=__codelineno-17-101 href=#__codelineno-17-101></a><span class=w>        </span><span class=nx>No</span><span class=w> </span><span class=nx>dated</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=nx>available</span>
</span><span id=__span-17-102><a id=__codelineno-17-102 name=__codelineno-17-102 href=#__codelineno-17-102></a><span class=w>      </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span><span id=__span-17-103><a id=__codelineno-17-103 name=__codelineno-17-103 href=#__codelineno-17-103></a><span class=w>    </span><span class=p>);</span>
</span><span id=__span-17-104><a id=__codelineno-17-104 name=__codelineno-17-104 href=#__codelineno-17-104></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-17-105><a id=__codelineno-17-105 name=__codelineno-17-105 href=#__codelineno-17-105></a>
</span><span id=__span-17-106><a id=__codelineno-17-106 name=__codelineno-17-106 href=#__codelineno-17-106></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-17-107><a id=__codelineno-17-107 name=__codelineno-17-107 href=#__codelineno-17-107></a><span class=w>    </span><span class=o>&lt;</span><span class=nx>div</span>
</span><span id=__span-17-108><a id=__codelineno-17-108 name=__codelineno-17-108 href=#__codelineno-17-108></a><span class=w>      </span><span class=nx>ref</span><span class=o>=</span><span class=p>{</span><span class=nx>containerRef</span><span class=p>}</span>
</span><span id=__span-17-109><a id=__codelineno-17-109 name=__codelineno-17-109 href=#__codelineno-17-109></a><span class=w>      </span><span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=sb>`</span>
</span><span id=__span-17-110><a id=__codelineno-17-110 name=__codelineno-17-110 href=#__codelineno-17-110></a><span class=sb>        relative flex items-end gap-1 overflow-x-auto pb-6 pt-2 px-4</span>
</span><span id=__span-17-111><a id=__codelineno-17-111 name=__codelineno-17-111 href=#__codelineno-17-111></a><span class=sb>        scrollbar-thin scrollbar-thumb-border-primary scrollbar-track-transparent</span>
</span><span id=__span-17-112><a id=__codelineno-17-112 name=__codelineno-17-112 href=#__codelineno-17-112></a><span class=sb>        </span><span class=si>${</span><span class=nx>className</span><span class=si>}</span>
</span><span id=__span-17-113><a id=__codelineno-17-113 name=__codelineno-17-113 href=#__codelineno-17-113></a><span class=sb>      `</span><span class=p>}</span>
</span><span id=__span-17-114><a id=__codelineno-17-114 name=__codelineno-17-114 href=#__codelineno-17-114></a><span class=w>      </span><span class=nx>role</span><span class=o>=</span><span class=s2>&quot;listbox&quot;</span>
</span><span id=__span-17-115><a id=__codelineno-17-115 name=__codelineno-17-115 href=#__codelineno-17-115></a><span class=w>      </span><span class=nx>aria</span><span class=o>-</span><span class=nx>label</span><span class=o>=</span><span class=s2>&quot;Timeline&quot;</span>
</span><span id=__span-17-116><a id=__codelineno-17-116 name=__codelineno-17-116 href=#__codelineno-17-116></a><span class=w>      </span><span class=nx>tabIndex</span><span class=o>=</span><span class=p>{</span><span class=mf>0</span><span class=p>}</span>
</span><span id=__span-17-117><a id=__codelineno-17-117 name=__codelineno-17-117 href=#__codelineno-17-117></a><span class=w>      </span><span class=nx>onKeyDown</span><span class=o>=</span><span class=p>{</span><span class=nx>handleKeyDown</span><span class=p>}</span>
</span><span id=__span-17-118><a id=__codelineno-17-118 name=__codelineno-17-118 href=#__codelineno-17-118></a><span class=w>      </span><span class=nx>onFocus</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-119><a id=__codelineno-17-119 name=__codelineno-17-119 href=#__codelineno-17-119></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>focusedIndex</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=o>-</span><span class=mf>1</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>distribution</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-120><a id=__codelineno-17-120 name=__codelineno-17-120 href=#__codelineno-17-120></a><span class=w>          </span><span class=c1>// Focus on selected period or last (most recent)</span>
</span><span id=__span-17-121><a id=__codelineno-17-121 name=__codelineno-17-121 href=#__codelineno-17-121></a><span class=w>          </span><span class=kd>const</span><span class=w> </span><span class=nx>selectedIndex</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>distribution</span><span class=p>.</span><span class=nx>findIndex</span><span class=p>(</span>
</span><span id=__span-17-122><a id=__codelineno-17-122 name=__codelineno-17-122 href=#__codelineno-17-122></a><span class=w>            </span><span class=p>(</span><span class=nx>d</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>period</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=nx>selectedPeriod</span><span class=o>?</span><span class=p>.</span><span class=nx>period</span>
</span><span id=__span-17-123><a id=__codelineno-17-123 name=__codelineno-17-123 href=#__codelineno-17-123></a><span class=w>          </span><span class=p>);</span>
</span><span id=__span-17-124><a id=__codelineno-17-124 name=__codelineno-17-124 href=#__codelineno-17-124></a><span class=w>          </span><span class=nx>setFocusedIndex</span><span class=p>(</span><span class=nx>selectedIndex</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mf>0</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=nx>selectedIndex</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=nx>distribution</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mf>1</span><span class=p>);</span>
</span><span id=__span-17-125><a id=__codelineno-17-125 name=__codelineno-17-125 href=#__codelineno-17-125></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-17-126><a id=__codelineno-17-126 name=__codelineno-17-126 href=#__codelineno-17-126></a><span class=w>      </span><span class=p>}}</span>
</span><span id=__span-17-127><a id=__codelineno-17-127 name=__codelineno-17-127 href=#__codelineno-17-127></a><span class=w>    </span><span class=o>&gt;</span>
</span><span id=__span-17-128><a id=__codelineno-17-128 name=__codelineno-17-128 href=#__codelineno-17-128></a><span class=w>      </span><span class=p>{</span><span class=cm>/* Baseline */</span><span class=p>}</span>
</span><span id=__span-17-129><a id=__codelineno-17-129 name=__codelineno-17-129 href=#__codelineno-17-129></a><span class=w>      </span><span class=o>&lt;</span><span class=nx>div</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;absolute bottom-6 left-4 right-4 h-px bg-border-primary&quot;</span><span class=w> </span><span class=o>/&gt;</span>
</span><span id=__span-17-130><a id=__codelineno-17-130 name=__codelineno-17-130 href=#__codelineno-17-130></a>
</span><span id=__span-17-131><a id=__codelineno-17-131 name=__codelineno-17-131 href=#__codelineno-17-131></a><span class=w>      </span><span class=p>{</span><span class=nx>distribution</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>item</span><span class=p>,</span><span class=w> </span><span class=nx>index</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-17-132><a id=__codelineno-17-132 name=__codelineno-17-132 href=#__codelineno-17-132></a><span class=w>        </span><span class=o>&lt;</span><span class=nx>div</span><span class=w> </span><span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>period</span><span class=p>}</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;flex flex-col items-center min-w-[40px]&quot;</span><span class=o>&gt;</span>
</span><span id=__span-17-133><a id=__codelineno-17-133 name=__codelineno-17-133 href=#__codelineno-17-133></a><span class=w>          </span><span class=o>&lt;</span><span class=nx>TimelineBar</span>
</span><span id=__span-17-134><a id=__codelineno-17-134 name=__codelineno-17-134 href=#__codelineno-17-134></a><span class=w>            </span><span class=nx>period</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>period</span><span class=p>}</span>
</span><span id=__span-17-135><a id=__codelineno-17-135 name=__codelineno-17-135 href=#__codelineno-17-135></a><span class=w>            </span><span class=nx>count</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>count</span><span class=p>}</span>
</span><span id=__span-17-136><a id=__codelineno-17-136 name=__codelineno-17-136 href=#__codelineno-17-136></a><span class=w>            </span><span class=nx>maxCount</span><span class=o>=</span><span class=p>{</span><span class=nx>maxCount</span><span class=p>}</span>
</span><span id=__span-17-137><a id=__codelineno-17-137 name=__codelineno-17-137 href=#__codelineno-17-137></a><span class=w>            </span><span class=nx>isSelected</span><span class=o>=</span><span class=p>{</span><span class=nx>selectedPeriod</span><span class=o>?</span><span class=p>.</span><span class=nx>period</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=nx>item</span><span class=p>.</span><span class=nx>period</span><span class=p>}</span>
</span><span id=__span-17-138><a id=__codelineno-17-138 name=__codelineno-17-138 href=#__codelineno-17-138></a><span class=w>            </span><span class=nx>isFocused</span><span class=o>=</span><span class=p>{</span><span class=nx>focusedIndex</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=nx>index</span><span class=p>}</span>
</span><span id=__span-17-139><a id=__codelineno-17-139 name=__codelineno-17-139 href=#__codelineno-17-139></a><span class=w>            </span><span class=nx>onClick</span><span class=o>=</span><span class=p>{</span><span class=nx>onSelectPeriod</span><span class=p>}</span>
</span><span id=__span-17-140><a id=__codelineno-17-140 name=__codelineno-17-140 href=#__codelineno-17-140></a><span class=w>            </span><span class=nx>label</span><span class=o>=</span><span class=p>{</span><span class=nx>getLabel</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>period</span><span class=p>)}</span>
</span><span id=__span-17-141><a id=__codelineno-17-141 name=__codelineno-17-141 href=#__codelineno-17-141></a><span class=w>            </span><span class=nx>tabIndex</span><span class=o>=</span><span class=p>{</span><span class=o>-</span><span class=mf>1</span><span class=p>}</span>
</span><span id=__span-17-142><a id=__codelineno-17-142 name=__codelineno-17-142 href=#__codelineno-17-142></a><span class=w>          </span><span class=o>/&gt;</span>
</span><span id=__span-17-143><a id=__codelineno-17-143 name=__codelineno-17-143 href=#__codelineno-17-143></a><span class=w>          </span><span class=p>{</span><span class=cm>/* Period label */</span><span class=p>}</span>
</span><span id=__span-17-144><a id=__codelineno-17-144 name=__codelineno-17-144 href=#__codelineno-17-144></a><span class=w>          </span><span class=o>&lt;</span><span class=nx>span</span>
</span><span id=__span-17-145><a id=__codelineno-17-145 name=__codelineno-17-145 href=#__codelineno-17-145></a><span class=w>            </span><span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=sb>`</span>
</span><span id=__span-17-146><a id=__codelineno-17-146 name=__codelineno-17-146 href=#__codelineno-17-146></a><span class=sb>              mt-1 text-xs whitespace-nowrap</span>
</span><span id=__span-17-147><a id=__codelineno-17-147 name=__codelineno-17-147 href=#__codelineno-17-147></a><span class=sb>              </span><span class=si>${</span><span class=nx>selectedPeriod</span><span class=o>?</span><span class=p>.</span><span class=nx>period</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=nx>item</span><span class=p>.</span><span class=nx>period</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;text-accent-primary font-medium&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;text-text-secondary&quot;</span><span class=si>}</span>
</span><span id=__span-17-148><a id=__codelineno-17-148 name=__codelineno-17-148 href=#__codelineno-17-148></a><span class=sb>            `</span><span class=p>}</span>
</span><span id=__span-17-149><a id=__codelineno-17-149 name=__codelineno-17-149 href=#__codelineno-17-149></a><span class=w>          </span><span class=o>&gt;</span>
</span><span id=__span-17-150><a id=__codelineno-17-150 name=__codelineno-17-150 href=#__codelineno-17-150></a><span class=w>            </span><span class=p>{</span><span class=nx>getLabel</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>period</span><span class=p>)}</span>
</span><span id=__span-17-151><a id=__codelineno-17-151 name=__codelineno-17-151 href=#__codelineno-17-151></a><span class=w>          </span><span class=o>&lt;</span><span class=err>/span&gt;</span>
</span><span id=__span-17-152><a id=__codelineno-17-152 name=__codelineno-17-152 href=#__codelineno-17-152></a><span class=w>        </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span><span id=__span-17-153><a id=__codelineno-17-153 name=__codelineno-17-153 href=#__codelineno-17-153></a><span class=w>      </span><span class=p>))}</span>
</span><span id=__span-17-154><a id=__codelineno-17-154 name=__codelineno-17-154 href=#__codelineno-17-154></a><span class=w>    </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span><span id=__span-17-155><a id=__codelineno-17-155 name=__codelineno-17-155 href=#__codelineno-17-155></a><span class=w>  </span><span class=p>);</span>
</span><span id=__span-17-156><a id=__codelineno-17-156 name=__codelineno-17-156 href=#__codelineno-17-156></a><span class=p>}</span>
</span><span id=__span-17-157><a id=__codelineno-17-157 name=__codelineno-17-157 href=#__codelineno-17-157></a>
</span><span id=__span-17-158><a id=__codelineno-17-158 name=__codelineno-17-158 href=#__codelineno-17-158></a><span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=nx>memo</span><span class=p>(</span><span class=nx>TimelineStrip</span><span class=p>);</span>
</span></code></pre></div> <p><strong>Step 4: Run test to verify it passes</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/client &amp;&amp; npm test -- tests/components/timeline/TimelineStrip.test.jsx</code> Expected: PASS</p> <p><strong>Step 5: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>git<span class=w> </span>add<span class=w> </span>client/src/components/timeline/TimelineStrip.jsx<span class=w> </span>client/tests/components/timeline/TimelineStrip.test.jsx
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;feat(client): add TimelineStrip scrollable timeline component&quot;</span>
</span></code></pre></div> <hr> <h2 id=task-7-frontend-timelineview-main-component>Task 7: Frontend - TimelineView Main Component<a class=headerlink href=#task-7-frontend-timelineview-main-component title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Create: <code>client/src/components/timeline/TimelineView.jsx</code> - Test: <code>client/tests/components/timeline/TimelineView.test.jsx</code></p> <p><strong>Step 1: Write the failing test</strong></p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=c1>// client/tests/components/timeline/TimelineView.test.jsx</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>describe</span><span class=p>,</span><span class=w> </span><span class=nx>it</span><span class=p>,</span><span class=w> </span><span class=nx>expect</span><span class=p>,</span><span class=w> </span><span class=nx>vi</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;vitest&quot;</span><span class=p>;</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>createElement</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=k>import</span><span class=w> </span><span class=nx>TimelineView</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../../src/components/timeline/TimelineView.jsx&quot;</span><span class=p>;</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=nx>vi</span><span class=p>.</span><span class=nx>mock</span><span class=p>(</span><span class=s2>&quot;../../../src/services/api.js&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>({</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=w>  </span><span class=nx>apiGet</span><span class=o>:</span><span class=w> </span><span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>().</span><span class=nx>mockResolvedValue</span><span class=p>({</span><span class=w> </span><span class=nx>distribution</span><span class=o>:</span><span class=w> </span><span class=p>[]</span><span class=w> </span><span class=p>}),</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=p>}));</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;TimelineView&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>defaultProps</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-12><a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=w>    </span><span class=nx>entityType</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;scene&quot;</span><span class=p>,</span>
</span><span id=__span-19-13><a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=w>    </span><span class=nx>items</span><span class=o>:</span><span class=w> </span><span class=p>[],</span>
</span><span id=__span-19-14><a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a><span class=w>    </span><span class=nx>renderItem</span><span class=o>:</span><span class=w> </span><span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>(),</span>
</span><span id=__span-19-15><a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a><span class=w>    </span><span class=nx>onItemClick</span><span class=o>:</span><span class=w> </span><span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>(),</span>
</span><span id=__span-19-16><a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a><span class=w>  </span><span class=p>};</span>
</span><span id=__span-19-17><a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a>
</span><span id=__span-19-18><a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;renders with entityType prop&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-19><a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineView</span><span class=p>,</span><span class=w> </span><span class=nx>defaultProps</span><span class=p>);</span>
</span><span id=__span-19-20><a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a>
</span><span id=__span-19-21><a id=__codelineno-19-21 name=__codelineno-19-21 href=#__codelineno-19-21></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>).</span><span class=nx>toBeDefined</span><span class=p>();</span>
</span><span id=__span-19-22><a id=__codelineno-19-22 name=__codelineno-19-22 href=#__codelineno-19-22></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>entityType</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s2>&quot;scene&quot;</span><span class=p>);</span>
</span><span id=__span-19-23><a id=__codelineno-19-23 name=__codelineno-19-23 href=#__codelineno-19-23></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-19-24><a id=__codelineno-19-24 name=__codelineno-19-24 href=#__codelineno-19-24></a>
</span><span id=__span-19-25><a id=__codelineno-19-25 name=__codelineno-19-25 href=#__codelineno-19-25></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;accepts items array for results grid&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-26><a id=__codelineno-19-26 name=__codelineno-19-26 href=#__codelineno-19-26></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>items</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[{</span><span class=w> </span><span class=nx>id</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;1&quot;</span><span class=w> </span><span class=p>},</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>id</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2&quot;</span><span class=w> </span><span class=p>}];</span>
</span><span id=__span-19-27><a id=__codelineno-19-27 name=__codelineno-19-27 href=#__codelineno-19-27></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineView</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-28><a id=__codelineno-19-28 name=__codelineno-19-28 href=#__codelineno-19-28></a><span class=w>      </span><span class=p>...</span><span class=nx>defaultProps</span><span class=p>,</span>
</span><span id=__span-19-29><a id=__codelineno-19-29 name=__codelineno-19-29 href=#__codelineno-19-29></a><span class=w>      </span><span class=nx>items</span><span class=p>,</span>
</span><span id=__span-19-30><a id=__codelineno-19-30 name=__codelineno-19-30 href=#__codelineno-19-30></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-19-31><a id=__codelineno-19-31 name=__codelineno-19-31 href=#__codelineno-19-31></a>
</span><span id=__span-19-32><a id=__codelineno-19-32 name=__codelineno-19-32 href=#__codelineno-19-32></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>items</span><span class=p>).</span><span class=nx>toHaveLength</span><span class=p>(</span><span class=mf>2</span><span class=p>);</span>
</span><span id=__span-19-33><a id=__codelineno-19-33 name=__codelineno-19-33 href=#__codelineno-19-33></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-19-34><a id=__codelineno-19-34 name=__codelineno-19-34 href=#__codelineno-19-34></a>
</span><span id=__span-19-35><a id=__codelineno-19-35 name=__codelineno-19-35 href=#__codelineno-19-35></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;accepts renderItem function for custom card rendering&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-36><a id=__codelineno-19-36 name=__codelineno-19-36 href=#__codelineno-19-36></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>renderItem</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>();</span>
</span><span id=__span-19-37><a id=__codelineno-19-37 name=__codelineno-19-37 href=#__codelineno-19-37></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineView</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-38><a id=__codelineno-19-38 name=__codelineno-19-38 href=#__codelineno-19-38></a><span class=w>      </span><span class=p>...</span><span class=nx>defaultProps</span><span class=p>,</span>
</span><span id=__span-19-39><a id=__codelineno-19-39 name=__codelineno-19-39 href=#__codelineno-19-39></a><span class=w>      </span><span class=nx>renderItem</span><span class=p>,</span>
</span><span id=__span-19-40><a id=__codelineno-19-40 name=__codelineno-19-40 href=#__codelineno-19-40></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-19-41><a id=__codelineno-19-41 name=__codelineno-19-41 href=#__codelineno-19-41></a>
</span><span id=__span-19-42><a id=__codelineno-19-42 name=__codelineno-19-42 href=#__codelineno-19-42></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>renderItem</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=nx>renderItem</span><span class=p>);</span>
</span><span id=__span-19-43><a id=__codelineno-19-43 name=__codelineno-19-43 href=#__codelineno-19-43></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-19-44><a id=__codelineno-19-44 name=__codelineno-19-44 href=#__codelineno-19-44></a>
</span><span id=__span-19-45><a id=__codelineno-19-45 name=__codelineno-19-45 href=#__codelineno-19-45></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;accepts loading state prop&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-46><a id=__codelineno-19-46 name=__codelineno-19-46 href=#__codelineno-19-46></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineView</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-47><a id=__codelineno-19-47 name=__codelineno-19-47 href=#__codelineno-19-47></a><span class=w>      </span><span class=p>...</span><span class=nx>defaultProps</span><span class=p>,</span>
</span><span id=__span-19-48><a id=__codelineno-19-48 name=__codelineno-19-48 href=#__codelineno-19-48></a><span class=w>      </span><span class=nx>loading</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
</span><span id=__span-19-49><a id=__codelineno-19-49 name=__codelineno-19-49 href=#__codelineno-19-49></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-19-50><a id=__codelineno-19-50 name=__codelineno-19-50 href=#__codelineno-19-50></a>
</span><span id=__span-19-51><a id=__codelineno-19-51 name=__codelineno-19-51 href=#__codelineno-19-51></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>loading</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span><span id=__span-19-52><a id=__codelineno-19-52 name=__codelineno-19-52 href=#__codelineno-19-52></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-19-53><a id=__codelineno-19-53 name=__codelineno-19-53 href=#__codelineno-19-53></a>
</span><span id=__span-19-54><a id=__codelineno-19-54 name=__codelineno-19-54 href=#__codelineno-19-54></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;accepts emptyMessage prop&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-55><a id=__codelineno-19-55 name=__codelineno-19-55 href=#__codelineno-19-55></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineView</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-56><a id=__codelineno-19-56 name=__codelineno-19-56 href=#__codelineno-19-56></a><span class=w>      </span><span class=p>...</span><span class=nx>defaultProps</span><span class=p>,</span>
</span><span id=__span-19-57><a id=__codelineno-19-57 name=__codelineno-19-57 href=#__codelineno-19-57></a><span class=w>      </span><span class=nx>emptyMessage</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;No scenes found&quot;</span><span class=p>,</span>
</span><span id=__span-19-58><a id=__codelineno-19-58 name=__codelineno-19-58 href=#__codelineno-19-58></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-19-59><a id=__codelineno-19-59 name=__codelineno-19-59 href=#__codelineno-19-59></a>
</span><span id=__span-19-60><a id=__codelineno-19-60 name=__codelineno-19-60 href=#__codelineno-19-60></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>emptyMessage</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s2>&quot;No scenes found&quot;</span><span class=p>);</span>
</span><span id=__span-19-61><a id=__codelineno-19-61 name=__codelineno-19-61 href=#__codelineno-19-61></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-19-62><a id=__codelineno-19-62 name=__codelineno-19-62 href=#__codelineno-19-62></a><span class=p>});</span>
</span></code></pre></div> <p><strong>Step 2: Run test to verify it fails</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/client &amp;&amp; npm test -- tests/components/timeline/TimelineView.test.jsx</code> Expected: FAIL with "Cannot find module"</p> <p><strong>Step 3: Write minimal implementation</strong></p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=c1>// client/src/components/timeline/TimelineView.jsx</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>memo</span><span class=p>,</span><span class=w> </span><span class=nx>useMemo</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=k>import</span><span class=w> </span><span class=nx>TimelineControls</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./TimelineControls.jsx&quot;</span><span class=p>;</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=k>import</span><span class=w> </span><span class=nx>TimelineStrip</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./TimelineStrip.jsx&quot;</span><span class=p>;</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useTimelineState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./useTimelineState.js&quot;</span><span class=p>;</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>getGridClasses</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../constants/grids.js&quot;</span><span class=p>;</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=k>import</span><span class=w> </span><span class=nx>Spinner</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../ui/Spinner.jsx&quot;</span><span class=p>;</span>
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a>
</span><span id=__span-20-9><a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=kd>function</span><span class=w> </span><span class=nx>TimelineView</span><span class=p>({</span>
</span><span id=__span-20-10><a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=w>  </span><span class=nx>entityType</span><span class=p>,</span>
</span><span id=__span-20-11><a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=w>  </span><span class=nx>items</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[],</span>
</span><span id=__span-20-12><a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=w>  </span><span class=nx>renderItem</span><span class=p>,</span>
</span><span id=__span-20-13><a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=w>  </span><span class=nx>onItemClick</span><span class=p>,</span>
</span><span id=__span-20-14><a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=w>  </span><span class=nx>loading</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
</span><span id=__span-20-15><a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a><span class=w>  </span><span class=nx>emptyMessage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;No items found&quot;</span><span class=p>,</span>
</span><span id=__span-20-16><a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a><span class=w>  </span><span class=nx>gridDensity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;medium&quot;</span><span class=p>,</span>
</span><span id=__span-20-17><a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a><span class=w>  </span><span class=nx>className</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-20-18><a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a><span class=p>})</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-19><a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-20><a id=__codelineno-20-20 name=__codelineno-20-20 href=#__codelineno-20-20></a><span class=w>    </span><span class=nx>zoomLevel</span><span class=p>,</span>
</span><span id=__span-20-21><a id=__codelineno-20-21 name=__codelineno-20-21 href=#__codelineno-20-21></a><span class=w>    </span><span class=nx>setZoomLevel</span><span class=p>,</span>
</span><span id=__span-20-22><a id=__codelineno-20-22 name=__codelineno-20-22 href=#__codelineno-20-22></a><span class=w>    </span><span class=nx>selectedPeriod</span><span class=p>,</span>
</span><span id=__span-20-23><a id=__codelineno-20-23 name=__codelineno-20-23 href=#__codelineno-20-23></a><span class=w>    </span><span class=nx>selectPeriod</span><span class=p>,</span>
</span><span id=__span-20-24><a id=__codelineno-20-24 name=__codelineno-20-24 href=#__codelineno-20-24></a><span class=w>    </span><span class=nx>distribution</span><span class=p>,</span>
</span><span id=__span-20-25><a id=__codelineno-20-25 name=__codelineno-20-25 href=#__codelineno-20-25></a><span class=w>    </span><span class=nx>maxCount</span><span class=p>,</span>
</span><span id=__span-20-26><a id=__codelineno-20-26 name=__codelineno-20-26 href=#__codelineno-20-26></a><span class=w>    </span><span class=nx>isLoading</span><span class=o>:</span><span class=w> </span><span class=nx>distributionLoading</span><span class=p>,</span>
</span><span id=__span-20-27><a id=__codelineno-20-27 name=__codelineno-20-27 href=#__codelineno-20-27></a><span class=w>    </span><span class=nx>ZOOM_LEVELS</span><span class=p>,</span>
</span><span id=__span-20-28><a id=__codelineno-20-28 name=__codelineno-20-28 href=#__codelineno-20-28></a><span class=w>  </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useTimelineState</span><span class=p>({</span><span class=w> </span><span class=nx>entityType</span><span class=p>,</span><span class=w> </span><span class=nx>autoSelectRecent</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-20-29><a id=__codelineno-20-29 name=__codelineno-20-29 href=#__codelineno-20-29></a>
</span><span id=__span-20-30><a id=__codelineno-20-30 name=__codelineno-20-30 href=#__codelineno-20-30></a><span class=w>  </span><span class=c1>// Build date filter from selected period</span>
</span><span id=__span-20-31><a id=__codelineno-20-31 name=__codelineno-20-31 href=#__codelineno-20-31></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>dateFilter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useMemo</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-32><a id=__codelineno-20-32 name=__codelineno-20-32 href=#__codelineno-20-32></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>selectedPeriod</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span>
</span><span id=__span-20-33><a id=__codelineno-20-33 name=__codelineno-20-33 href=#__codelineno-20-33></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-34><a id=__codelineno-20-34 name=__codelineno-20-34 href=#__codelineno-20-34></a><span class=w>      </span><span class=nx>date</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-35><a id=__codelineno-20-35 name=__codelineno-20-35 href=#__codelineno-20-35></a><span class=w>        </span><span class=nx>value</span><span class=o>:</span><span class=w> </span><span class=nx>selectedPeriod</span><span class=p>.</span><span class=nx>start</span><span class=p>,</span>
</span><span id=__span-20-36><a id=__codelineno-20-36 name=__codelineno-20-36 href=#__codelineno-20-36></a><span class=w>        </span><span class=nx>value2</span><span class=o>:</span><span class=w> </span><span class=nx>selectedPeriod</span><span class=p>.</span><span class=nx>end</span><span class=p>,</span>
</span><span id=__span-20-37><a id=__codelineno-20-37 name=__codelineno-20-37 href=#__codelineno-20-37></a><span class=w>        </span><span class=nx>modifier</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;BETWEEN&quot;</span><span class=p>,</span>
</span><span id=__span-20-38><a id=__codelineno-20-38 name=__codelineno-20-38 href=#__codelineno-20-38></a><span class=w>      </span><span class=p>},</span>
</span><span id=__span-20-39><a id=__codelineno-20-39 name=__codelineno-20-39 href=#__codelineno-20-39></a><span class=w>    </span><span class=p>};</span>
</span><span id=__span-20-40><a id=__codelineno-20-40 name=__codelineno-20-40 href=#__codelineno-20-40></a><span class=w>  </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>selectedPeriod</span><span class=p>]);</span>
</span><span id=__span-20-41><a id=__codelineno-20-41 name=__codelineno-20-41 href=#__codelineno-20-41></a>
</span><span id=__span-20-42><a id=__codelineno-20-42 name=__codelineno-20-42 href=#__codelineno-20-42></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>gridClasses</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>getGridClasses</span><span class=p>(</span><span class=s2>&quot;standard&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>gridDensity</span><span class=p>);</span>
</span><span id=__span-20-43><a id=__codelineno-20-43 name=__codelineno-20-43 href=#__codelineno-20-43></a>
</span><span id=__span-20-44><a id=__codelineno-20-44 name=__codelineno-20-44 href=#__codelineno-20-44></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>isLoading</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>loading</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nx>distributionLoading</span><span class=p>;</span>
</span><span id=__span-20-45><a id=__codelineno-20-45 name=__codelineno-20-45 href=#__codelineno-20-45></a>
</span><span id=__span-20-46><a id=__codelineno-20-46 name=__codelineno-20-46 href=#__codelineno-20-46></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-20-47><a id=__codelineno-20-47 name=__codelineno-20-47 href=#__codelineno-20-47></a><span class=w>    </span><span class=o>&lt;</span><span class=nx>div</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=sb>`flex flex-col h-full </span><span class=si>${</span><span class=nx>className</span><span class=si>}</span><span class=sb>`</span><span class=p>}</span><span class=o>&gt;</span>
</span><span id=__span-20-48><a id=__codelineno-20-48 name=__codelineno-20-48 href=#__codelineno-20-48></a><span class=w>      </span><span class=p>{</span><span class=cm>/* Timeline Header - Fixed */</span><span class=p>}</span>
</span><span id=__span-20-49><a id=__codelineno-20-49 name=__codelineno-20-49 href=#__codelineno-20-49></a><span class=w>      </span><span class=o>&lt;</span><span class=nx>div</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;flex-shrink-0 border-b border-border-primary bg-bg-primary sticky top-0 z-10&quot;</span><span class=o>&gt;</span>
</span><span id=__span-20-50><a id=__codelineno-20-50 name=__codelineno-20-50 href=#__codelineno-20-50></a><span class=w>        </span><span class=p>{</span><span class=cm>/* Controls Row */</span><span class=p>}</span>
</span><span id=__span-20-51><a id=__codelineno-20-51 name=__codelineno-20-51 href=#__codelineno-20-51></a><span class=w>        </span><span class=o>&lt;</span><span class=nx>div</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;flex items-center justify-between px-4 py-2&quot;</span><span class=o>&gt;</span>
</span><span id=__span-20-52><a id=__codelineno-20-52 name=__codelineno-20-52 href=#__codelineno-20-52></a><span class=w>          </span><span class=o>&lt;</span><span class=nx>TimelineControls</span>
</span><span id=__span-20-53><a id=__codelineno-20-53 name=__codelineno-20-53 href=#__codelineno-20-53></a><span class=w>            </span><span class=nx>zoomLevel</span><span class=o>=</span><span class=p>{</span><span class=nx>zoomLevel</span><span class=p>}</span>
</span><span id=__span-20-54><a id=__codelineno-20-54 name=__codelineno-20-54 href=#__codelineno-20-54></a><span class=w>            </span><span class=nx>onZoomLevelChange</span><span class=o>=</span><span class=p>{</span><span class=nx>setZoomLevel</span><span class=p>}</span>
</span><span id=__span-20-55><a id=__codelineno-20-55 name=__codelineno-20-55 href=#__codelineno-20-55></a><span class=w>            </span><span class=nx>zoomLevels</span><span class=o>=</span><span class=p>{</span><span class=nx>ZOOM_LEVELS</span><span class=p>}</span>
</span><span id=__span-20-56><a id=__codelineno-20-56 name=__codelineno-20-56 href=#__codelineno-20-56></a><span class=w>          </span><span class=o>/&gt;</span>
</span><span id=__span-20-57><a id=__codelineno-20-57 name=__codelineno-20-57 href=#__codelineno-20-57></a><span class=w>          </span><span class=p>{</span><span class=nx>selectedPeriod</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-20-58><a id=__codelineno-20-58 name=__codelineno-20-58 href=#__codelineno-20-58></a><span class=w>            </span><span class=o>&lt;</span><span class=nx>div</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;text-sm text-text-secondary&quot;</span><span class=o>&gt;</span>
</span><span id=__span-20-59><a id=__codelineno-20-59 name=__codelineno-20-59 href=#__codelineno-20-59></a><span class=w>              </span><span class=o>&lt;</span><span class=nx>span</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;font-medium text-text-primary&quot;</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>selectedPeriod</span><span class=p>.</span><span class=nx>label</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/span&gt;</span>
</span><span id=__span-20-60><a id=__codelineno-20-60 name=__codelineno-20-60 href=#__codelineno-20-60></a><span class=w>              </span><span class=p>{</span><span class=nx>items</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>0</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-20-61><a id=__codelineno-20-61 name=__codelineno-20-61 href=#__codelineno-20-61></a><span class=w>                </span><span class=o>&lt;</span><span class=nx>span</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;ml-2&quot;</span><span class=o>&gt;</span><span class=p>({</span><span class=nx>items</span><span class=p>.</span><span class=nx>length</span><span class=p>}</span><span class=w> </span><span class=nx>items</span><span class=p>)</span><span class=o>&lt;</span><span class=err>/span&gt;</span>
</span><span id=__span-20-62><a id=__codelineno-20-62 name=__codelineno-20-62 href=#__codelineno-20-62></a><span class=w>              </span><span class=p>)}</span>
</span><span id=__span-20-63><a id=__codelineno-20-63 name=__codelineno-20-63 href=#__codelineno-20-63></a><span class=w>            </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span><span id=__span-20-64><a id=__codelineno-20-64 name=__codelineno-20-64 href=#__codelineno-20-64></a><span class=w>          </span><span class=p>)}</span>
</span><span id=__span-20-65><a id=__codelineno-20-65 name=__codelineno-20-65 href=#__codelineno-20-65></a><span class=w>        </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span><span id=__span-20-66><a id=__codelineno-20-66 name=__codelineno-20-66 href=#__codelineno-20-66></a>
</span><span id=__span-20-67><a id=__codelineno-20-67 name=__codelineno-20-67 href=#__codelineno-20-67></a><span class=w>        </span><span class=p>{</span><span class=cm>/* Timeline Strip */</span><span class=p>}</span>
</span><span id=__span-20-68><a id=__codelineno-20-68 name=__codelineno-20-68 href=#__codelineno-20-68></a><span class=w>        </span><span class=o>&lt;</span><span class=nx>TimelineStrip</span>
</span><span id=__span-20-69><a id=__codelineno-20-69 name=__codelineno-20-69 href=#__codelineno-20-69></a><span class=w>          </span><span class=nx>distribution</span><span class=o>=</span><span class=p>{</span><span class=nx>distribution</span><span class=p>}</span>
</span><span id=__span-20-70><a id=__codelineno-20-70 name=__codelineno-20-70 href=#__codelineno-20-70></a><span class=w>          </span><span class=nx>maxCount</span><span class=o>=</span><span class=p>{</span><span class=nx>maxCount</span><span class=p>}</span>
</span><span id=__span-20-71><a id=__codelineno-20-71 name=__codelineno-20-71 href=#__codelineno-20-71></a><span class=w>          </span><span class=nx>zoomLevel</span><span class=o>=</span><span class=p>{</span><span class=nx>zoomLevel</span><span class=p>}</span>
</span><span id=__span-20-72><a id=__codelineno-20-72 name=__codelineno-20-72 href=#__codelineno-20-72></a><span class=w>          </span><span class=nx>selectedPeriod</span><span class=o>=</span><span class=p>{</span><span class=nx>selectedPeriod</span><span class=p>}</span>
</span><span id=__span-20-73><a id=__codelineno-20-73 name=__codelineno-20-73 href=#__codelineno-20-73></a><span class=w>          </span><span class=nx>onSelectPeriod</span><span class=o>=</span><span class=p>{</span><span class=nx>selectPeriod</span><span class=p>}</span>
</span><span id=__span-20-74><a id=__codelineno-20-74 name=__codelineno-20-74 href=#__codelineno-20-74></a><span class=w>        </span><span class=o>/&gt;</span>
</span><span id=__span-20-75><a id=__codelineno-20-75 name=__codelineno-20-75 href=#__codelineno-20-75></a><span class=w>      </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span><span id=__span-20-76><a id=__codelineno-20-76 name=__codelineno-20-76 href=#__codelineno-20-76></a>
</span><span id=__span-20-77><a id=__codelineno-20-77 name=__codelineno-20-77 href=#__codelineno-20-77></a><span class=w>      </span><span class=p>{</span><span class=cm>/* Results Grid - Scrollable */</span><span class=p>}</span>
</span><span id=__span-20-78><a id=__codelineno-20-78 name=__codelineno-20-78 href=#__codelineno-20-78></a><span class=w>      </span><span class=o>&lt;</span><span class=nx>div</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;flex-1 overflow-y-auto p-4&quot;</span><span class=o>&gt;</span>
</span><span id=__span-20-79><a id=__codelineno-20-79 name=__codelineno-20-79 href=#__codelineno-20-79></a><span class=w>        </span><span class=p>{</span><span class=nx>isLoading</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-20-80><a id=__codelineno-20-80 name=__codelineno-20-80 href=#__codelineno-20-80></a><span class=w>          </span><span class=o>&lt;</span><span class=nx>div</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;flex items-center justify-center h-32&quot;</span><span class=o>&gt;</span>
</span><span id=__span-20-81><a id=__codelineno-20-81 name=__codelineno-20-81 href=#__codelineno-20-81></a><span class=w>            </span><span class=o>&lt;</span><span class=nx>Spinner</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;text-accent-primary&quot;</span><span class=w> </span><span class=o>/&gt;</span>
</span><span id=__span-20-82><a id=__codelineno-20-82 name=__codelineno-20-82 href=#__codelineno-20-82></a><span class=w>          </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span><span id=__span-20-83><a id=__codelineno-20-83 name=__codelineno-20-83 href=#__codelineno-20-83></a><span class=w>        </span><span class=p>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=o>!</span><span class=nx>selectedPeriod</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-20-84><a id=__codelineno-20-84 name=__codelineno-20-84 href=#__codelineno-20-84></a><span class=w>          </span><span class=o>&lt;</span><span class=nx>div</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;flex items-center justify-center h-32 text-text-secondary&quot;</span><span class=o>&gt;</span>
</span><span id=__span-20-85><a id=__codelineno-20-85 name=__codelineno-20-85 href=#__codelineno-20-85></a><span class=w>            </span><span class=nx>Select</span><span class=w> </span><span class=nx>a</span><span class=w> </span><span class=nx>time</span><span class=w> </span><span class=nx>period</span><span class=w> </span><span class=nx>on</span><span class=w> </span><span class=nx>the</span><span class=w> </span><span class=nx>timeline</span><span class=w> </span><span class=nx>above</span>
</span><span id=__span-20-86><a id=__codelineno-20-86 name=__codelineno-20-86 href=#__codelineno-20-86></a><span class=w>          </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span><span id=__span-20-87><a id=__codelineno-20-87 name=__codelineno-20-87 href=#__codelineno-20-87></a><span class=w>        </span><span class=p>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=nx>items</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=mf>0</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-20-88><a id=__codelineno-20-88 name=__codelineno-20-88 href=#__codelineno-20-88></a><span class=w>          </span><span class=o>&lt;</span><span class=nx>div</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;flex items-center justify-center h-32 text-text-secondary&quot;</span><span class=o>&gt;</span>
</span><span id=__span-20-89><a id=__codelineno-20-89 name=__codelineno-20-89 href=#__codelineno-20-89></a><span class=w>            </span><span class=p>{</span><span class=nx>emptyMessage</span><span class=p>}</span>
</span><span id=__span-20-90><a id=__codelineno-20-90 name=__codelineno-20-90 href=#__codelineno-20-90></a><span class=w>          </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span><span id=__span-20-91><a id=__codelineno-20-91 name=__codelineno-20-91 href=#__codelineno-20-91></a><span class=w>        </span><span class=p>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-20-92><a id=__codelineno-20-92 name=__codelineno-20-92 href=#__codelineno-20-92></a><span class=w>          </span><span class=o>&lt;</span><span class=nx>div</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=nx>gridClasses</span><span class=p>}</span><span class=o>&gt;</span>
</span><span id=__span-20-93><a id=__codelineno-20-93 name=__codelineno-20-93 href=#__codelineno-20-93></a><span class=w>            </span><span class=p>{</span><span class=nx>items</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>item</span><span class=p>,</span><span class=w> </span><span class=nx>index</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span>
</span><span id=__span-20-94><a id=__codelineno-20-94 name=__codelineno-20-94 href=#__codelineno-20-94></a><span class=w>              </span><span class=nx>renderItem</span><span class=p>(</span><span class=nx>item</span><span class=p>,</span><span class=w> </span><span class=nx>index</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>onItemClick</span><span class=p>,</span><span class=w> </span><span class=nx>dateFilter</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-20-95><a id=__codelineno-20-95 name=__codelineno-20-95 href=#__codelineno-20-95></a><span class=w>            </span><span class=p>)}</span>
</span><span id=__span-20-96><a id=__codelineno-20-96 name=__codelineno-20-96 href=#__codelineno-20-96></a><span class=w>          </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span><span id=__span-20-97><a id=__codelineno-20-97 name=__codelineno-20-97 href=#__codelineno-20-97></a><span class=w>        </span><span class=p>)}</span>
</span><span id=__span-20-98><a id=__codelineno-20-98 name=__codelineno-20-98 href=#__codelineno-20-98></a><span class=w>      </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span><span id=__span-20-99><a id=__codelineno-20-99 name=__codelineno-20-99 href=#__codelineno-20-99></a><span class=w>    </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span><span id=__span-20-100><a id=__codelineno-20-100 name=__codelineno-20-100 href=#__codelineno-20-100></a><span class=w>  </span><span class=p>);</span>
</span><span id=__span-20-101><a id=__codelineno-20-101 name=__codelineno-20-101 href=#__codelineno-20-101></a><span class=p>}</span>
</span><span id=__span-20-102><a id=__codelineno-20-102 name=__codelineno-20-102 href=#__codelineno-20-102></a>
</span><span id=__span-20-103><a id=__codelineno-20-103 name=__codelineno-20-103 href=#__codelineno-20-103></a><span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=nx>memo</span><span class=p>(</span><span class=nx>TimelineView</span><span class=p>);</span>
</span><span id=__span-20-104><a id=__codelineno-20-104 name=__codelineno-20-104 href=#__codelineno-20-104></a>
</span><span id=__span-20-105><a id=__codelineno-20-105 name=__codelineno-20-105 href=#__codelineno-20-105></a><span class=c1>// Export dateFilter for parent components to use</span>
</span><span id=__span-20-106><a id=__codelineno-20-106 name=__codelineno-20-106 href=#__codelineno-20-106></a><span class=k>export</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>TimelineView</span><span class=w> </span><span class=p>};</span>
</span></code></pre></div> <p><strong>Step 4: Run test to verify it passes</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/client &amp;&amp; npm test -- tests/components/timeline/TimelineView.test.jsx</code> Expected: PASS</p> <p><strong>Step 5: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>git<span class=w> </span>add<span class=w> </span>client/src/components/timeline/TimelineView.jsx<span class=w> </span>client/tests/components/timeline/TimelineView.test.jsx
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;feat(client): add TimelineView main container component&quot;</span>
</span></code></pre></div> <hr> <h2 id=task-8-frontend-add-timeline-to-entity-display-config>Task 8: Frontend - Add Timeline to Entity Display Config<a class=headerlink href=#task-8-frontend-add-timeline-to-entity-display-config title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Modify: <code>client/src/config/entityDisplayConfig.js</code> - Test: <code>client/tests/config/entityDisplayConfig.test.js</code> (create if doesn't exist)</p> <p><strong>Step 1: Write the failing test</strong></p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=c1>// client/tests/config/entityDisplayConfig.test.js</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>describe</span><span class=p>,</span><span class=w> </span><span class=nx>it</span><span class=p>,</span><span class=w> </span><span class=nx>expect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;vitest&quot;</span><span class=p>;</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>ENTITY_DISPLAY_CONFIG</span><span class=p>,</span><span class=w> </span><span class=nx>getViewModes</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../src/config/entityDisplayConfig.js&quot;</span><span class=p>;</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;entityDisplayConfig&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=w>  </span><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;timeline view mode&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;scene entity includes timeline view mode&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>sceneModes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>getViewModes</span><span class=p>(</span><span class=s2>&quot;scene&quot;</span><span class=p>);</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>timelineMode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>sceneModes</span><span class=p>.</span><span class=nx>find</span><span class=p>((</span><span class=nx>m</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>id</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s2>&quot;timeline&quot;</span><span class=p>);</span>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a>
</span><span id=__span-22-11><a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>timelineMode</span><span class=p>).</span><span class=nx>toBeDefined</span><span class=p>();</span>
</span><span id=__span-22-12><a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>timelineMode</span><span class=p>.</span><span class=nx>label</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s2>&quot;Timeline&quot;</span><span class=p>);</span>
</span><span id=__span-22-13><a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-22-14><a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a>
</span><span id=__span-22-15><a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;gallery entity includes timeline view mode&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-16><a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>galleryModes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>getViewModes</span><span class=p>(</span><span class=s2>&quot;gallery&quot;</span><span class=p>);</span>
</span><span id=__span-22-17><a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>timelineMode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>galleryModes</span><span class=p>.</span><span class=nx>find</span><span class=p>((</span><span class=nx>m</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>id</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s2>&quot;timeline&quot;</span><span class=p>);</span>
</span><span id=__span-22-18><a id=__codelineno-22-18 name=__codelineno-22-18 href=#__codelineno-22-18></a>
</span><span id=__span-22-19><a id=__codelineno-22-19 name=__codelineno-22-19 href=#__codelineno-22-19></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>timelineMode</span><span class=p>).</span><span class=nx>toBeDefined</span><span class=p>();</span>
</span><span id=__span-22-20><a id=__codelineno-22-20 name=__codelineno-22-20 href=#__codelineno-22-20></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>timelineMode</span><span class=p>.</span><span class=nx>label</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s2>&quot;Timeline&quot;</span><span class=p>);</span>
</span><span id=__span-22-21><a id=__codelineno-22-21 name=__codelineno-22-21 href=#__codelineno-22-21></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-22-22><a id=__codelineno-22-22 name=__codelineno-22-22 href=#__codelineno-22-22></a>
</span><span id=__span-22-23><a id=__codelineno-22-23 name=__codelineno-22-23 href=#__codelineno-22-23></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;image entity includes timeline view mode&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-24><a id=__codelineno-22-24 name=__codelineno-22-24 href=#__codelineno-22-24></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>imageModes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>getViewModes</span><span class=p>(</span><span class=s2>&quot;image&quot;</span><span class=p>);</span>
</span><span id=__span-22-25><a id=__codelineno-22-25 name=__codelineno-22-25 href=#__codelineno-22-25></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>timelineMode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>imageModes</span><span class=p>.</span><span class=nx>find</span><span class=p>((</span><span class=nx>m</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>id</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s2>&quot;timeline&quot;</span><span class=p>);</span>
</span><span id=__span-22-26><a id=__codelineno-22-26 name=__codelineno-22-26 href=#__codelineno-22-26></a>
</span><span id=__span-22-27><a id=__codelineno-22-27 name=__codelineno-22-27 href=#__codelineno-22-27></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>timelineMode</span><span class=p>).</span><span class=nx>toBeDefined</span><span class=p>();</span>
</span><span id=__span-22-28><a id=__codelineno-22-28 name=__codelineno-22-28 href=#__codelineno-22-28></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>timelineMode</span><span class=p>.</span><span class=nx>label</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s2>&quot;Timeline&quot;</span><span class=p>);</span>
</span><span id=__span-22-29><a id=__codelineno-22-29 name=__codelineno-22-29 href=#__codelineno-22-29></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-22-30><a id=__codelineno-22-30 name=__codelineno-22-30 href=#__codelineno-22-30></a>
</span><span id=__span-22-31><a id=__codelineno-22-31 name=__codelineno-22-31 href=#__codelineno-22-31></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;performer entity does NOT include timeline view mode&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-32><a id=__codelineno-22-32 name=__codelineno-22-32 href=#__codelineno-22-32></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>performerModes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>getViewModes</span><span class=p>(</span><span class=s2>&quot;performer&quot;</span><span class=p>);</span>
</span><span id=__span-22-33><a id=__codelineno-22-33 name=__codelineno-22-33 href=#__codelineno-22-33></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>timelineMode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>performerModes</span><span class=p>.</span><span class=nx>find</span><span class=p>((</span><span class=nx>m</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>id</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s2>&quot;timeline&quot;</span><span class=p>);</span>
</span><span id=__span-22-34><a id=__codelineno-22-34 name=__codelineno-22-34 href=#__codelineno-22-34></a>
</span><span id=__span-22-35><a id=__codelineno-22-35 name=__codelineno-22-35 href=#__codelineno-22-35></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>timelineMode</span><span class=p>).</span><span class=nx>toBeUndefined</span><span class=p>();</span>
</span><span id=__span-22-36><a id=__codelineno-22-36 name=__codelineno-22-36 href=#__codelineno-22-36></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-22-37><a id=__codelineno-22-37 name=__codelineno-22-37 href=#__codelineno-22-37></a>
</span><span id=__span-22-38><a id=__codelineno-22-38 name=__codelineno-22-38 href=#__codelineno-22-38></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;tag entity does NOT include timeline view mode&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-39><a id=__codelineno-22-39 name=__codelineno-22-39 href=#__codelineno-22-39></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>tagModes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>getViewModes</span><span class=p>(</span><span class=s2>&quot;tag&quot;</span><span class=p>);</span>
</span><span id=__span-22-40><a id=__codelineno-22-40 name=__codelineno-22-40 href=#__codelineno-22-40></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>timelineMode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>tagModes</span><span class=p>.</span><span class=nx>find</span><span class=p>((</span><span class=nx>m</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>id</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s2>&quot;timeline&quot;</span><span class=p>);</span>
</span><span id=__span-22-41><a id=__codelineno-22-41 name=__codelineno-22-41 href=#__codelineno-22-41></a>
</span><span id=__span-22-42><a id=__codelineno-22-42 name=__codelineno-22-42 href=#__codelineno-22-42></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>timelineMode</span><span class=p>).</span><span class=nx>toBeUndefined</span><span class=p>();</span>
</span><span id=__span-22-43><a id=__codelineno-22-43 name=__codelineno-22-43 href=#__codelineno-22-43></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-22-44><a id=__codelineno-22-44 name=__codelineno-22-44 href=#__codelineno-22-44></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-22-45><a id=__codelineno-22-45 name=__codelineno-22-45 href=#__codelineno-22-45></a><span class=p>});</span>
</span></code></pre></div> <p><strong>Step 2: Run test to verify it fails</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/client &amp;&amp; npm test -- tests/config/entityDisplayConfig.test.js</code> Expected: FAIL with timeline mode not found</p> <p><strong>Step 3: Modify entityDisplayConfig.js</strong></p> <p>Read the file first, then add timeline to scene, gallery, and image viewModes arrays:</p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1>// In scene config viewModes array, add:</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=p>{</span><span class=w> </span><span class=nx>id</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;timeline&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>label</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Timeline&quot;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=c1>// In gallery config viewModes array, add:</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=p>{</span><span class=w> </span><span class=nx>id</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;timeline&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>label</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Timeline&quot;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=c1>// In image config viewModes array, add:</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=p>{</span><span class=w> </span><span class=nx>id</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;timeline&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>label</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Timeline&quot;</span><span class=w> </span><span class=p>},</span>
</span></code></pre></div> <p><strong>Step 4: Run test to verify it passes</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/client &amp;&amp; npm test -- tests/config/entityDisplayConfig.test.js</code> Expected: PASS</p> <p><strong>Step 5: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a>git<span class=w> </span>add<span class=w> </span>client/src/config/entityDisplayConfig.js<span class=w> </span>client/tests/config/entityDisplayConfig.test.js
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;feat(client): add timeline view mode to scene, gallery, image entities&quot;</span>
</span></code></pre></div> <hr> <h2 id=task-9-frontend-add-timeline-icon-to-viewmodetoggle>Task 9: Frontend - Add Timeline Icon to ViewModeToggle<a class=headerlink href=#task-9-frontend-add-timeline-icon-to-viewmodetoggle title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Modify: <code>client/src/components/ui/ViewModeToggle.jsx</code></p> <p><strong>Step 1: Read current ViewModeToggle implementation</strong></p> <p>Read <code>client/src/components/ui/ViewModeToggle.jsx</code> to understand MODE_ICONS structure.</p> <p><strong>Step 2: Add timeline icon</strong></p> <p>Add to MODE_ICONS object:</p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>Calendar</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>LucideCalendar</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;lucide-react&quot;</span><span class=p>;</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=c1>// In MODE_ICONS:</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=nx>timeline</span><span class=o>:</span><span class=w> </span><span class=nx>LucideCalendar</span><span class=p>,</span>
</span></code></pre></div> <p><strong>Step 3: Run existing ViewModeToggle tests</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/client &amp;&amp; npm test -- tests/components/ui/ViewModeToggle.test.jsx</code> Expected: PASS (no breaking changes)</p> <p><strong>Step 4: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a>git<span class=w> </span>add<span class=w> </span>client/src/components/ui/ViewModeToggle.jsx
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;feat(client): add timeline icon to ViewModeToggle&quot;</span>
</span></code></pre></div> <hr> <h2 id=task-10-frontend-integrate-timeline-into-scenesearch>Task 10: Frontend - Integrate Timeline into SceneSearch<a class=headerlink href=#task-10-frontend-integrate-timeline-into-scenesearch title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Modify: <code>client/src/components/scene-search/SceneSearch.jsx</code></p> <p><strong>Step 1: Read current SceneSearch implementation</strong></p> <p>Read <code>client/src/components/scene-search/SceneSearch.jsx</code> to understand view mode switching pattern.</p> <p><strong>Step 2: Add TimelineView import and rendering</strong></p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c1>// Add import at top:</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=k>import</span><span class=w> </span><span class=nx>TimelineView</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../timeline/TimelineView.jsx&quot;</span><span class=p>;</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=c1>// In VIEW_MODES array, add:</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=p>{</span><span class=w> </span><span class=nx>id</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;timeline&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>label</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Timeline view&quot;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=c1>// In the render function children, add timeline case:</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=nx>viewMode</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s2>&quot;timeline&quot;</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=w>  </span><span class=o>&lt;</span><span class=nx>TimelineView</span>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=w>    </span><span class=nx>entityType</span><span class=o>=</span><span class=s2>&quot;scene&quot;</span>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=w>    </span><span class=nx>items</span><span class=o>=</span><span class=p>{</span><span class=nx>currentScenes</span><span class=p>}</span>
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a><span class=w>    </span><span class=nx>renderItem</span><span class=o>=</span><span class=p>{(</span><span class=nx>scene</span><span class=p>,</span><span class=w> </span><span class=nx>index</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>onItemClick</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=w>      </span><span class=o>&lt;</span><span class=nx>SceneCard</span>
</span><span id=__span-27-14><a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a><span class=w>        </span><span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>scene</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span>
</span><span id=__span-27-15><a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a><span class=w>        </span><span class=nx>scene</span><span class=o>=</span><span class=p>{</span><span class=nx>scene</span><span class=p>}</span>
</span><span id=__span-27-16><a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a><span class=w>        </span><span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>onItemClick</span><span class=o>?</span><span class=p>.(</span><span class=nx>scene</span><span class=p>)}</span>
</span><span id=__span-27-17><a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a><span class=w>        </span><span class=nx>tabIndex</span><span class=o>=</span><span class=p>{</span><span class=mf>0</span><span class=p>}</span>
</span><span id=__span-27-18><a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a><span class=w>      </span><span class=o>/&gt;</span>
</span><span id=__span-27-19><a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a><span class=w>    </span><span class=p>)}</span>
</span><span id=__span-27-20><a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a><span class=w>    </span><span class=nx>onItemClick</span><span class=o>=</span><span class=p>{</span><span class=nx>handleSceneClick</span><span class=p>}</span>
</span><span id=__span-27-21><a id=__codelineno-27-21 name=__codelineno-27-21 href=#__codelineno-27-21></a><span class=w>    </span><span class=nx>loading</span><span class=o>=</span><span class=p>{</span><span class=nx>isLoading</span><span class=p>}</span>
</span><span id=__span-27-22><a id=__codelineno-27-22 name=__codelineno-27-22 href=#__codelineno-27-22></a><span class=w>    </span><span class=nx>emptyMessage</span><span class=o>=</span><span class=s2>&quot;No scenes found for this time period&quot;</span>
</span><span id=__span-27-23><a id=__codelineno-27-23 name=__codelineno-27-23 href=#__codelineno-27-23></a><span class=w>    </span><span class=nx>gridDensity</span><span class=o>=</span><span class=p>{</span><span class=nx>gridDensity</span><span class=p>}</span>
</span><span id=__span-27-24><a id=__codelineno-27-24 name=__codelineno-27-24 href=#__codelineno-27-24></a><span class=w>  </span><span class=o>/&gt;</span>
</span><span id=__span-27-25><a id=__codelineno-27-25 name=__codelineno-27-25 href=#__codelineno-27-25></a><span class=p>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=nx>viewMode</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s2>&quot;table&quot;</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-27-26><a id=__codelineno-27-26 name=__codelineno-27-26 href=#__codelineno-27-26></a><span class=w>  </span><span class=c1>// existing table code...</span>
</span><span id=__span-27-27><a id=__codelineno-27-27 name=__codelineno-27-27 href=#__codelineno-27-27></a><span class=p>)</span>
</span></code></pre></div> <p><strong>Step 3: Run all client tests</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/client &amp;&amp; npm test</code> Expected: All tests PASS</p> <p><strong>Step 4: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a>git<span class=w> </span>add<span class=w> </span>client/src/components/scene-search/SceneSearch.jsx
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;feat(client): integrate TimelineView into SceneSearch&quot;</span>
</span></code></pre></div> <hr> <h2 id=task-11-frontend-integrate-timeline-into-gallerysearch>Task 11: Frontend - Integrate Timeline into GallerySearch<a class=headerlink href=#task-11-frontend-integrate-timeline-into-gallerysearch title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Modify: <code>client/src/components/gallery-search/GallerySearch.jsx</code></p> <p><strong>Step 1: Read current GallerySearch implementation</strong></p> <p>Read <code>client/src/components/gallery-search/GallerySearch.jsx</code>.</p> <p><strong>Step 2: Add TimelineView import and rendering</strong></p> <p>Follow same pattern as SceneSearch:</p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=c1>// Add import:</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=k>import</span><span class=w> </span><span class=nx>TimelineView</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../timeline/TimelineView.jsx&quot;</span><span class=p>;</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=c1>// Add to VIEW_MODES if not using entityDisplayConfig</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=c1>// Add timeline case in render function</span>
</span></code></pre></div> <p><strong>Step 3: Run all client tests</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/client &amp;&amp; npm test</code> Expected: All tests PASS</p> <p><strong>Step 4: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a>git<span class=w> </span>add<span class=w> </span>client/src/components/gallery-search/GallerySearch.jsx
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;feat(client): integrate TimelineView into GallerySearch&quot;</span>
</span></code></pre></div> <hr> <h2 id=task-12-frontend-integrate-timeline-into-imagesearch>Task 12: Frontend - Integrate Timeline into ImageSearch<a class=headerlink href=#task-12-frontend-integrate-timeline-into-imagesearch title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Modify: <code>client/src/components/image-search/ImageSearch.jsx</code></p> <p><strong>Step 1: Read current ImageSearch implementation</strong></p> <p>Read <code>client/src/components/image-search/ImageSearch.jsx</code>.</p> <p><strong>Step 2: Add TimelineView import and rendering</strong></p> <p>Follow same pattern as SceneSearch.</p> <p><strong>Step 3: Run all client tests</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/client &amp;&amp; npm test</code> Expected: All tests PASS</p> <p><strong>Step 4: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a>git<span class=w> </span>add<span class=w> </span>client/src/components/image-search/ImageSearch.jsx
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;feat(client): integrate TimelineView into ImageSearch&quot;</span>
</span></code></pre></div> <hr> <h2 id=task-13-frontend-mobile-bottom-sheet-component>Task 13: Frontend - Mobile Bottom Sheet Component<a class=headerlink href=#task-13-frontend-mobile-bottom-sheet-component title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Create: <code>client/src/components/timeline/TimelineMobileSheet.jsx</code> - Test: <code>client/tests/components/timeline/TimelineMobileSheet.test.jsx</code></p> <p><strong>Step 1: Install bottom sheet package</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=nb>cd</span><span class=w> </span>/home/carrot/code/peek-stash-browser/client<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>npm<span class=w> </span>install<span class=w> </span>react-spring-bottom-sheet
</span></code></pre></div> <p><strong>Step 2: Write the failing test</strong></p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=c1>// client/tests/components/timeline/TimelineMobileSheet.test.jsx</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>describe</span><span class=p>,</span><span class=w> </span><span class=nx>it</span><span class=p>,</span><span class=w> </span><span class=nx>expect</span><span class=p>,</span><span class=w> </span><span class=nx>vi</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;vitest&quot;</span><span class=p>;</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>createElement</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=k>import</span><span class=w> </span><span class=nx>TimelineMobileSheet</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../../src/components/timeline/TimelineMobileSheet.jsx&quot;</span><span class=p>;</span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;TimelineMobileSheet&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-33-7><a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>defaultProps</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-33-8><a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=w>    </span><span class=nx>isOpen</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
</span><span id=__span-33-9><a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a><span class=w>    </span><span class=nx>onDismiss</span><span class=o>:</span><span class=w> </span><span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>(),</span>
</span><span id=__span-33-10><a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a><span class=w>    </span><span class=nx>selectedPeriod</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>period</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2024-03&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>label</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;March 2024&quot;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-33-11><a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a><span class=w>    </span><span class=nx>itemCount</span><span class=o>:</span><span class=w> </span><span class=mf>47</span><span class=p>,</span>
</span><span id=__span-33-12><a id=__codelineno-33-12 name=__codelineno-33-12 href=#__codelineno-33-12></a><span class=w>    </span><span class=nx>children</span><span class=o>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-33-13><a id=__codelineno-33-13 name=__codelineno-33-13 href=#__codelineno-33-13></a><span class=w>  </span><span class=p>};</span>
</span><span id=__span-33-14><a id=__codelineno-33-14 name=__codelineno-33-14 href=#__codelineno-33-14></a>
</span><span id=__span-33-15><a id=__codelineno-33-15 name=__codelineno-33-15 href=#__codelineno-33-15></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;renders with isOpen prop&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-33-16><a id=__codelineno-33-16 name=__codelineno-33-16 href=#__codelineno-33-16></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineMobileSheet</span><span class=p>,</span><span class=w> </span><span class=nx>defaultProps</span><span class=p>);</span>
</span><span id=__span-33-17><a id=__codelineno-33-17 name=__codelineno-33-17 href=#__codelineno-33-17></a>
</span><span id=__span-33-18><a id=__codelineno-33-18 name=__codelineno-33-18 href=#__codelineno-33-18></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>).</span><span class=nx>toBeDefined</span><span class=p>();</span>
</span><span id=__span-33-19><a id=__codelineno-33-19 name=__codelineno-33-19 href=#__codelineno-33-19></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>isOpen</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span><span id=__span-33-20><a id=__codelineno-33-20 name=__codelineno-33-20 href=#__codelineno-33-20></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-33-21><a id=__codelineno-33-21 name=__codelineno-33-21 href=#__codelineno-33-21></a>
</span><span id=__span-33-22><a id=__codelineno-33-22 name=__codelineno-33-22 href=#__codelineno-33-22></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;shows selected period label in minimized state&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-33-23><a id=__codelineno-33-23 name=__codelineno-33-23 href=#__codelineno-33-23></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineMobileSheet</span><span class=p>,</span><span class=w> </span><span class=nx>defaultProps</span><span class=p>);</span>
</span><span id=__span-33-24><a id=__codelineno-33-24 name=__codelineno-33-24 href=#__codelineno-33-24></a>
</span><span id=__span-33-25><a id=__codelineno-33-25 name=__codelineno-33-25 href=#__codelineno-33-25></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>selectedPeriod</span><span class=p>.</span><span class=nx>label</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s2>&quot;March 2024&quot;</span><span class=p>);</span>
</span><span id=__span-33-26><a id=__codelineno-33-26 name=__codelineno-33-26 href=#__codelineno-33-26></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-33-27><a id=__codelineno-33-27 name=__codelineno-33-27 href=#__codelineno-33-27></a>
</span><span id=__span-33-28><a id=__codelineno-33-28 name=__codelineno-33-28 href=#__codelineno-33-28></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;shows item count in minimized state&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-33-29><a id=__codelineno-33-29 name=__codelineno-33-29 href=#__codelineno-33-29></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineMobileSheet</span><span class=p>,</span><span class=w> </span><span class=nx>defaultProps</span><span class=p>);</span>
</span><span id=__span-33-30><a id=__codelineno-33-30 name=__codelineno-33-30 href=#__codelineno-33-30></a>
</span><span id=__span-33-31><a id=__codelineno-33-31 name=__codelineno-33-31 href=#__codelineno-33-31></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>itemCount</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=mf>47</span><span class=p>);</span>
</span><span id=__span-33-32><a id=__codelineno-33-32 name=__codelineno-33-32 href=#__codelineno-33-32></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-33-33><a id=__codelineno-33-33 name=__codelineno-33-33 href=#__codelineno-33-33></a>
</span><span id=__span-33-34><a id=__codelineno-33-34 name=__codelineno-33-34 href=#__codelineno-33-34></a><span class=w>  </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;accepts children for expanded content&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-33-35><a id=__codelineno-33-35 name=__codelineno-33-35 href=#__codelineno-33-35></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>children</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=s2>&quot;div&quot;</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;Timeline content&quot;</span><span class=p>);</span>
</span><span id=__span-33-36><a id=__codelineno-33-36 name=__codelineno-33-36 href=#__codelineno-33-36></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createElement</span><span class=p>(</span><span class=nx>TimelineMobileSheet</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-33-37><a id=__codelineno-33-37 name=__codelineno-33-37 href=#__codelineno-33-37></a><span class=w>      </span><span class=p>...</span><span class=nx>defaultProps</span><span class=p>,</span>
</span><span id=__span-33-38><a id=__codelineno-33-38 name=__codelineno-33-38 href=#__codelineno-33-38></a><span class=w>      </span><span class=nx>children</span><span class=p>,</span>
</span><span id=__span-33-39><a id=__codelineno-33-39 name=__codelineno-33-39 href=#__codelineno-33-39></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-33-40><a id=__codelineno-33-40 name=__codelineno-33-40 href=#__codelineno-33-40></a>
</span><span id=__span-33-41><a id=__codelineno-33-41 name=__codelineno-33-41 href=#__codelineno-33-41></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>children</span><span class=p>).</span><span class=nx>toBeDefined</span><span class=p>();</span>
</span><span id=__span-33-42><a id=__codelineno-33-42 name=__codelineno-33-42 href=#__codelineno-33-42></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-33-43><a id=__codelineno-33-43 name=__codelineno-33-43 href=#__codelineno-33-43></a><span class=p>});</span>
</span></code></pre></div> <p><strong>Step 3: Run test to verify it fails</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/client &amp;&amp; npm test -- tests/components/timeline/TimelineMobileSheet.test.jsx</code> Expected: FAIL with "Cannot find module"</p> <p><strong>Step 4: Write minimal implementation</strong></p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=c1>// client/src/components/timeline/TimelineMobileSheet.jsx</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>memo</span><span class=p>,</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useCallback</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>BottomSheet</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react-spring-bottom-sheet&quot;</span><span class=p>;</span>
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=k>import</span><span class=w> </span><span class=s2>&quot;react-spring-bottom-sheet/dist/style.css&quot;</span><span class=p>;</span>
</span><span id=__span-34-5><a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>ChevronUp</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;lucide-react&quot;</span><span class=p>;</span>
</span><span id=__span-34-6><a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a>
</span><span id=__span-34-7><a id=__codelineno-34-7 name=__codelineno-34-7 href=#__codelineno-34-7></a><span class=kd>const</span><span class=w> </span><span class=nx>SNAP_POINTS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-34-8><a id=__codelineno-34-8 name=__codelineno-34-8 href=#__codelineno-34-8></a><span class=w>  </span><span class=nx>minimized</span><span class=o>:</span><span class=w> </span><span class=mf>48</span><span class=p>,</span>
</span><span id=__span-34-9><a id=__codelineno-34-9 name=__codelineno-34-9 href=#__codelineno-34-9></a><span class=w>  </span><span class=nx>expanded</span><span class=o>:</span><span class=w> </span><span class=mf>200</span><span class=p>,</span>
</span><span id=__span-34-10><a id=__codelineno-34-10 name=__codelineno-34-10 href=#__codelineno-34-10></a><span class=p>};</span>
</span><span id=__span-34-11><a id=__codelineno-34-11 name=__codelineno-34-11 href=#__codelineno-34-11></a>
</span><span id=__span-34-12><a id=__codelineno-34-12 name=__codelineno-34-12 href=#__codelineno-34-12></a><span class=kd>function</span><span class=w> </span><span class=nx>TimelineMobileSheet</span><span class=p>({</span>
</span><span id=__span-34-13><a id=__codelineno-34-13 name=__codelineno-34-13 href=#__codelineno-34-13></a><span class=w>  </span><span class=nx>isOpen</span><span class=p>,</span>
</span><span id=__span-34-14><a id=__codelineno-34-14 name=__codelineno-34-14 href=#__codelineno-34-14></a><span class=w>  </span><span class=nx>onDismiss</span><span class=p>,</span>
</span><span id=__span-34-15><a id=__codelineno-34-15 name=__codelineno-34-15 href=#__codelineno-34-15></a><span class=w>  </span><span class=nx>selectedPeriod</span><span class=p>,</span>
</span><span id=__span-34-16><a id=__codelineno-34-16 name=__codelineno-34-16 href=#__codelineno-34-16></a><span class=w>  </span><span class=nx>itemCount</span><span class=p>,</span>
</span><span id=__span-34-17><a id=__codelineno-34-17 name=__codelineno-34-17 href=#__codelineno-34-17></a><span class=w>  </span><span class=nx>children</span><span class=p>,</span>
</span><span id=__span-34-18><a id=__codelineno-34-18 name=__codelineno-34-18 href=#__codelineno-34-18></a><span class=p>})</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-34-19><a id=__codelineno-34-19 name=__codelineno-34-19 href=#__codelineno-34-19></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>isExpanded</span><span class=p>,</span><span class=w> </span><span class=nx>setIsExpanded</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span><span id=__span-34-20><a id=__codelineno-34-20 name=__codelineno-34-20 href=#__codelineno-34-20></a>
</span><span id=__span-34-21><a id=__codelineno-34-21 name=__codelineno-34-21 href=#__codelineno-34-21></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>handleSnap</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useCallback</span><span class=p>((</span><span class=nx>snapIndex</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-34-22><a id=__codelineno-34-22 name=__codelineno-34-22 href=#__codelineno-34-22></a><span class=w>    </span><span class=nx>setIsExpanded</span><span class=p>(</span><span class=nx>snapIndex</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=mf>1</span><span class=p>);</span>
</span><span id=__span-34-23><a id=__codelineno-34-23 name=__codelineno-34-23 href=#__codelineno-34-23></a><span class=w>  </span><span class=p>},</span><span class=w> </span><span class=p>[]);</span>
</span><span id=__span-34-24><a id=__codelineno-34-24 name=__codelineno-34-24 href=#__codelineno-34-24></a>
</span><span id=__span-34-25><a id=__codelineno-34-25 name=__codelineno-34-25 href=#__codelineno-34-25></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>snapPoints</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useCallback</span><span class=p>(</span>
</span><span id=__span-34-26><a id=__codelineno-34-26 name=__codelineno-34-26 href=#__codelineno-34-26></a><span class=w>    </span><span class=p>({</span><span class=w> </span><span class=nx>maxHeight</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>[</span><span class=nx>SNAP_POINTS</span><span class=p>.</span><span class=nx>minimized</span><span class=p>,</span><span class=w> </span><span class=nb>Math</span><span class=p>.</span><span class=nx>min</span><span class=p>(</span><span class=nx>SNAP_POINTS</span><span class=p>.</span><span class=nx>expanded</span><span class=p>,</span><span class=w> </span><span class=nx>maxHeight</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>0.4</span><span class=p>)],</span>
</span><span id=__span-34-27><a id=__codelineno-34-27 name=__codelineno-34-27 href=#__codelineno-34-27></a><span class=w>    </span><span class=p>[]</span>
</span><span id=__span-34-28><a id=__codelineno-34-28 name=__codelineno-34-28 href=#__codelineno-34-28></a><span class=w>  </span><span class=p>);</span>
</span><span id=__span-34-29><a id=__codelineno-34-29 name=__codelineno-34-29 href=#__codelineno-34-29></a>
</span><span id=__span-34-30><a id=__codelineno-34-30 name=__codelineno-34-30 href=#__codelineno-34-30></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-34-31><a id=__codelineno-34-31 name=__codelineno-34-31 href=#__codelineno-34-31></a><span class=w>    </span><span class=o>&lt;</span><span class=nx>BottomSheet</span>
</span><span id=__span-34-32><a id=__codelineno-34-32 name=__codelineno-34-32 href=#__codelineno-34-32></a><span class=w>      </span><span class=nx>open</span><span class=o>=</span><span class=p>{</span><span class=nx>isOpen</span><span class=p>}</span>
</span><span id=__span-34-33><a id=__codelineno-34-33 name=__codelineno-34-33 href=#__codelineno-34-33></a><span class=w>      </span><span class=nx>onDismiss</span><span class=o>=</span><span class=p>{</span><span class=nx>onDismiss</span><span class=p>}</span>
</span><span id=__span-34-34><a id=__codelineno-34-34 name=__codelineno-34-34 href=#__codelineno-34-34></a><span class=w>      </span><span class=nx>snapPoints</span><span class=o>=</span><span class=p>{</span><span class=nx>snapPoints</span><span class=p>}</span>
</span><span id=__span-34-35><a id=__codelineno-34-35 name=__codelineno-34-35 href=#__codelineno-34-35></a><span class=w>      </span><span class=nx>defaultSnap</span><span class=o>=</span><span class=p>{({</span><span class=w> </span><span class=nx>snapPoints</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>snapPoints</span><span class=p>[</span><span class=mf>0</span><span class=p>]}</span>
</span><span id=__span-34-36><a id=__codelineno-34-36 name=__codelineno-34-36 href=#__codelineno-34-36></a><span class=w>      </span><span class=nx>onSpringEnd</span><span class=o>=</span><span class=p>{</span><span class=nx>handleSnap</span><span class=p>}</span>
</span><span id=__span-34-37><a id=__codelineno-34-37 name=__codelineno-34-37 href=#__codelineno-34-37></a><span class=w>      </span><span class=nx>blocking</span><span class=o>=</span><span class=p>{</span><span class=kc>false</span><span class=p>}</span>
</span><span id=__span-34-38><a id=__codelineno-34-38 name=__codelineno-34-38 href=#__codelineno-34-38></a><span class=w>      </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;timeline-bottom-sheet&quot;</span>
</span><span id=__span-34-39><a id=__codelineno-34-39 name=__codelineno-34-39 href=#__codelineno-34-39></a><span class=w>    </span><span class=o>&gt;</span>
</span><span id=__span-34-40><a id=__codelineno-34-40 name=__codelineno-34-40 href=#__codelineno-34-40></a><span class=w>      </span><span class=p>{</span><span class=cm>/* Minimized Header - Always visible */</span><span class=p>}</span>
</span><span id=__span-34-41><a id=__codelineno-34-41 name=__codelineno-34-41 href=#__codelineno-34-41></a><span class=w>      </span><span class=o>&lt;</span><span class=nx>div</span>
</span><span id=__span-34-42><a id=__codelineno-34-42 name=__codelineno-34-42 href=#__codelineno-34-42></a><span class=w>        </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;flex items-center justify-between px-4 py-3 cursor-pointer&quot;</span>
</span><span id=__span-34-43><a id=__codelineno-34-43 name=__codelineno-34-43 href=#__codelineno-34-43></a><span class=w>        </span><span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setIsExpanded</span><span class=p>(</span><span class=o>!</span><span class=nx>isExpanded</span><span class=p>)}</span>
</span><span id=__span-34-44><a id=__codelineno-34-44 name=__codelineno-34-44 href=#__codelineno-34-44></a><span class=w>      </span><span class=o>&gt;</span>
</span><span id=__span-34-45><a id=__codelineno-34-45 name=__codelineno-34-45 href=#__codelineno-34-45></a><span class=w>        </span><span class=o>&lt;</span><span class=nx>div</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;flex items-center gap-2&quot;</span><span class=o>&gt;</span>
</span><span id=__span-34-46><a id=__codelineno-34-46 name=__codelineno-34-46 href=#__codelineno-34-46></a><span class=w>          </span><span class=p>{</span><span class=cm>/* Drag handle */</span><span class=p>}</span>
</span><span id=__span-34-47><a id=__codelineno-34-47 name=__codelineno-34-47 href=#__codelineno-34-47></a><span class=w>          </span><span class=o>&lt;</span><span class=nx>div</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;w-8 h-1 bg-border-primary rounded-full&quot;</span><span class=w> </span><span class=o>/&gt;</span>
</span><span id=__span-34-48><a id=__codelineno-34-48 name=__codelineno-34-48 href=#__codelineno-34-48></a>
</span><span id=__span-34-49><a id=__codelineno-34-49 name=__codelineno-34-49 href=#__codelineno-34-49></a><span class=w>          </span><span class=p>{</span><span class=nx>selectedPeriod</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-34-50><a id=__codelineno-34-50 name=__codelineno-34-50 href=#__codelineno-34-50></a><span class=w>            </span><span class=o>&lt;</span><span class=nx>span</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;text-sm font-medium text-text-primary&quot;</span><span class=o>&gt;</span>
</span><span id=__span-34-51><a id=__codelineno-34-51 name=__codelineno-34-51 href=#__codelineno-34-51></a><span class=w>              </span><span class=p>{</span><span class=nx>selectedPeriod</span><span class=p>.</span><span class=nx>label</span><span class=p>}</span>
</span><span id=__span-34-52><a id=__codelineno-34-52 name=__codelineno-34-52 href=#__codelineno-34-52></a><span class=w>              </span><span class=p>{</span><span class=nx>itemCount</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>0</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-34-53><a id=__codelineno-34-53 name=__codelineno-34-53 href=#__codelineno-34-53></a><span class=w>                </span><span class=o>&lt;</span><span class=nx>span</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;ml-2 text-text-secondary&quot;</span><span class=o>&gt;</span>
</span><span id=__span-34-54><a id=__codelineno-34-54 name=__codelineno-34-54 href=#__codelineno-34-54></a><span class=w>                  </span><span class=err></span><span class=w> </span><span class=p>{</span><span class=nx>itemCount</span><span class=p>}</span><span class=w> </span><span class=p>{</span><span class=nx>itemCount</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=mf>1</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;item&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;items&quot;</span><span class=p>}</span>
</span><span id=__span-34-55><a id=__codelineno-34-55 name=__codelineno-34-55 href=#__codelineno-34-55></a><span class=w>                </span><span class=o>&lt;</span><span class=err>/span&gt;</span>
</span><span id=__span-34-56><a id=__codelineno-34-56 name=__codelineno-34-56 href=#__codelineno-34-56></a><span class=w>              </span><span class=p>)}</span>
</span><span id=__span-34-57><a id=__codelineno-34-57 name=__codelineno-34-57 href=#__codelineno-34-57></a><span class=w>            </span><span class=o>&lt;</span><span class=err>/span&gt;</span>
</span><span id=__span-34-58><a id=__codelineno-34-58 name=__codelineno-34-58 href=#__codelineno-34-58></a><span class=w>          </span><span class=p>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-34-59><a id=__codelineno-34-59 name=__codelineno-34-59 href=#__codelineno-34-59></a><span class=w>            </span><span class=o>&lt;</span><span class=nx>span</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=s2>&quot;text-sm text-text-secondary&quot;</span><span class=o>&gt;</span>
</span><span id=__span-34-60><a id=__codelineno-34-60 name=__codelineno-34-60 href=#__codelineno-34-60></a><span class=w>              </span><span class=nx>Select</span><span class=w> </span><span class=nx>a</span><span class=w> </span><span class=nx>time</span><span class=w> </span><span class=nx>period</span>
</span><span id=__span-34-61><a id=__codelineno-34-61 name=__codelineno-34-61 href=#__codelineno-34-61></a><span class=w>            </span><span class=o>&lt;</span><span class=err>/span&gt;</span>
</span><span id=__span-34-62><a id=__codelineno-34-62 name=__codelineno-34-62 href=#__codelineno-34-62></a><span class=w>          </span><span class=p>)}</span>
</span><span id=__span-34-63><a id=__codelineno-34-63 name=__codelineno-34-63 href=#__codelineno-34-63></a><span class=w>        </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span><span id=__span-34-64><a id=__codelineno-34-64 name=__codelineno-34-64 href=#__codelineno-34-64></a>
</span><span id=__span-34-65><a id=__codelineno-34-65 name=__codelineno-34-65 href=#__codelineno-34-65></a><span class=w>        </span><span class=o>&lt;</span><span class=nx>ChevronUp</span>
</span><span id=__span-34-66><a id=__codelineno-34-66 name=__codelineno-34-66 href=#__codelineno-34-66></a><span class=w>          </span><span class=nx>size</span><span class=o>=</span><span class=p>{</span><span class=mf>20</span><span class=p>}</span>
</span><span id=__span-34-67><a id=__codelineno-34-67 name=__codelineno-34-67 href=#__codelineno-34-67></a><span class=w>          </span><span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=sb>`text-text-secondary transition-transform </span><span class=si>${</span><span class=nx>isExpanded</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;rotate-180&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=si>}</span><span class=sb>`</span><span class=p>}</span>
</span><span id=__span-34-68><a id=__codelineno-34-68 name=__codelineno-34-68 href=#__codelineno-34-68></a><span class=w>        </span><span class=o>/&gt;</span>
</span><span id=__span-34-69><a id=__codelineno-34-69 name=__codelineno-34-69 href=#__codelineno-34-69></a><span class=w>      </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span><span id=__span-34-70><a id=__codelineno-34-70 name=__codelineno-34-70 href=#__codelineno-34-70></a>
</span><span id=__span-34-71><a id=__codelineno-34-71 name=__codelineno-34-71 href=#__codelineno-34-71></a><span class=w>      </span><span class=p>{</span><span class=cm>/* Expanded Content */</span><span class=p>}</span>
</span><span id=__span-34-72><a id=__codelineno-34-72 name=__codelineno-34-72 href=#__codelineno-34-72></a><span class=w>      </span><span class=o>&lt;</span><span class=nx>div</span><span class=w> </span><span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=sb>`overflow-hidden transition-all </span><span class=si>${</span><span class=nx>isExpanded</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;max-h-[200px]&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;max-h-0&quot;</span><span class=si>}</span><span class=sb>`</span><span class=p>}</span><span class=o>&gt;</span>
</span><span id=__span-34-73><a id=__codelineno-34-73 name=__codelineno-34-73 href=#__codelineno-34-73></a><span class=w>        </span><span class=p>{</span><span class=nx>children</span><span class=p>}</span>
</span><span id=__span-34-74><a id=__codelineno-34-74 name=__codelineno-34-74 href=#__codelineno-34-74></a><span class=w>      </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
</span><span id=__span-34-75><a id=__codelineno-34-75 name=__codelineno-34-75 href=#__codelineno-34-75></a><span class=w>    </span><span class=o>&lt;</span><span class=err>/BottomSheet&gt;</span>
</span><span id=__span-34-76><a id=__codelineno-34-76 name=__codelineno-34-76 href=#__codelineno-34-76></a><span class=w>  </span><span class=p>);</span>
</span><span id=__span-34-77><a id=__codelineno-34-77 name=__codelineno-34-77 href=#__codelineno-34-77></a><span class=p>}</span>
</span><span id=__span-34-78><a id=__codelineno-34-78 name=__codelineno-34-78 href=#__codelineno-34-78></a>
</span><span id=__span-34-79><a id=__codelineno-34-79 name=__codelineno-34-79 href=#__codelineno-34-79></a><span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=nx>memo</span><span class=p>(</span><span class=nx>TimelineMobileSheet</span><span class=p>);</span>
</span></code></pre></div> <p><strong>Step 5: Run test to verify it passes</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/client &amp;&amp; npm test -- tests/components/timeline/TimelineMobileSheet.test.jsx</code> Expected: PASS</p> <p><strong>Step 6: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a>git<span class=w> </span>add<span class=w> </span>client/src/components/timeline/TimelineMobileSheet.jsx<span class=w> </span>client/tests/components/timeline/TimelineMobileSheet.test.jsx<span class=w> </span>package.json<span class=w> </span>package-lock.json
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;feat(client): add TimelineMobileSheet bottom sheet component&quot;</span>
</span></code></pre></div> <hr> <h2 id=task-14-frontend-add-mobile-detection-and-sheet-integration>Task 14: Frontend - Add Mobile Detection and Sheet Integration<a class=headerlink href=#task-14-frontend-add-mobile-detection-and-sheet-integration title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Modify: <code>client/src/components/timeline/TimelineView.jsx</code></p> <p><strong>Step 1: Read useMediaQuery or similar hook</strong></p> <p>Check for existing mobile detection hooks in the codebase.</p> <p><strong>Step 2: Integrate mobile bottom sheet</strong></p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=c1>// Add imports:</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a><span class=k>import</span><span class=w> </span><span class=nx>TimelineMobileSheet</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./TimelineMobileSheet.jsx&quot;</span><span class=p>;</span>
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useMediaQuery</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../hooks/useMediaQuery.js&quot;</span><span class=p>;</span><span class=w> </span><span class=c1>// or create if needed</span>
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a>
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a><span class=c1>// In component:</span>
</span><span id=__span-36-6><a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a><span class=kd>const</span><span class=w> </span><span class=nx>isMobile</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useMediaQuery</span><span class=p>(</span><span class=s2>&quot;(max-width: 768px)&quot;</span><span class=p>);</span>
</span><span id=__span-36-7><a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a>
</span><span id=__span-36-8><a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a><span class=c1>// Conditional rendering:</span>
</span><span id=__span-36-9><a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a><span class=p>{</span><span class=nx>isMobile</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-36-10><a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a><span class=w>  </span><span class=o>&lt;</span><span class=nx>TimelineMobileSheet</span>
</span><span id=__span-36-11><a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a><span class=w>    </span><span class=nx>isOpen</span><span class=o>=</span><span class=p>{</span><span class=kc>true</span><span class=p>}</span>
</span><span id=__span-36-12><a id=__codelineno-36-12 name=__codelineno-36-12 href=#__codelineno-36-12></a><span class=w>    </span><span class=nx>selectedPeriod</span><span class=o>=</span><span class=p>{</span><span class=nx>selectedPeriod</span><span class=p>}</span>
</span><span id=__span-36-13><a id=__codelineno-36-13 name=__codelineno-36-13 href=#__codelineno-36-13></a><span class=w>    </span><span class=nx>itemCount</span><span class=o>=</span><span class=p>{</span><span class=nx>items</span><span class=p>.</span><span class=nx>length</span><span class=p>}</span>
</span><span id=__span-36-14><a id=__codelineno-36-14 name=__codelineno-36-14 href=#__codelineno-36-14></a><span class=w>  </span><span class=o>&gt;</span>
</span><span id=__span-36-15><a id=__codelineno-36-15 name=__codelineno-36-15 href=#__codelineno-36-15></a><span class=w>    </span><span class=o>&lt;</span><span class=nx>TimelineControls</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=o>/&gt;</span>
</span><span id=__span-36-16><a id=__codelineno-36-16 name=__codelineno-36-16 href=#__codelineno-36-16></a><span class=w>    </span><span class=o>&lt;</span><span class=nx>TimelineStrip</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=o>/&gt;</span>
</span><span id=__span-36-17><a id=__codelineno-36-17 name=__codelineno-36-17 href=#__codelineno-36-17></a><span class=w>  </span><span class=o>&lt;</span><span class=err>/TimelineMobileSheet&gt;</span>
</span><span id=__span-36-18><a id=__codelineno-36-18 name=__codelineno-36-18 href=#__codelineno-36-18></a><span class=p>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-36-19><a id=__codelineno-36-19 name=__codelineno-36-19 href=#__codelineno-36-19></a><span class=w>  </span><span class=c1>// Desktop layout (existing)</span>
</span><span id=__span-36-20><a id=__codelineno-36-20 name=__codelineno-36-20 href=#__codelineno-36-20></a><span class=p>)}</span>
</span></code></pre></div> <p><strong>Step 3: Run all client tests</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/client &amp;&amp; npm test</code> Expected: All tests PASS</p> <p><strong>Step 4: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a>git<span class=w> </span>add<span class=w> </span>client/src/components/timeline/TimelineView.jsx
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;feat(client): add mobile bottom sheet layout to TimelineView&quot;</span>
</span></code></pre></div> <hr> <h2 id=task-15-integration-test-timeline-api-endpoint>Task 15: Integration Test - Timeline API Endpoint<a class=headerlink href=#task-15-integration-test-timeline-api-endpoint title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Create: <code>server/integration/api/timeline.integration.test.ts</code></p> <p><strong>Step 1: Write integration test</strong></p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=c1>// server/integration/api/timeline.integration.test.ts</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>describe</span><span class=p>,</span><span class=w> </span><span class=nx>it</span><span class=p>,</span><span class=w> </span><span class=nx>expect</span><span class=p>,</span><span class=w> </span><span class=nx>beforeAll</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;vitest&quot;</span><span class=p>;</span>
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>adminClient</span><span class=p>,</span><span class=w> </span><span class=nx>guestClient</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../helpers/testClient.js&quot;</span><span class=p>;</span>
</span><span id=__span-38-4><a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>TEST_ADMIN</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../fixtures/testEntities.js&quot;</span><span class=p>;</span>
</span><span id=__span-38-5><a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a>
</span><span id=__span-38-6><a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=kd>interface</span><span class=w> </span><span class=nx>DistributionResponse</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-7><a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a><span class=w>  </span><span class=nx>distribution</span><span class=o>:</span><span class=w> </span><span class=kt>Array</span><span class=o>&lt;</span><span class=p>{</span>
</span><span id=__span-38-8><a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=w>    </span><span class=nx>period</span><span class=o>:</span><span class=w> </span><span class=kt>string</span><span class=p>;</span>
</span><span id=__span-38-9><a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a><span class=w>    </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=kt>number</span><span class=p>;</span>
</span><span id=__span-38-10><a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a><span class=w>  </span><span class=p>}</span><span class=o>&gt;</span><span class=p>;</span>
</span><span id=__span-38-11><a id=__codelineno-38-11 name=__codelineno-38-11 href=#__codelineno-38-11></a><span class=p>}</span>
</span><span id=__span-38-12><a id=__codelineno-38-12 name=__codelineno-38-12 href=#__codelineno-38-12></a>
</span><span id=__span-38-13><a id=__codelineno-38-13 name=__codelineno-38-13 href=#__codelineno-38-13></a><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;Timeline API&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-14><a id=__codelineno-38-14 name=__codelineno-38-14 href=#__codelineno-38-14></a><span class=w>  </span><span class=nx>beforeAll</span><span class=p>(</span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-15><a id=__codelineno-38-15 name=__codelineno-38-15 href=#__codelineno-38-15></a><span class=w>    </span><span class=k>await</span><span class=w> </span><span class=nx>adminClient</span><span class=p>.</span><span class=nx>login</span><span class=p>(</span><span class=nx>TEST_ADMIN</span><span class=p>.</span><span class=nx>username</span><span class=p>,</span><span class=w> </span><span class=nx>TEST_ADMIN</span><span class=p>.</span><span class=nx>password</span><span class=p>);</span>
</span><span id=__span-38-16><a id=__codelineno-38-16 name=__codelineno-38-16 href=#__codelineno-38-16></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-38-17><a id=__codelineno-38-17 name=__codelineno-38-17 href=#__codelineno-38-17></a>
</span><span id=__span-38-18><a id=__codelineno-38-18 name=__codelineno-38-18 href=#__codelineno-38-18></a><span class=w>  </span><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;GET /api/timeline/:entityType/distribution&quot;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-19><a id=__codelineno-38-19 name=__codelineno-38-19 href=#__codelineno-38-19></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;rejects unauthenticated requests&quot;</span><span class=p>,</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-20><a id=__codelineno-38-20 name=__codelineno-38-20 href=#__codelineno-38-20></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>guestClient</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&quot;/api/timeline/scene/distribution&quot;</span><span class=p>);</span>
</span><span id=__span-38-21><a id=__codelineno-38-21 name=__codelineno-38-21 href=#__codelineno-38-21></a>
</span><span id=__span-38-22><a id=__codelineno-38-22 name=__codelineno-38-22 href=#__codelineno-38-22></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>status</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=mf>401</span><span class=p>);</span>
</span><span id=__span-38-23><a id=__codelineno-38-23 name=__codelineno-38-23 href=#__codelineno-38-23></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-38-24><a id=__codelineno-38-24 name=__codelineno-38-24 href=#__codelineno-38-24></a>
</span><span id=__span-38-25><a id=__codelineno-38-25 name=__codelineno-38-25 href=#__codelineno-38-25></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;returns distribution for scenes with default granularity&quot;</span><span class=p>,</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-26><a id=__codelineno-38-26 name=__codelineno-38-26 href=#__codelineno-38-26></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>adminClient</span><span class=p>.</span><span class=nx>get</span><span class=o>&lt;</span><span class=nx>DistributionResponse</span><span class=o>&gt;</span><span class=p>(</span>
</span><span id=__span-38-27><a id=__codelineno-38-27 name=__codelineno-38-27 href=#__codelineno-38-27></a><span class=w>        </span><span class=s2>&quot;/api/timeline/scene/distribution&quot;</span>
</span><span id=__span-38-28><a id=__codelineno-38-28 name=__codelineno-38-28 href=#__codelineno-38-28></a><span class=w>      </span><span class=p>);</span>
</span><span id=__span-38-29><a id=__codelineno-38-29 name=__codelineno-38-29 href=#__codelineno-38-29></a>
</span><span id=__span-38-30><a id=__codelineno-38-30 name=__codelineno-38-30 href=#__codelineno-38-30></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>ok</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span><span id=__span-38-31><a id=__codelineno-38-31 name=__codelineno-38-31 href=#__codelineno-38-31></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>distribution</span><span class=p>).</span><span class=nx>toBeDefined</span><span class=p>();</span>
</span><span id=__span-38-32><a id=__codelineno-38-32 name=__codelineno-38-32 href=#__codelineno-38-32></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nb>Array</span><span class=p>.</span><span class=nx>isArray</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>distribution</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span><span id=__span-38-33><a id=__codelineno-38-33 name=__codelineno-38-33 href=#__codelineno-38-33></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-38-34><a id=__codelineno-38-34 name=__codelineno-38-34 href=#__codelineno-38-34></a>
</span><span id=__span-38-35><a id=__codelineno-38-35 name=__codelineno-38-35 href=#__codelineno-38-35></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;returns distribution for galleries&quot;</span><span class=p>,</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-36><a id=__codelineno-38-36 name=__codelineno-38-36 href=#__codelineno-38-36></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>adminClient</span><span class=p>.</span><span class=nx>get</span><span class=o>&lt;</span><span class=nx>DistributionResponse</span><span class=o>&gt;</span><span class=p>(</span>
</span><span id=__span-38-37><a id=__codelineno-38-37 name=__codelineno-38-37 href=#__codelineno-38-37></a><span class=w>        </span><span class=s2>&quot;/api/timeline/gallery/distribution?granularity=years&quot;</span>
</span><span id=__span-38-38><a id=__codelineno-38-38 name=__codelineno-38-38 href=#__codelineno-38-38></a><span class=w>      </span><span class=p>);</span>
</span><span id=__span-38-39><a id=__codelineno-38-39 name=__codelineno-38-39 href=#__codelineno-38-39></a>
</span><span id=__span-38-40><a id=__codelineno-38-40 name=__codelineno-38-40 href=#__codelineno-38-40></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>ok</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span><span id=__span-38-41><a id=__codelineno-38-41 name=__codelineno-38-41 href=#__codelineno-38-41></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>distribution</span><span class=p>).</span><span class=nx>toBeDefined</span><span class=p>();</span>
</span><span id=__span-38-42><a id=__codelineno-38-42 name=__codelineno-38-42 href=#__codelineno-38-42></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-38-43><a id=__codelineno-38-43 name=__codelineno-38-43 href=#__codelineno-38-43></a>
</span><span id=__span-38-44><a id=__codelineno-38-44 name=__codelineno-38-44 href=#__codelineno-38-44></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;returns distribution for images&quot;</span><span class=p>,</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-45><a id=__codelineno-38-45 name=__codelineno-38-45 href=#__codelineno-38-45></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>adminClient</span><span class=p>.</span><span class=nx>get</span><span class=o>&lt;</span><span class=nx>DistributionResponse</span><span class=o>&gt;</span><span class=p>(</span>
</span><span id=__span-38-46><a id=__codelineno-38-46 name=__codelineno-38-46 href=#__codelineno-38-46></a><span class=w>        </span><span class=s2>&quot;/api/timeline/image/distribution?granularity=days&quot;</span>
</span><span id=__span-38-47><a id=__codelineno-38-47 name=__codelineno-38-47 href=#__codelineno-38-47></a><span class=w>      </span><span class=p>);</span>
</span><span id=__span-38-48><a id=__codelineno-38-48 name=__codelineno-38-48 href=#__codelineno-38-48></a>
</span><span id=__span-38-49><a id=__codelineno-38-49 name=__codelineno-38-49 href=#__codelineno-38-49></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>ok</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span><span id=__span-38-50><a id=__codelineno-38-50 name=__codelineno-38-50 href=#__codelineno-38-50></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>distribution</span><span class=p>).</span><span class=nx>toBeDefined</span><span class=p>();</span>
</span><span id=__span-38-51><a id=__codelineno-38-51 name=__codelineno-38-51 href=#__codelineno-38-51></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-38-52><a id=__codelineno-38-52 name=__codelineno-38-52 href=#__codelineno-38-52></a>
</span><span id=__span-38-53><a id=__codelineno-38-53 name=__codelineno-38-53 href=#__codelineno-38-53></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;returns 400 for invalid entity type&quot;</span><span class=p>,</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-54><a id=__codelineno-38-54 name=__codelineno-38-54 href=#__codelineno-38-54></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>adminClient</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&quot;/api/timeline/invalid/distribution&quot;</span><span class=p>);</span>
</span><span id=__span-38-55><a id=__codelineno-38-55 name=__codelineno-38-55 href=#__codelineno-38-55></a>
</span><span id=__span-38-56><a id=__codelineno-38-56 name=__codelineno-38-56 href=#__codelineno-38-56></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>status</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=mf>400</span><span class=p>);</span>
</span><span id=__span-38-57><a id=__codelineno-38-57 name=__codelineno-38-57 href=#__codelineno-38-57></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-38-58><a id=__codelineno-38-58 name=__codelineno-38-58 href=#__codelineno-38-58></a>
</span><span id=__span-38-59><a id=__codelineno-38-59 name=__codelineno-38-59 href=#__codelineno-38-59></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;returns 400 for invalid granularity&quot;</span><span class=p>,</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-60><a id=__codelineno-38-60 name=__codelineno-38-60 href=#__codelineno-38-60></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>adminClient</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span>
</span><span id=__span-38-61><a id=__codelineno-38-61 name=__codelineno-38-61 href=#__codelineno-38-61></a><span class=w>        </span><span class=s2>&quot;/api/timeline/scene/distribution?granularity=invalid&quot;</span>
</span><span id=__span-38-62><a id=__codelineno-38-62 name=__codelineno-38-62 href=#__codelineno-38-62></a><span class=w>      </span><span class=p>);</span>
</span><span id=__span-38-63><a id=__codelineno-38-63 name=__codelineno-38-63 href=#__codelineno-38-63></a>
</span><span id=__span-38-64><a id=__codelineno-38-64 name=__codelineno-38-64 href=#__codelineno-38-64></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>status</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=mf>400</span><span class=p>);</span>
</span><span id=__span-38-65><a id=__codelineno-38-65 name=__codelineno-38-65 href=#__codelineno-38-65></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-38-66><a id=__codelineno-38-66 name=__codelineno-38-66 href=#__codelineno-38-66></a>
</span><span id=__span-38-67><a id=__codelineno-38-67 name=__codelineno-38-67 href=#__codelineno-38-67></a><span class=w>    </span><span class=nx>it</span><span class=p>(</span><span class=s2>&quot;distribution items have period and count&quot;</span><span class=p>,</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-68><a id=__codelineno-38-68 name=__codelineno-38-68 href=#__codelineno-38-68></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>adminClient</span><span class=p>.</span><span class=nx>get</span><span class=o>&lt;</span><span class=nx>DistributionResponse</span><span class=o>&gt;</span><span class=p>(</span>
</span><span id=__span-38-69><a id=__codelineno-38-69 name=__codelineno-38-69 href=#__codelineno-38-69></a><span class=w>        </span><span class=s2>&quot;/api/timeline/scene/distribution?granularity=months&quot;</span>
</span><span id=__span-38-70><a id=__codelineno-38-70 name=__codelineno-38-70 href=#__codelineno-38-70></a><span class=w>      </span><span class=p>);</span>
</span><span id=__span-38-71><a id=__codelineno-38-71 name=__codelineno-38-71 href=#__codelineno-38-71></a>
</span><span id=__span-38-72><a id=__codelineno-38-72 name=__codelineno-38-72 href=#__codelineno-38-72></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>ok</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span><span id=__span-38-73><a id=__codelineno-38-73 name=__codelineno-38-73 href=#__codelineno-38-73></a>
</span><span id=__span-38-74><a id=__codelineno-38-74 name=__codelineno-38-74 href=#__codelineno-38-74></a><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>distribution</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-75><a id=__codelineno-38-75 name=__codelineno-38-75 href=#__codelineno-38-75></a><span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>item</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>distribution</span><span class=p>[</span><span class=mf>0</span><span class=p>];</span>
</span><span id=__span-38-76><a id=__codelineno-38-76 name=__codelineno-38-76 href=#__codelineno-38-76></a><span class=w>        </span><span class=nx>expect</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>period</span><span class=p>).</span><span class=nx>toBeDefined</span><span class=p>();</span>
</span><span id=__span-38-77><a id=__codelineno-38-77 name=__codelineno-38-77 href=#__codelineno-38-77></a><span class=w>        </span><span class=nx>expect</span><span class=p>(</span><span class=ow>typeof</span><span class=w> </span><span class=nx>item</span><span class=p>.</span><span class=nx>period</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s2>&quot;string&quot;</span><span class=p>);</span>
</span><span id=__span-38-78><a id=__codelineno-38-78 name=__codelineno-38-78 href=#__codelineno-38-78></a><span class=w>        </span><span class=nx>expect</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>count</span><span class=p>).</span><span class=nx>toBeDefined</span><span class=p>();</span>
</span><span id=__span-38-79><a id=__codelineno-38-79 name=__codelineno-38-79 href=#__codelineno-38-79></a><span class=w>        </span><span class=nx>expect</span><span class=p>(</span><span class=ow>typeof</span><span class=w> </span><span class=nx>item</span><span class=p>.</span><span class=nx>count</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s2>&quot;number&quot;</span><span class=p>);</span>
</span><span id=__span-38-80><a id=__codelineno-38-80 name=__codelineno-38-80 href=#__codelineno-38-80></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-38-81><a id=__codelineno-38-81 name=__codelineno-38-81 href=#__codelineno-38-81></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-38-82><a id=__codelineno-38-82 name=__codelineno-38-82 href=#__codelineno-38-82></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-38-83><a id=__codelineno-38-83 name=__codelineno-38-83 href=#__codelineno-38-83></a><span class=p>});</span>
</span></code></pre></div> <p><strong>Step 2: Run integration test</strong></p> <p>Run: <code>cd /home/carrot/code/peek-stash-browser/server &amp;&amp; npm run test:integration -- timeline.integration.test.ts</code> Expected: PASS</p> <p><strong>Step 3: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a>git<span class=w> </span>add<span class=w> </span>server/integration/api/timeline.integration.test.ts
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;test(server): add timeline API integration tests&quot;</span>
</span></code></pre></div> <hr> <h2 id=task-16-manual-testing-polish>Task 16: Manual Testing &amp; Polish<a class=headerlink href=#task-16-manual-testing-polish title="Permanent link">&para;</a></h2> <p><strong>Step 1: Start dev servers</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=c1># Terminal 1 - Server</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=nb>cd</span><span class=w> </span>/home/carrot/code/peek-stash-browser/server<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>npm<span class=w> </span>run<span class=w> </span>dev
</span><span id=__span-40-3><a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a>
</span><span id=__span-40-4><a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=c1># Terminal 2 - Client</span>
</span><span id=__span-40-5><a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=nb>cd</span><span class=w> </span>/home/carrot/code/peek-stash-browser/client<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>npm<span class=w> </span>run<span class=w> </span>dev
</span></code></pre></div> <p><strong>Step 2: Manual test checklist</strong></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Navigate to Scenes page</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Switch to Timeline view mode</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Verify timeline strip renders with bars</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Click zoom level buttons (Years/Months/Weeks/Days)</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Click a bar to select time period</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Verify results grid updates with filtered scenes</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Test keyboard navigation (arrow keys, Enter)</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Test on mobile viewport (resize browser or use DevTools)</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Verify bottom sheet expands/collapses</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Repeat for Galleries and Images pages</li> </ul> <p><strong>Step 3: Fix any visual issues found</strong></p> <p>Address any styling or UX issues discovered during manual testing.</p> <p><strong>Step 4: Final commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a>git<span class=w> </span>add<span class=w> </span>-A
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;chore: polish timeline view styling and interactions&quot;</span>
</span></code></pre></div> <hr> <h2 id=task-17-run-full-test-suite-final-commit>Task 17: Run Full Test Suite &amp; Final Commit<a class=headerlink href=#task-17-run-full-test-suite-final-commit title="Permanent link">&para;</a></h2> <p><strong>Step 1: Run all tests</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=c1># Server unit tests</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=nb>cd</span><span class=w> </span>/home/carrot/code/peek-stash-browser/server<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>npm<span class=w> </span><span class=nb>test</span>
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a>
</span><span id=__span-42-4><a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=c1># Server integration tests</span>
</span><span id=__span-42-5><a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a><span class=nb>cd</span><span class=w> </span>/home/carrot/code/peek-stash-browser/server<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>npm<span class=w> </span>run<span class=w> </span>test:integration
</span><span id=__span-42-6><a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a>
</span><span id=__span-42-7><a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a><span class=c1># Client tests</span>
</span><span id=__span-42-8><a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a><span class=nb>cd</span><span class=w> </span>/home/carrot/code/peek-stash-browser/client<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>npm<span class=w> </span><span class=nb>test</span>
</span></code></pre></div> <p><strong>Step 2: Verify all pass</strong></p> <p>Expected: All tests PASS</p> <p><strong>Step 3: Create index export file</strong></p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=c1>// client/src/components/timeline/index.js</span>
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=k>export</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>TimelineView</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./TimelineView.jsx&quot;</span><span class=p>;</span>
</span><span id=__span-43-3><a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=k>export</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>TimelineStrip</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./TimelineStrip.jsx&quot;</span><span class=p>;</span>
</span><span id=__span-43-4><a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=k>export</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>TimelineControls</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./TimelineControls.jsx&quot;</span><span class=p>;</span>
</span><span id=__span-43-5><a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=k>export</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>TimelineBar</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./TimelineBar.jsx&quot;</span><span class=p>;</span>
</span><span id=__span-43-6><a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a><span class=k>export</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>TimelineMobileSheet</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./TimelineMobileSheet.jsx&quot;</span><span class=p>;</span>
</span><span id=__span-43-7><a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a><span class=k>export</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useTimelineState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./useTimelineState.js&quot;</span><span class=p>;</span>
</span></code></pre></div> <p><strong>Step 4: Final commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a>git<span class=w> </span>add<span class=w> </span>client/src/components/timeline/index.js
</span><span id=__span-44-2><a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;feat: complete timeline view implementation&quot;</span>
</span></code></pre></div> <hr> <h2 id=summary>Summary<a class=headerlink href=#summary title="Permanent link">&para;</a></h2> <p>This plan implements the Timeline View feature in 17 tasks:</p> <table> <thead> <tr> <th>Task</th> <th>Component</th> <th>Type</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>TimelineService</td> <td>Backend</td> </tr> <tr> <td>2</td> <td>Timeline Controller + Route</td> <td>Backend</td> </tr> <tr> <td>3</td> <td>useTimelineState hook</td> <td>Frontend</td> </tr> <tr> <td>4</td> <td>TimelineControls</td> <td>Frontend</td> </tr> <tr> <td>5</td> <td>TimelineBar</td> <td>Frontend</td> </tr> <tr> <td>6</td> <td>TimelineStrip</td> <td>Frontend</td> </tr> <tr> <td>7</td> <td>TimelineView</td> <td>Frontend</td> </tr> <tr> <td>8</td> <td>entityDisplayConfig</td> <td>Frontend</td> </tr> <tr> <td>9</td> <td>ViewModeToggle icon</td> <td>Frontend</td> </tr> <tr> <td>10</td> <td>SceneSearch integration</td> <td>Frontend</td> </tr> <tr> <td>11</td> <td>GallerySearch integration</td> <td>Frontend</td> </tr> <tr> <td>12</td> <td>ImageSearch integration</td> <td>Frontend</td> </tr> <tr> <td>13</td> <td>TimelineMobileSheet</td> <td>Frontend</td> </tr> <tr> <td>14</td> <td>Mobile detection integration</td> <td>Frontend</td> </tr> <tr> <td>15</td> <td>Integration tests</td> <td>Testing</td> </tr> <tr> <td>16</td> <td>Manual testing</td> <td>QA</td> </tr> <tr> <td>17</td> <td>Final test suite</td> <td>QA</td> </tr> </tbody> </table> <p>Each task follows TDD with explicit test  fail  implement  pass  commit steps.</p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2025 carrotwaxr </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/carrotwaxr/peek-stash-browser target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://hub.docker.com/r/carrotwaxr/peek-stash-browser target=_blank rel=noopener title=hub.docker.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1zm0-204.3h-66.1v60.7h66.1zm78.2 144.8H362v59.4h66.1zm-156.3-72.1h-66.1v60.1h66.1zm78.1 0h-66.1v60.1h66.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1zm78.1 0h-66.1v59.4h66.1zm-78.1-72.1h-66.1v60.1h66.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.sections", "navigation.expand", "navigation.top", "navigation.footer", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> <script src=../../javascripts/extra.js></script> </body> </html>