# Windows development override
# Usage: docker-compose -f docker-compose.yml -f docker-compose.windows.yml up
#
# Fixes slow SQLite performance on Windows Docker Desktop by using a named volume
# instead of a bind mount. Bind mounts on Windows go through WSL2's 9P filesystem
# which has poor I/O performance for database workloads.
#
# Note: Uses /peek-data instead of /app/data because /app is bind-mounted for hot reload
#
# First-time setup (migrate existing data):
#   docker volume create peek-stash-browser_peek-data
#   docker run --rm -v peek-stash-browser_peek-data:/data -v "C:/Users/YOU/.peek-data:/source:ro" alpine cp -av /source/. /data/

services:
  peek-server:
    environment:
      # Override config dir to use named volume path (outside /app bind mount)
      CONFIG_DIR: /peek-data
      DATABASE_URL: file:/peek-data/peek-stash-browser.db
    volumes:
      # Named volume mounted outside /app to avoid being shadowed by source bind mount
      - peek-data:/peek-data

volumes:
  peek-data:
    name: peek-stash-browser_peek-data
