# Windows development override
# Usage: docker-compose -f docker-compose.yml -f docker-compose.windows.yml up
#
# Fixes two Windows Docker Desktop issues:
# 1. Slow SQLite: Uses named volume instead of bind mount (WSL2's 9P has poor I/O)
# 2. HMR not working: Enables polling for file watching (WSL2 doesn't propagate fs events)
#
# Note: Uses /peek-data instead of /app/data because /app is bind-mounted for hot reload
#
# First-time setup (migrate existing data):
#   docker volume create peek-stash-browser_peek-data
#   docker run --rm -v peek-stash-browser_peek-data:/data -v "C:/Users/YOU/.peek-data:/source:ro" alpine cp -av /source/. /data/

services:
  peek-server:
    environment:
      # Override config dir to use named volume path (outside /app bind mount)
      CONFIG_DIR: /peek-data
      DATABASE_URL: file:/peek-data/peek-stash-browser.db
    volumes:
      # Named volume mounted outside /app to avoid being shadowed by source bind mount
      - peek-data:/peek-data

  peek-client:
    environment:
      # Enable polling for file watching - WSL2 doesn't propagate fs events from Windows
      CHOKIDAR_USEPOLLING: "true"

volumes:
  peek-data:
    name: peek-stash-browser_peek-data
